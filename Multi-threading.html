<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Láº­p trÃ¬nh Äa luá»“ng (Multi-threading)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: #f8f9fa; /* Light gray background */
        }
        .code-block {
            background-color: #282c34;
            color: #abb2bf;
            border-radius: 8px;
            padding: 16px;
            font-family: 'Courier New', Courier, monospace;
            overflow-x: auto;
            font-size: 14px;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        /* Deadlock simulation styles */
        #deadlock-circle {
            position: relative;
            width: 300px;
            height: 300px;
            border: 2px dashed #9ca3af;
            border-radius: 50%;
            margin: 2rem auto;
        }
        .philosopher, .fork {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
            transition: all 0.5s ease-in-out;
        }
        .philosopher {
            background-color: #dbeafe;
            border: 2px solid #93c5fd;
        }
        .fork {
            width: 40px;
            height: 40px;
            background-color: #fef9c3;
            border: 2px solid #fde047;
            font-size: 1.2rem;
        }
		.code-block {
            position: relative; /* Báº¯t buá»™c pháº£i cÃ³ Ä‘á»ƒ Ä‘á»‹nh vá»‹ nÃºt con */
        }
        .copy-button {
            position: absolute;
            top: 0.5rem; /* 8px */
            right: 0.5rem; /* 8px */
            background-color: #4a5568; /* MÃ u ná»n xÃ¡m Ä‘áº­m */
            color: #e2e8f0; /* MÃ u icon xÃ¡m nháº¡t */
            border: none;
            border-radius: 0.375rem; /* bo gÃ³c 6px */
            padding: 0.5rem; /* 8px */
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .copy-button:hover {
            background-color: #2d3748; /* MÃ u ná»n Ä‘áº­m hÆ¡n khi hover */
        }
		.code-block {
            position: relative; /* Giá»¯ nguyÃªn, ráº¥t quan trá»ng */
        }
        .code-toolbar {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: flex;
            gap: 0.5rem; /* Khoáº£ng cÃ¡ch giá»¯a cÃ¡c nÃºt */
            z-index: 10;
        }
        .toolbar-button {
            background-color: #4a5568;
            color: #e2e8f0;
            border: none;
            border-radius: 0.375rem;
            padding: 0.5rem;
            cursor: pointer;
            display: flex; /* Äá»ƒ icon vÃ  text náº±m cáº¡nh nhau */
            align-items: center; /* CÄƒn giá»¯a theo chiá»u dá»c */
            gap: 0.35rem; /* Khoáº£ng cÃ¡ch giá»¯a icon vÃ  text */
            font-size: 0.75rem; /* 12px */
            line-height: 1; 
            transition: background-color 0.2s;
            font-family: 'Be Vietnam Pro', sans-serif; /* Äáº£m báº£o font chá»¯ nháº¥t quÃ¡n */
        }
        .toolbar-button:hover {
            background-color: #2d3748;
        }
    </style>
</head>

<body class="text-gray-800">
    <header class="bg-white/80 backdrop-blur-lg shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold text-cyan-700">Láº­p trÃ¬nh Äa luá»“ng</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#part1" class="text-gray-600 hover:bg-cyan-600 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">Má»Ÿ Ä‘áº§u</a>
                        <a href="#part2" class="text-gray-600 hover:bg-cyan-600 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">Tiá»n trÃ¬nh vÃ  Luá»“ng</a>
                        <a href="#part3" class="text-gray-600 hover:bg-cyan-600 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">Láº­p trÃ¬nh Äa luá»“ng</a>
                        <a href="#part4" class="text-gray-600 hover:bg-cyan-600 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">Váº¥n Ä‘á» thÆ°á»ng gáº·p</a>
                        <a href="#part5" class="text-gray-600 hover:bg-cyan-600 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">Äá»“ng bá»™ hÃ³a</a>
                        <a href="#part6" class="text-gray-600 hover:bg-cyan-600 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">Thá»±c hÃ nh</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <section id="intro" class="text-center py-12">
            <h2 class="text-4xl font-extrabold text-gray-900 sm:text-5xl md:text-6xl"><span class="text-cyan-600">Láº­p trÃ¬nh Äa luá»“ng (Multi-threading)</span></h2>
            <p class="mt-4 max-w-2xl mx-auto text-xl text-gray-500 whitespace-nowrap">LÃ½ thuyáº¿t, thÃ¡ch thá»©c vÃ  á»©ng dá»¥ng thá»±c tiá»…n trong thá»i ká»³ CPU Äa lÃµi</p>
			<p class="mt-4 text-xl font-bold text-gray-500 text-center whitespace-nowrap">Nguyá»…n VÄƒn Tuáº¥n, Nguyá»…n VÅ© CÆ°á»ng, Äáº·ng Quang DÆ°, Tráº§n Há»¯u Máº¡nh, Äá»— VÄƒn Máº¡nh, DÆ°Æ¡ng Huy HoÃ ng - KTVT37.</p>
        </section>
        
        <section id="part1" class="bg-white rounded-lg shadow-xl p-6 md:p-8 my-12">
            <h3 class="text-3xl font-bold text-center mb-8">1. Má»Ÿ Ä‘áº§u</h3>
            <div>
                <div>
                    <h4 class="font-bold text-xl mb-3 text-cyan-700">1.1. Thá»i ká»³ cá»§a CPU Ä‘a lÃµi</h4>
					<div class="chart-container h-64 md:h-80 md:float-right md:ml-6 mb-4"> 
						<canvas id="mooreLawChart"></canvas>
					</div>
					<div id="content-overall" class="mb-4 text-gray-700 text-justify">
						<p class="mb-4">Trong nhá»¯ng tháº­p ká»· Ä‘áº§u cá»§a ngÃ nh cÃ´ng nghiá»‡p mÃ¡y tÃ­nh, hiá»‡u nÄƒng cá»§a bá»™ vi xá»­ lÃ½ (CPU) tÄƒng trÆ°á»Ÿng theo má»™t quy luáº­t gáº§n nhÆ° tuyáº¿n tÃ­nh, Ä‘Æ°á»£c mÃ´ táº£ bá»Ÿi <strong>Äá»‹nh luáº­t Moore</strong>. Sá»± tÄƒng trÆ°á»Ÿng nÃ y chá»§ yáº¿u Ä‘áº¿n tá»« viá»‡c tÄƒng tá»‘c Ä‘á»™ xung nhá»‹p (clock speed) vÃ  thu nhá» kÃ­ch thÆ°á»›c bÃ³ng bÃ¡n dáº«n. Tuy nhiÃªn, vÃ o Ä‘áº§u nhá»¯ng nÄƒm 2000, phÆ°Æ¡ng phÃ¡p nÃ y Ä‘Ã£ váº¥p pháº£i nhá»¯ng giá»›i háº¡n váº­t lÃ½ khÃ´ng thá»ƒ vÆ°á»£t qua, chá»§ yáº¿u lÃ  váº¥n Ä‘á» táº£n nhiá»‡t vÃ  tiÃªu thá»¥ nÄƒng lÆ°á»£ng. Viá»‡c tiáº¿p tá»¥c tÄƒng tá»‘c Ä‘á»™ xung nhá»‹p sáº½ táº¡o ra má»™t lÆ°á»£ng nhiá»‡t khá»•ng lá»“, Ä‘e dá»a phÃ¡ há»§y chÃ­nh con chip Ä‘Ã³.</p>
						<p class="mb-4">Äá»ƒ tiáº¿p tá»¥c con Ä‘Æ°á»ng nÃ¢ng cao hiá»‡u nÄƒng tÃ­nh toÃ¡n, ngÃ nh cÃ´ng nghiá»‡p pháº§n cá»©ng Ä‘Ã£ thá»±c hiá»‡n má»™t bÆ°á»›c chuyá»ƒn Ä‘á»•i chiáº¿n lÆ°á»£c: thay vÃ¬ cá»‘ gáº¯ng lÃ m cho má»™t bá»™ nÃ£o duy nháº¥t cháº¡y nhanh hÆ¡n, há» báº¯t Ä‘áº§u tÃ­ch há»£p nhiá»u bá»™ nÃ£o (lÃµi - core) vÃ o trong cÃ¹ng má»™t con chip. ÄÃ¢y chÃ­nh lÃ  sá»± ra Ä‘á»i cá»§a <strong>CPU Ä‘a lÃµi</strong>, má»™t kiáº¿n trÃºc Ä‘Ã£ trá»Ÿ thÃ nh tiÃªu chuáº©n trÃªn má»i thiáº¿t bá»‹, tá»« Ä‘iá»‡n thoáº¡i thÃ´ng minh Ä‘áº¿n cÃ¡c siÃªu mÃ¡y tÃ­nh. Má»™t CPU hiá»‡n Ä‘áº¡i cÃ³ thá»ƒ dá»… dÃ ng sá»Ÿ há»¯u 4, 8, 16 hoáº·c tháº­m chÃ­ nhiá»u lÃµi hÆ¡n.</p>
						<p>Sá»± thay Ä‘á»•i vá» pháº§n cá»©ng nÃ y Ä‘Ã£ táº¡o ra má»™t thÃ¡ch thá»©c vÃ  cÅ©ng lÃ  má»™t cÆ¡ há»™i lá»›n cho cÃ¡c nhÃ  phÃ¡t triá»ƒn pháº§n má»m. Má»™t chÆ°Æ¡ng trÃ¬nh Ä‘Æ°á»£c viáº¿t theo kiá»ƒu truyá»n thá»‘ng, hay cÃ²n gá»i lÃ  <strong>chÆ°Æ¡ng trÃ¬nh Ä‘Æ¡n luá»“ng (single-threaded)</strong>, chá»‰ cÃ³ thá»ƒ thá»±c thi trÃªn má»™t lÃµi CPU táº¡i má»™t thá»i Ä‘iá»ƒm. Äiá»u nÃ y cÃ³ nghÄ©a lÃ , dÃ¹ mÃ¡y tÃ­nh cá»§a báº¡n cÃ³ 8 hay 16 lÃµi, á»©ng dá»¥ng Ä‘Ã³ cÅ©ng chá»‰ cÃ³ thá»ƒ sá»­ dá»¥ng má»™t lÃµi duy nháº¥t, Ä‘á»ƒ láº¡i pháº§n lá»›n nÄƒng lá»±c tÃ­nh toÃ¡n cá»§a há»‡ thá»‘ng bá»‹ lÃ£ng phÃ­. Äá»ƒ khai thÃ¡c triá»‡t Ä‘á»ƒ sá»©c máº¡nh cá»§a pháº§n cá»©ng hiá»‡n Ä‘áº¡i, cÃ¡c láº­p trÃ¬nh viÃªn cáº§n pháº£i Ã¡p dá»¥ng má»™t mÃ´ hÃ¬nh láº­p trÃ¬nh má»›i: <strong>Láº­p trÃ¬nh Äa luá»“ng (Multi-threading)</strong>. ÄÃ¢y lÃ  ká»¹ thuáº­t cho phÃ©p má»™t chÆ°Æ¡ng trÃ¬nh cÃ³ thá»ƒ chia cÃ´ng viá»‡c cá»§a mÃ¬nh thÃ nh nhiá»u pháº§n nhá», gá»i lÃ  cÃ¡c <strong>luá»“ng (threads)</strong>, vÃ  thá»±c thi chÃºng Ä‘á»“ng thá»i trÃªn nhiá»u lÃµi khÃ¡c nhau, tá»« Ä‘Ã³ tÄƒng tá»‘c Ä‘á»™ xá»­ lÃ½ vÃ  cáº£i thiá»‡n hiá»‡u nÄƒng tá»•ng thá»ƒ cá»§a á»©ng dá»¥ng.</p>
					</div>
                </div>
            </div>
            <hr class="my-8">
            <div>
                <h4 class="font-bold text-xl mb-3 text-cyan-700 text-center">1.2. PhÃ¢n biá»‡t Concurrency (Äá»“ng thá»i) vÃ  Parallelism (Song song)</h4>
                <div class="grid md:grid-cols-2 gap-8 mt-4">
                    <div class="bg-cyan-50 border border-cyan-200 p-4 rounded-lg">
                        <h5 class="font-semibold text-lg">Concurrency (Äá»“ng thá»i)</h5>
                        <p class="text-gray-700 mt-2 text-justify">LÃ  kháº£ nÄƒng quáº£n lÃ½ vÃ  xá»­ lÃ½ nhiá»u tÃ¡c vá»¥ <strong>dÆ°á»ng nhÆ° cÃ¹ng má»™t lÃºc</strong>. CÃ¡c tÃ¡c vá»¥ nÃ y cÃ³ thá»ƒ báº¯t Ä‘áº§u, cháº¡y, vÃ  hoÃ n thÃ nh trong cÃ¡c khoáº£ng thá»i gian chá»“ng chÃ©o nhau. TrÃªn má»™t há»‡ thá»‘ng chá»‰ cÃ³ má»™t lÃµi CPU, tÃ­nh Ä‘á»“ng thá»i Ä‘Æ°á»£c thá»±c hiá»‡n thÃ´ng qua má»™t ká»¹ thuáº­t gá»i lÃ  <strong>chuyá»ƒn Ä‘á»•i ngá»¯ cáº£nh (context switching)</strong>. Há»‡ Ä‘iá»u hÃ nh sáº½ cáº¥p phÃ¡t cho má»—i tÃ¡c vá»¥ má»™t khoáº£ng thá»i gian ráº¥t nhá» Ä‘á»ƒ cháº¡y trÃªn CPU, sau Ä‘Ã³ nhanh chÃ³ng chuyá»ƒn sang tÃ¡c vá»¥ tiáº¿p theo. QuÃ¡ trÃ¬nh chuyá»ƒn Ä‘á»•i nÃ y diá»…n ra nhanh Ä‘áº¿n má»©c ngÆ°á»i dÃ¹ng cÃ³ <strong>cáº£m giÃ¡c nhÆ° nhiá»u tÃ¡c vá»¥ Ä‘ang cháº¡y cÃ¹ng lÃºc.</strong></p>
                        <p class="mt-2 text-sm text-justify"><strong>VÃ­ dá»¥:</strong> Má»™t ngÆ°á»i Ä‘áº§u báº¿p vá»«a giÃ¡m sÃ¡t ná»“i sÃºp Ä‘ang sÃ´i, vá»«a tranh thá»§ thÃ¡i rau cá»§. NgÆ°á»i Ä‘áº§u báº¿p khÃ´ng lÃ m cáº£ hai viá»‡c chÃ­nh xÃ¡c táº¡i cÃ¹ng má»™t thá»i Ä‘iá»ƒm, mÃ  liÃªn tá»¥c chuyá»ƒn sá»± chÃº Ã½ vÃ  hÃ nh Ä‘á»™ng qua láº¡i giá»¯a hai cÃ´ng viá»‡c Ä‘Ã³.</p>
                    </div>
                    <div class="bg-emerald-50 border border-emerald-200 p-4 rounded-lg">
                        <h5 class="font-semibold text-lg">Parallelism (Song song)</h5>
                        <p class="text-gray-700 mt-2 text-justify">LÃ  kháº£ nÄƒng thá»±c thi <strong>nhiá»u tÃ¡c vá»¥</strong> chÃ­nh xÃ¡c táº¡i cÃ¹ng má»™t thá»i Ä‘iá»ƒm. Äiá»u nÃ y chá»‰ cÃ³ thá»ƒ xáº£y ra trÃªn má»™t há»‡ thá»‘ng pháº§n cá»©ng cÃ³ nhiá»u hÆ¡n má»™t Ä‘Æ¡n vá»‹ xá»­ lÃ½, cháº³ng háº¡n nhÆ° <strong>CPU Ä‘a lÃµi</strong>. </p>
                        <p class="mt-2 text-sm text-justify"><strong>VÃ­ dá»¥:</strong> Hai Ä‘áº§u báº¿p, má»™t ngÆ°á»i chá»‰ náº¥u sÃºp, ngÆ°á»i kia chá»‰ thÃ¡i rau, cáº£ hai cÃ¹ng lÃ m viá»‡c cá»§a mÃ¬nh trong cÃ¹ng má»™t khoáº£ng thá»i gian.</p>
                    </div>
                </div>
				<p class="mt-6 text-justify text-gray-700">Äiá»u quan trá»ng cáº§n nháº¥n máº¡nh lÃ  sá»± khÃ¡c biá»‡t giá»¯a hai khÃ¡i niá»‡m nÃ y. <strong>Láº­p trÃ¬nh Ä‘á»“ng thá»i (Concurrency)</strong> lÃ  má»™t khÃ¡i niá»‡m thuá»™c vá» thiáº¿t káº¿ pháº§n má»m; nÃ³ lÃ  cÃ¡ch chÃºng ta cáº¥u trÃºc má»™t chÆ°Æ¡ng trÃ¬nh Ä‘á»ƒ cÃ³ thá»ƒ xá»­ lÃ½ nhiá»u luá»“ng cÃ´ng viá»‡c má»™t cÃ¡ch Ä‘á»™c láº­p, nÃ³ lÃ  má»™t váº¥n Ä‘á» thuá»™c vá» logic cá»§a á»©ng dá»¥ng. NgÆ°á»£c láº¡i, <strong>thá»±c thi song song (Parallelism)</strong> lÃ  má»™t hiá»‡n tÆ°á»£ng thuá»™c vá» pháº§n cá»©ng vÃ  mÃ´i trÆ°á»ng thá»±c thi. NÃ³ xáº£y ra khi cÃ¡c Ä‘Æ¡n vá»‹ cÃ´ng viá»‡c Ä‘Æ°á»£c cáº¥u trÃºc Ä‘á»“ng thá»i Ä‘Ã³ thá»±c sá»± Ä‘Æ°á»£c thá»±c thi trÃªn cÃ¡c lÃµi CPU riÃªng biá»‡t táº¡i cÃ¹ng má»™t thá»i Ä‘iá»ƒm.</p>
				<p class="mt-6 text-justify text-gray-700">Do Ä‘Ã³, cÃ³ thá»ƒ nÃ³i ráº±ng, láº­p trÃ¬nh viÃªn viáº¿t mÃ£ Ä‘á»“ng thá»i, nhÆ°ng viá»‡c mÃ£ Ä‘Ã³ cÃ³ cháº¡y song song hay khÃ´ng phá»¥ thuá»™c vÃ o ná»n táº£ng pháº§n cá»©ng vÃ  cÃ¡ch há»‡ Ä‘iá»u hÃ nh láº­p lá»‹ch. Má»™t chÆ°Æ¡ng trÃ¬nh Ä‘Æ°á»£c thiáº¿t káº¿ tá»‘t vá» máº·t Ä‘á»“ng thá»i cÃ³ thá»ƒ cháº¡y hiá»‡u quáº£ trÃªn CPU Ä‘Æ¡n lÃµi (thÃ´ng qua chuyá»ƒn Ä‘á»•i ngá»¯ cáº£nh) vÃ  sáº½ tá»± Ä‘á»™ng Ä‘Æ°á»£c hÆ°á»Ÿng lá»£i vá» hiá»‡u nÄƒng khi cháº¡y trÃªn CPU Ä‘a lÃµi (thÃ´ng qua thá»±c thi song song). <strong>Láº­p trÃ¬nh Ä‘a luá»“ng</strong> chÃ­nh lÃ  cÃ´ng cá»¥ Ä‘á»ƒ chÃºng ta xÃ¢y dá»±ng nÃªn cáº¥u trÃºc Ä‘á»“ng thá»i Ä‘Ã³.</p>
            </div>
        </section>

        <section id="part2" class="py-12">
            <h3 class="text-3xl font-bold text-center mb-8">2. Tiáº¿n trÃ¬nh (Process) vÃ  Luá»“ng (Thread)</h3>
            <p class="text-center max-w-3xl mx-auto text-gray-600 mb-12">Äá»ƒ hiá»ƒu vá» Ä‘a luá»“ng, trÆ°á»›c tiÃªn chÃºng ta cáº§n phÃ¢n biá»‡t rÃµ hai khÃ¡i niá»‡m cá»‘t lÃµi: <strong>Tiáº¿n trÃ¬nh (Process)</strong> - má»™t chÆ°Æ¡ng trÃ¬nh Ä‘ang cháº¡y vá»›i khÃ´ng gian bá»™ nhá»› riÃªng vÃ  <strong>Luá»“ng (Thread)</strong> - má»™t Ä‘Æ¡n vá»‹ thá»±c thi bÃªn trong tiáº¿n trÃ¬nh Ä‘Ã³. Sá»± khÃ¡c biá»‡t cÆ¡ báº£n náº±m á»Ÿ cÃ¡ch chÃºng quáº£n lÃ½ vÃ  chia sáº» tÃ i nguyÃªn.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                <div class="bg-white p-6 rounded-lg shadow-lg border border-gray-200">
                    <h4 class="font-bold text-xl mb-4 text-center text-red-600">Tiáº¿n trÃ¬nh (Process)</h4>
                    <p class="text-sm text-gray-700 mb-4 text-justify"><strong>Tiáº¿n trÃ¬nh (Process)</strong> lÃ  má»™t thá»±c thá»ƒ cá»§a má»™t chÆ°Æ¡ng trÃ¬nh Ä‘ang Ä‘Æ°á»£c thá»±c thi. Má»—i tiáº¿n trÃ¬nh lÃ  má»™t mÃ´i trÆ°á»ng thá»±c thi hoÃ n chá»‰nh vÃ  Ä‘á»™c láº­p, bao gá»“m:</p>
					<ul class="list-disc list-inside space-y-1 text-sm text-gray-700 mb-4 text-justify">
                        <li><strong>KhÃ´ng gian Ä‘á»‹a chá»‰ bá»™ nhá»› áº£o riÃªng biá»‡t</strong>: ÄÃ¢y lÃ  Ä‘áº·c tÃ­nh quan trá»ng nháº¥t cá»§a má»™t tiáº¿n trÃ¬nh. Má»—i tiáº¿n trÃ¬nh sá»Ÿ há»¯u má»™t khÃ´ng gian bá»™ nhá»› áº£o Ä‘á»™c láº­p, Ä‘Æ°á»£c há»‡ Ä‘iá»u hÃ nh báº£o vá»‡. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  tiáº¿n trÃ¬nh A khÃ´ng thá»ƒ truy cáº­p trá»±c tiáº¿p vÃ o dá»¯ liá»‡u trong bá»™ nhá»› cá»§a tiáº¿n trÃ¬nh B vÃ  ngÆ°á»£c láº¡i. Sá»± cÃ´ láº­p nÃ y mang láº¡i tÃ­nh á»•n Ä‘á»‹nh vÃ  an toÃ n cao cho há»‡ thá»‘ng; náº¿u má»™t tiáº¿n trÃ¬nh gáº·p lá»—i vÃ  bá»‹ sáº­p, nÃ³ sáº½ khÃ´ng lÃ m áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c tiáº¿n trÃ¬nh khÃ¡c Ä‘ang cháº¡y.</li>
                        <li><strong>TÃ i nguyÃªn há»‡ thá»‘ng</strong>: Má»™t tiáº¿n trÃ¬nh Ä‘Æ°á»£c cáº¥p phÃ¡t cÃ¡c tÃ i nguyÃªn riÃªng nhÆ° mÃ£ chÆ°Æ¡ng trÃ¬nh (code segment), dá»¯ liá»‡u toÃ n cá»¥c (data segment), cÃ¡c file handles (cÃ¡c tá»‡p Ä‘ang má»Ÿ), cÃ¡c káº¿t ná»‘i máº¡ng, vÃ  Ã­t nháº¥t má»™t luá»“ng thá»±c thi (luá»“ng chÃ­nh).</li>
                        <li><strong>"TÃ­nh "náº·ng" (Heavyweight)</strong>: Viá»‡c táº¡o ra má»™t tiáº¿n trÃ¬nh má»›i lÃ  má»™t hoáº¡t Ä‘á»™ng tá»‘n kÃ©m tÃ i nguyÃªn vÃ  thá»i gian. Há»‡ Ä‘iá»u hÃ nh pháº£i thá»±c hiá»‡n nhiá»u cÃ´ng viá»‡c phá»©c táº¡p nhÆ° cáº¥p phÃ¡t khÃ´ng gian bá»™ nhá»› áº£o, táº¡o cÃ¡c cáº¥u trÃºc dá»¯ liá»‡u quáº£n lÃ½ (nhÆ° Process Control Block - PCB), vÃ  náº¡p mÃ£ chÆ°Æ¡ng trÃ¬nh. Do Ä‘Ã³, tiáº¿n trÃ¬nh Ä‘Æ°á»£c coi lÃ  má»™t Ä‘Æ¡n vá»‹ "náº·ng".</li>
                     </ul>
					<img src="https://img.upanh.moe/JjPg6Yz8/0ff08e91ea72.png" alt="Minh há»a vá» Tiáº¿n trÃ¬nh (Process)" border="0" style="display: block; margin-left: auto; margin-right: auto;">
                </div>
                <div class="bg-white p-6 rounded-lg shadow-lg border border-gray-200">
                    <h4 class="font-bold text-xl mb-4 text-center text-cyan-600">Luá»“ng (Thread)</h4>
                    <p class="text-sm text-gray-700 mb-4 text-justify"><strong>Luá»“ng (Thread)</strong>, hay cÃ²n gá»i lÃ  tiá»ƒu trÃ¬nh, lÃ  Ä‘Æ¡n vá»‹ thá»±c thi cÆ¡ báº£n nháº¥t bÃªn trong má»™t tiáº¿n trÃ¬nh. Má»™t tiáº¿n trÃ¬nh cÃ³ thá»ƒ chá»©a má»™t hoáº·c nhiá»u luá»“ng, táº¥t cáº£ cÃ¹ng hoáº¡t Ä‘á»™ng trong mÃ´i trÆ°á»ng do tiáº¿n trÃ¬nh Ä‘Ã³ táº¡o ra. Má»—i luá»“ng cÃ³ cÃ¡c thÃ nh pháº§n riÃªng biá»‡t Ä‘á»ƒ duy trÃ¬ tráº¡ng thÃ¡i thá»±c thi cá»§a nÃ³, bao gá»“m: </p>
					<ul class="list-disc list-inside space-y-1 text-sm text-gray-700 mb-4 text-justify">
                        <li><strong>ID Luá»“ng (Thread ID)</strong>: Má»™t Ä‘á»‹nh danh duy nháº¥t trong tiáº¿n trÃ¬nh.</li>
                        <li><strong>Bá»™ Ä‘áº¿m chÆ°Æ¡ng trÃ¬nh (Program Counter)</strong>: Chá»‰ Ä‘áº¿n lá»‡nh tiáº¿p theo sáº½ Ä‘Æ°á»£c thá»±c thi.</li>
                        <li><strong>Táº­p thanh ghi (Register Set)</strong>: LÆ°u trá»¯ cÃ¡c giÃ¡ trá»‹ tÃ­nh toÃ¡n táº¡m thá»i.</li>
						<li><strong>TÃ­nh "nháº¹" (Lightweight)</strong>: Do viá»‡c chia sáº» tÃ i nguyÃªn, viá»‡c táº¡o ra má»™t luá»“ng má»›i nhanh hÆ¡n vÃ  tá»‘n Ã­t tÃ i nguyÃªn hÆ¡n ráº¥t nhiá»u so vá»›i viá»‡c táº¡o má»™t tiáº¿n trÃ¬nh má»›i. Viá»‡c chuyá»ƒn Ä‘á»•i ngá»¯ cáº£nh giá»¯a cÃ¡c luá»“ng trong cÃ¹ng má»™t tiáº¿n trÃ¬nh cÅ©ng nhanh hÆ¡n Ä‘Ã¡ng ká»ƒ. VÃ¬ váº­y, luá»“ng Ä‘Æ°á»£c coi lÃ  má»™t Ä‘Æ¡n vá»‹ "nháº¹".</li>
                    </ul>
					<p class="text-sm text-gray-700 mb-4 text-justify">Äiá»ƒm khÃ¡c biá»‡t cá»‘t lÃµi vÃ  quan trá»ng nháº¥t giá»¯a luá»“ng vÃ  tiáº¿n trÃ¬nh náº±m á»Ÿ cÃ¡ch chÃºng quáº£n lÃ½ bá»™ nhá»›. Trong khi má»—i tiáº¿n trÃ¬nh cÃ³ khÃ´ng gian bá»™ nhá»› riÃªng, thÃ¬ táº¥t cáº£ cÃ¡c luá»“ng trong cÃ¹ng má»™t tiáº¿n trÃ¬nh láº¡i chia sáº» chung khÃ´ng gian Ä‘á»‹a chá»‰ bá»™ nhá»› cá»§a tiáº¿n trÃ¬nh Ä‘Ã³. Äiá»u nÃ y bao gá»“m vÃ¹ng mÃ£, vÃ¹ng dá»¯ liá»‡u, vÃ  cÃ¡c tÃ i nguyÃªn khÃ¡c nhÆ° file handles. </p>
					<img src="https://img.upanh.moe/FktGWR9J/6e32b9a6372b.png" alt="Minh há»a vá» Luá»“ng (Thread)" border="0" style="display: block; margin-left: auto; margin-right: auto;">
                </div>
            </div>
            <div class="mt-12">
                <h4 class="font-bold text-xl mb-4 text-cyan-700 text-center">So sÃ¡nh giá»¯a Tiáº¿n trÃ¬nh vÃ  Luá»“ng</h4>
                <div class="overflow-x-auto rounded-lg shadow">
                    <table class="min-w-full bg-white">
                        <thead class="bg-gray-800 text-white">
                            <tr>
                                <th class="text-left py-3 px-4 uppercase font-semibold text-sm">TiÃªu chÃ­</th>
                                <th class="text-left py-3 px-4 uppercase font-semibold text-sm">Tiáº¿n trÃ¬nh (Process)</th>
                                <th class="text-left py-3 px-4 uppercase font-semibold text-sm">Luá»“ng (Thread)</th>
                            </tr>
                        </thead>
                        <tbody class="text-gray-700">
							<tr class="border-b"><td class="py-3 px-4 font-semibold">Äá»‹nh nghÄ©a</td><td class="py-3 px-4">Má»™t chÆ°Æ¡ng trÃ¬nh Ä‘ang thá»±c thi. Má»™t thá»±c thá»ƒ Ä‘á»™c láº­p Ä‘Æ°á»£c há»‡ Ä‘iá»u hÃ nh quáº£n lÃ½.</td><td class="py-3 px-4">Má»™t Ä‘Æ¡n vá»‹ thá»±c thi trong má»™t tiáº¿n trÃ¬nh. LÃ  má»™t pháº§n cá»§a tiáº¿n trÃ¬nh.</td></tr>
                            <tr class="border-b"><td class="py-3 px-4 font-semibold">KhÃ´ng gian bá»™ nhá»›</td><td class="py-3 px-4">Äá»™c láº­p, riÃªng biá»‡t vÃ  Ä‘Æ°á»£c báº£o vá»‡. Má»—i tiáº¿n trÃ¬nh cÃ³ khÃ´ng gian Ä‘á»‹a chá»‰ áº£o cá»§a riÃªng mÃ¬nh.</td><td class="py-3 px-4">Chia sáº» chung khÃ´ng gian Ä‘á»‹a chá»‰ bá»™ nhá»› (vÃ¹ng mÃ£, dá»¯ liá»‡u) vá»›i cÃ¡c luá»“ng khÃ¡c trong cÃ¹ng tiáº¿n trÃ¬nh.</td></tr>
                            <tr class="bg-gray-50 border-b"><td class="py-3 px-4 font-semibold">Chi phÃ­ táº¡o</td><td class="py-3 px-4">Cao ("náº·ng"). ÄÃ²i há»i há»‡ Ä‘iá»u hÃ nh cáº¥p phÃ¡t nhiá»u tÃ i nguyÃªn.</td><td class="py-3 px-4">Tháº¥p ("nháº¹"). TÃ¡i sá»­ dá»¥ng tÃ i nguyÃªn cá»§a tiáº¿n trÃ¬nh cha.</td></tr>
                            <tr class="border-b"><td class="py-3 px-4 font-semibold">Chuyá»ƒn Ä‘á»•i ngá»¯ cáº£nh</td><td class="py-3 px-4">Cháº­m, chi phÃ­ cao. Cáº§n lÆ°u vÃ  phá»¥c há»“i toÃ n bá»™ khÃ´ng gian bá»™ nhá»› vÃ  tÃ i nguyÃªn.</td><td class="py-3 px-4">Nhanh, chi phÃ­ tháº¥p. Chá»‰ cáº§n lÆ°u vÃ  phá»¥c há»“i thanh ghi vÃ  ngÄƒn xáº¿p.</td></tr>
                            <tr class="bg-gray-50 border-b"><td class="py-3 px-4 font-semibold">Giao tiáº¿p</td><td class="py-3 px-4">Phá»©c táº¡p, cáº§n cÃ¡c cÆ¡ cháº¿ giao tiáº¿p liÃªn tiáº¿n trÃ¬nh (IPC - Inter-Process Communication) do há»‡ Ä‘iá»u hÃ nh cung cáº¥p.</td><td class="py-3 px-4">ÄÆ¡n giáº£n, nhanh chÃ³ng thÃ´ng qua viá»‡c Ä‘á»c/ghi trá»±c tiáº¿p vÃ o cÃ¡c biáº¿n vÃ  cáº¥u trÃºc dá»¯ liá»‡u trong bá»™ nhá»› chia sáº».</td></tr>
                            <tr><td class="py-3 px-4 font-semibold">Má»©c Ä‘á»™ Ä‘á»™c láº­p & An toÃ n</td><td class="py-3 px-4">Cao. Lá»—i á»Ÿ má»™t tiáº¿n trÃ¬nh (vÃ­ dá»¥: truy cáº­p bá»™ nhá»› khÃ´ng há»£p lá»‡) khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c tiáº¿n trÃ¬nh khÃ¡c.</td><td class="py-3 px-4">Tháº¥p. Lá»—i á»Ÿ má»™t luá»“ng (vÃ­ dá»¥: ghi Ä‘Ã¨ dá»¯ liá»‡u quan trá»ng) cÃ³ thá»ƒ lÃ m sáº­p toÃ n bá»™ tiáº¿n trÃ¬nh vÃ  táº¥t cáº£ cÃ¡c luá»“ng khÃ¡c.</td></tr>
							<tr><td class="py-3 px-4 font-semibold">Má»‘i quan há»‡</td><td class="py-3 px-4">CÃ¡c tiáº¿n trÃ¬nh lÃ  cÃ¡c thá»±c thá»ƒ ngang hÃ ng, Ä‘á»™c láº­p vá»›i nhau.</td><td class="py-3 px-4">Luá»“ng lÃ  thÃ nh pháº§n con, phá»¥ thuá»™c vÃ o tiáº¿n trÃ¬nh chá»©a nÃ³. Náº¿u tiáº¿n trÃ¬nh káº¿t thÃºc, táº¥t cáº£ luá»“ng cá»§a nÃ³ cÅ©ng káº¿t thÃºc.</td></tr>
                        </tbody>
                    </table>
                </div>
			</div>
			<div class="mt-4">
				<p class="text-gray-700 mb-2 text-justify">Tá»« báº£ng so sÃ¡nh trÃªn, má»™t quy luáº­t thiáº¿t káº¿ cÆ¡ báº£n trong há»‡ thá»‘ng mÃ¡y tÃ­nh Ä‘Æ°á»£c thá»ƒ hiá»‡n rÃµ rÃ ng: sá»± Ä‘Ã¡nh Ä‘á»•i giá»¯a An toÃ n/CÃ´ láº­p (Isolation) vÃ  Hiá»‡u quáº£/Chia sáº» (Efficiency).</p>
				<p class="text-gray-700 mb-2 text-justify">CÃ¡c tiáº¿n trÃ¬nh Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ Æ°u tiÃªn sá»± an toÃ n vÃ  cÃ´ láº­p. Viá»‡c má»—i tiáº¿n trÃ¬nh cÃ³ má»™t khÃ´ng gian bá»™ nhá»› riÃªng biá»‡t táº¡o ra má»™t bá»©c tÆ°á»ng lá»­a vá»¯ng cháº¯c, ngÄƒn cháº·n lá»—i lan truyá»n giá»¯a cÃ¡c á»©ng dá»¥ng. Tuy nhiÃªn, sá»± an toÃ n nÃ y pháº£i tráº£ giÃ¡ báº±ng hiá»‡u suáº¥t: viá»‡c táº¡o má»›i, giao tiáº¿p vÃ  chuyá»ƒn Ä‘á»•i giá»¯a cÃ¡c tiáº¿n trÃ¬nh Ä‘á»u ráº¥t tá»‘n kÃ©m.</p>
				<p class="text-gray-700 mb-2 text-justify">NgÆ°á»£c láº¡i, cÃ¡c luá»“ng Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ Æ°u tiÃªn hiá»‡u quáº£ vÃ  chia sáº». Viá»‡c dÃ¹ng chung bá»™ nhá»› giÃºp táº¡o luá»“ng cá»±c ká»³ nhanh, chuyá»ƒn Ä‘á»•i ngá»¯ cáº£nh gáº§n nhÆ° tá»©c thá»i, vÃ  giao tiáº¿p giá»¯a cÃ¡c luá»“ng hiá»‡u quáº£ tá»‘i Ä‘a. NhÆ°ng hiá»‡u quáº£ nÃ y láº¡i pháº£i tráº£ giÃ¡ báº±ng sá»± an toÃ n. VÃ¬ khÃ´ng cÃ³ bá»©c tÆ°á»ng nÃ o ngÄƒn cÃ¡ch cÃ¡c luá»“ng, má»™t luá»“ng "xáº¥u" cÃ³ thá»ƒ dá»… dÃ ng ghi Ä‘Ã¨ lÃªn dá»¯ liá»‡u mÃ  má»™t luá»“ng khÃ¡c Ä‘ang sá»­ dá»¥ng, gÃ¢y ra cÃ¡c lá»—i khÃ³ lÆ°á»ng vÃ  cÃ³ thá»ƒ lÃ m sáº­p toÃ n bá»™ á»©ng dá»¥ng. Äiá»u nÃ y Ä‘Ã²i há»i láº­p trÃ¬nh viÃªn pháº£i "láº­p trÃ¬nh má»™t cÃ¡ch ráº¥t cáº©n tháº­n" khi lÃ m viá»‡c vá»›i Ä‘a luá»“ng.</p>
            </div>
        </section>
        
        <section id="part3" class="py-12 bg-white rounded-lg shadow-xl my-12 p-6 md:p-8">
            <h3 class="text-3xl font-bold text-center mb-2">3. Láº­p trÃ¬nh Äa luá»“ng</h3>
			<h4 class="font-bold text-xl mb-3 text-cyan-700 text-center">3.1. Lá»£i Ã­ch cá»§a Äa luá»“ng</h4>
            <p class="text-center max-w-3xl mx-auto text-gray-600 mb-12">Äa luá»“ng khÃ´ng chá»‰ giÃºp táº­n dá»¥ng pháº§n cá»©ng hiá»‡n Ä‘áº¡i mÃ  cÃ²n mang láº¡i nhiá»u lá»£i Ã­ch thiáº¿t thá»±c cho cáº£ nhÃ  phÃ¡t triá»ƒn vÃ  ngÆ°á»i dÃ¹ng cuá»‘i.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="text-center p-4"><div class="flex items-center justify-center h-16 w-16 rounded-full bg-cyan-100 text-cyan-600 mx-auto mb-4 text-3xl">ğŸš€</div><h4 class="font-bold text-lg mb-2">TÄƒng kháº£ nÄƒng pháº£n há»“i</h4><p class="text-gray-600">Giao diá»‡n ngÆ°á»i dÃ¹ng khÃ´ng bá»‹ "Ä‘Æ¡" khi xá»­ lÃ½ cÃ¡c tÃ¡c vá»¥ náº·ng á»Ÿ luá»“ng ná»n.</p></div>
                <div class="text-center p-4"><div class="flex items-center justify-center h-16 w-16 rounded-full bg-cyan-100 text-cyan-600 mx-auto mb-4 text-3xl">ğŸ”„</div><h4 class="font-bold text-lg mb-2">Chia sáº» tÃ i nguyÃªn hiá»‡u quáº£</h4><p class="text-gray-600">CÃ¡c luá»“ng chia sáº» chung bá»™ nhá»›, giÃºp viá»‡c trao Ä‘á»•i dá»¯ liá»‡u trá»Ÿ nÃªn dá»… dÃ ng vÃ  nhanh chÃ³ng.</p></div>
                <div class="text-center p-4"><div class="flex items-center justify-center h-16 w-16 rounded-full bg-cyan-100 text-cyan-600 mx-auto mb-4 text-3xl">ğŸ’°</div><h4 class="font-bold text-lg mb-2">TÃ­nh kinh táº¿</h4><p class="text-gray-600">Táº¡o má»™t luá»“ng tá»‘n Ã­t tÃ i nguyÃªn vÃ  thá»i gian hÆ¡n nhiá»u so vá»›i táº¡o má»™t tiáº¿n trÃ¬nh má»›i.</p></div>
                <div class="text-center p-4"><div class="flex items-center justify-center h-16 w-16 rounded-full bg-cyan-100 text-cyan-600 mx-auto mb-4 text-3xl">âš™ï¸</div><h4 class="font-bold text-lg mb-2">Kháº£ nÄƒng má»Ÿ rá»™ng vÃ  táº­n dá»¥ng pháº§n cá»©ng</h4><p class="text-gray-600">PhÃ¢n chia cÃ´ng viá»‡c cho cÃ¡c luá»“ng cháº¡y song song trÃªn nhiá»u lÃµi CPU Ä‘á»ƒ tÄƒng tá»‘c Ä‘á»™ tÃ­nh toÃ¡n.</p></div>
            </div>
			<div class="mt-4">
				<p class="text-gray-700 mb-2 text-justify"><strong>a) TÄƒng kháº£ nÄƒng pháº£n há»“i (Responsiveness)</strong>: ÄÃ¢y lÃ  lá»£i Ã­ch dá»… nháº­n tháº¥y nháº¥t Ä‘á»‘i vá»›i ngÆ°á»i dÃ¹ng, Ä‘áº·c biá»‡t trong cÃ¡c á»©ng dá»¥ng cÃ³ giao diá»‡n Ä‘á»“ há»a (GUI). Trong má»™t á»©ng dá»¥ng Ä‘Æ¡n luá»“ng, náº¿u má»™t tÃ¡c vá»¥ tá»‘n nhiá»u thá»i gian (vÃ­ dá»¥: táº£i má»™t tá»‡p tin lá»›n tá»« máº¡ng, thá»±c hiá»‡n má»™t truy váº¥n cÆ¡ sá»Ÿ dá»¯ liá»‡u phá»©c táº¡p, hay xá»­ lÃ½ má»™t hÃ¬nh áº£nh lá»›n) Ä‘Æ°á»£c thá»±c thi, toÃ n bá»™ á»©ng dá»¥ng sáº½ bá»‹ "Ä‘Æ¡" hoáº·c "treo". NgÆ°á»i dÃ¹ng khÃ´ng thá»ƒ tÆ°Æ¡ng tÃ¡c vá»›i giao diá»‡n, cá»­a sá»• á»©ng dá»¥ng cÃ³ thá»ƒ chuyá»ƒn sang mÃ u tráº¯ng vÃ  há»‡ Ä‘iá»u hÃ nh bÃ¡o "Not Responding". Äa luá»“ng giáº£i quyáº¿t triá»‡t Ä‘á»ƒ váº¥n Ä‘á» nÃ y. CÃ¡c tÃ¡c vá»¥ náº·ng cÃ³ thá»ƒ Ä‘Æ°á»£c chuyá»ƒn sang má»™t hoáº·c nhiá»u luá»“ng ná»n (background threads). Trong khi Ä‘Ã³, luá»“ng chÃ­nh (main thread), hay cÃ²n gá»i lÃ  luá»“ng giao diá»‡n ngÆ°á»i dÃ¹ng (UI thread), váº«n hoÃ n toÃ n tá»± do Ä‘á»ƒ xá»­ lÃ½ cÃ¡c sá»± kiá»‡n tá»« ngÆ°á»i dÃ¹ng nhÆ° nháº¥p chuá»™t, gÃµ phÃ­m, cuá»™n trang. Äiá»u nÃ y táº¡o ra má»™t tráº£i nghiá»‡m mÆ°á»£t mÃ  vÃ  liá»n máº¡ch, ngay cáº£ khi á»©ng dá»¥ng Ä‘ang thá»±c hiá»‡n nhá»¯ng cÃ´ng viá»‡c phá»©c táº¡p nháº¥t. VÃ­ dá»¥, má»™t trÃ¬nh duyá»‡t web Ä‘a luá»“ng cho phÃ©p báº¡n tiáº¿p tá»¥c cuá»™n vÃ  Ä‘á»c má»™t trang web trong khi cÃ¡c hÃ¬nh áº£nh vÃ  video trÃªn trang Ä‘Ã³ váº«n Ä‘ang Ä‘Æ°á»£c táº£i vá» trong cÃ¡c luá»“ng ná»n.</p>
				<p class="text-gray-700 mb-2 text-justify"><strong>b) Chia sáº» tÃ i nguyÃªn hiá»‡u quáº£ (Resource Sharing)</strong>: Theo máº·c Ä‘á»‹nh, cÃ¡c tiáº¿n trÃ¬nh khÃ´ng chia sáº» bá»™ nhá»›. Náº¿u cáº§n trao Ä‘á»•i dá»¯ liá»‡u, chÃºng pháº£i sá»­ dá»¥ng cÃ¡c cÆ¡ cháº¿ IPC phá»©c táº¡p vÃ  cháº­m cháº¡p do há»‡ Ä‘iá»u hÃ nh cung cáº¥p. NgÆ°á»£c láº¡i, cÃ¡c luá»“ng trong cÃ¹ng má»™t tiáº¿n trÃ¬nh chia sáº» chung khÃ´ng gian bá»™ nhá»› vÃ  tÃ i nguyÃªn. Äiá»u nÃ y cho phÃ©p nhiá»u luá»“ng cÃ³ thá»ƒ lÃ m viá»‡c trÃªn cÃ¹ng má»™t táº­p dá»¯ liá»‡u má»™t cÃ¡ch dá»… dÃ ng vÃ  hiá»‡u quáº£. Viá»‡c chia sáº» mÃ£ vÃ  dá»¯ liá»‡u khÃ´ng chá»‰ giÃºp tiáº¿t kiá»‡m bá»™ nhá»› mÃ  cÃ²n Ä‘Æ¡n giáº£n hÃ³a viá»‡c láº­p trÃ¬nh cÃ¡c tÃ¡c vá»¥ cáº§n sá»± phá»‘i há»£p cháº·t cháº½.</p>
				<p class="text-gray-700 mb-2 text-justify"><strong>c) Hiá»‡u quáº£ vá» chi phÃ­ (Economical)</strong>: NhÆ° Ä‘Ã£ phÃ¢n tÃ­ch, viá»‡c táº¡o ra má»™t tiáº¿n trÃ¬nh lÃ  má»™t hoáº¡t Ä‘á»™ng tá»‘n kÃ©m. Viá»‡c cáº¥p phÃ¡t bá»™ nhá»› vÃ  tÃ i nguyÃªn cho má»—i tiáº¿n trÃ¬nh má»›i tiÃªu tá»‘n Ä‘Ã¡ng ká»ƒ thá»i gian vÃ  tÃ i nguyÃªn há»‡ thá»‘ng. Trong khi Ä‘Ã³, viá»‡c táº¡o má»™t luá»“ng má»›i, do nÃ³ tÃ¡i sá»­ dá»¥ng tÃ i nguyÃªn cá»§a tiáº¿n trÃ¬nh máº¹, láº¡i Ã­t tá»‘n kÃ©m hÆ¡n ráº¥t nhiá»u. Viá»‡c chuyá»ƒn Ä‘á»•i ngá»¯ cáº£nh giá»¯a cÃ¡c luá»“ng cÅ©ng nhanh hÆ¡n Ä‘Ã¡ng ká»ƒ so vá»›i giá»¯a cÃ¡c tiáº¿n trÃ¬nh. Do Ä‘Ã³, trong cÃ¡c á»©ng dá»¥ng cáº§n xá»­ lÃ½ Ä‘á»“ng thá»i hÃ ng trÄƒm hoáº·c hÃ ng ngÃ n tÃ¡c vá»¥ nhá», viá»‡c sá»­ dá»¥ng luá»“ng sáº½ hiá»‡u quáº£ hÆ¡n ráº¥t nhiá»u so vá»›i viá»‡c táº¡o ra hÃ ng trÄƒm hoáº·c hÃ ng ngÃ n tiáº¿n trÃ¬nh.</p>
				<p class="text-gray-700 mb-2 text-justify"><strong>d) Kháº£ nÄƒng má»Ÿ rá»™ng vÃ  táº­n dá»¥ng pháº§n cá»©ng (Scalability)</strong>: ÄÃ¢y lÃ  lá»£i Ã­ch vá» máº·t hiá»‡u nÄƒng tÃ­nh toÃ¡n. TrÃªn má»™t há»‡ thá»‘ng cÃ³ nhiá»u bá»™ xá»­ lÃ½ hoáº·c nhiá»u lÃµi, Ä‘a luá»“ng cho phÃ©p cÃ¡c luá»“ng thá»±c sá»± cháº¡y song song trÃªn cÃ¡c lÃµi khÃ¡c nhau. Má»™t á»©ng dá»¥ng Ä‘Æ¡n luá»“ng chá»‰ cÃ³ thá»ƒ cháº¡y trÃªn má»™t CPU, báº¥t ká»ƒ há»‡ thá»‘ng cÃ³ bao nhiÃªu CPU sáºµn cÃ³. Báº±ng cÃ¡ch chia má»™t cÃ´ng viá»‡c lá»›n thÃ nh nhiá»u tÃ¡c vá»¥ nhá» hÆ¡n vÃ  giao cho cÃ¡c luá»“ng khÃ¡c nhau xá»­ lÃ½, má»™t á»©ng dá»¥ng Ä‘a luá»“ng cÃ³ thá»ƒ hoÃ n thÃ nh cÃ´ng viá»‡c Ä‘Ã³ trong thá»i gian ngáº¯n hÆ¡n nhiá»u. Kháº£ nÄƒng nÃ y Ä‘Æ°á»£c gá»i lÃ  kháº£ nÄƒng má»Ÿ rá»™ng (scalability), vÃ¬ hiá»‡u nÄƒng cá»§a á»©ng dá»¥ng cÃ³ thá»ƒ tÄƒng lÃªn khi Ä‘Æ°á»£c cháº¡y trÃªn pháº§n cá»©ng máº¡nh hÆ¡n (nhiá»u lÃµi hÆ¡n).</p>
            </div>
             
            <div id="models" class="mt-16">
                <h4 class="font-bold text-xl mb-3 text-cyan-700 text-center">3.2. CÃ¡c mÃ´ hÃ¬nh Äa luá»“ng</h4>
                <p class="text-center max-w-3xl mx-auto text-gray-600 mb-12">Má»‘i quan há»‡ Ã¡nh xáº¡ giá»¯a <strong> Luá»“ng ngÆ°á»i dÃ¹ng (User Threads)</strong> vÃ  <strong>Luá»“ng nhÃ¢n (Kernel Threads)</strong> quyáº¿t Ä‘á»‹nh mÃ´ hÃ¬nh Ä‘a luá»“ng cá»§a má»™t há»‡ thá»‘ng.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                    <div class="border p-4 rounded-lg">
						<h5 class="font-semibold text-lg">Many-to-One</h5>
						<p class="text-sm mt-2">Nhiá»u luá»“ng ngÆ°á»i dÃ¹ng Ã¡nh xáº¡ vÃ o má»™t luá»“ng nhÃ¢n. Nhanh nhÆ°ng khÃ´ng táº­n dá»¥ng Ä‘Æ°á»£c Ä‘a lÃµi.</p>
						<img src="https://www.cs.uic.edu/~jbell/CourseNotes/OperatingSystems/images/Chapter4/4_05_ManyToOne.jpg" alt="Minh há»a vá» mÃ´ hÃ¬nh Many-to-One" border="0" style="display: block; margin-left: auto; margin-right: auto; margin-top: 15px;">
					</div>
                    <div class="border p-4 rounded-lg bg-cyan-50 border-cyan-300">
						<h5 class="font-semibold text-lg">One-to-One</h5>
						<p class="text-sm mt-2">Má»—i luá»“ng ngÆ°á»i dÃ¹ng Ã¡nh xáº¡ tá»›i má»™t luá»“ng nhÃ¢n riÃªng biá»‡t. Cho phÃ©p cháº¡y song song.</p>
						<p class="text-sm mt-2"><strong>Phá»• biáº¿n nháº¥t hiá»‡n nay.</strong></p>
						<img src="https://www.cs.uic.edu/~jbell/CourseNotes/OperatingSystems/images/Chapter4/4_06_OneToOne.jpg" alt="Minh há»a vá» mÃ´ hÃ¬nh One-to-One" border="0" style="display: block; margin-left: auto; margin-right: auto; margin-top: 15px;">
					</div>
                    <div class="border p-4 rounded-lg">
						<h5 class="font-semibold text-lg">Many-to-Many</h5>
						<p class="text-sm mt-2">Nhiá»u luá»“ng ngÆ°á»i dÃ¹ng Ã¡nh xáº¡ tá»›i má»™t sá»‘ lÆ°á»£ng luá»“ng nhÃ¢n nhá» hÆ¡n. Linh hoáº¡t nhÆ°ng phá»©c táº¡p.</p>
						<img src="https://www.cs.uic.edu/~jbell/CourseNotes/OperatingSystems/images/Chapter4/4_07_ManyToMany.jpg" alt="Minh há»a vá» mÃ´ hÃ¬nh Many-to-Many" border="0" style="display: block; margin-left: auto; margin-right: auto; margin-top: 15px;">
					</div>
                </div>
            </div>

            <div id="lifecycle" class="mt-16">
                <h4 class="font-bold text-xl mb-3 text-cyan-700 text-center">3.3. VÃ²ng Ä‘á»i cá»§a má»™t Luá»“ng (Thread Lifecycle)</h4>
                <p class="text-center max-w-3xl mx-auto text-gray-600 mb-12">Má»—i luá»“ng tráº£i qua nhiá»u tráº¡ng thÃ¡i khÃ¡c nhau tá»« khi Ä‘Æ°á»£c táº¡o ra cho Ä‘áº¿n khi káº¿t thÃºc. Hiá»ƒu rÃµ vÃ²ng Ä‘á»i nÃ y lÃ  chÃ¬a khÃ³a Ä‘á»ƒ quáº£n lÃ½ vÃ  gá»¡ lá»—i cÃ¡c á»©ng dá»¥ng Ä‘a luá»“ng hiá»‡u quáº£.</p>
                <div id="lifecycle-container" class="w-full max-w-4xl mx-auto flex flex-col items-center gap-y-4">
                    <div id="lifecycle-top-row" class="flex flex-wrap items-center justify-center gap-2 text-center text-sm w-full"></div>
                    <div class="w-full max-w-md h-12 relative">
                        <svg width="100%" height="100%" viewBox="0 0 400 60" preserveAspectRatio="xMidYMid meet" class="absolute top-0 left-0">
                            <defs>
                                <marker id="arrowhead" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
                                    <polygon points="0 0, 6 2, 0 4" fill="#a0aec0"></polygon>
                                </marker>
                            </defs>
                        
                            <path d="M 260 2 L 205 52" stroke="#a0aec0" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)"></path>
                            
                            <path d="M 195 52 L 100 5" stroke="#a0aec0" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)"></path>
                        </svg>
                    </div>
                    <div id="lifecycle-bottom-row" class="flex items-center justify-center"></div>
                 </div>
                <div id="lifecycle-details" class="mt-8 bg-gray-50 p-6 rounded-lg shadow-inner border max-w-2xl mx-auto min-h-[100px]">
					<p class="text-gray-600">Chá»n má»™t tráº¡ng thÃ¡i Ä‘á»ƒ xem mÃ´ táº£.</p>
				</div>
            </div>
        </section>

        <section id="part4" class="py-12">
             <h3 class="text-3xl font-bold text-center mb-2">4. Nhá»¯ng váº¥n Ä‘á» thÆ°á»ng gáº·p trong mÃ´i trÆ°á»ng Ä‘a luá»“ng</h3>
             <p class="text-center max-w-3xl mx-auto text-gray-600 mb-12">Sá»©c máº¡nh cá»§a Ä‘a luá»“ng Ä‘i kÃ¨m vá»›i nhá»¯ng thÃ¡ch thá»©c phá»©c táº¡p. Gá»‘c rá»… cá»§a váº¥n Ä‘á» Ä‘áº¿n tá»« <strong>tráº¡ng thÃ¡i chia sáº» (shared state)</strong> - vÃ¹ng dá»¯ liá»‡u mÃ  nhiá»u luá»“ng cÃ³ thá»ƒ truy cáº­p.</p>
            
            <div class="bg-white rounded-lg shadow-xl p-6 md:p-8">
                <div class="mb-4 border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8" aria-label="Tabs">
						<button id="tab-overall" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg border-cyan-500 text-cyan-600">Tá»•ng quan</button>
                        <button id="tab-race" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">Äiá»u kiá»‡n Tranh cháº¥p (Race Condition)</button>
                        <button id="tab-deadlock" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">KhÃ³a cháº¿t (Deadlock)</button>
                        <button id="tab-other" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">Váº¥n Ä‘á» khÃ¡c</button>
                    </nav>
                </div>
				
				<div id="content-tab-overall" class="mb-4 text-gray-700 text-justify">
					<p class="mb-4"><strong>Tráº¡ng thÃ¡i chia sáº»</strong> lÃ  báº¥t ká»³ vÃ¹ng dá»¯ liá»‡u, biáº¿n, Ä‘á»‘i tÆ°á»£ng, hoáº·c tÃ i nguyÃªn nÃ o (nhÆ° má»™t tá»‡p tin, má»™t káº¿t ná»‘i cÆ¡ sá»Ÿ dá»¯ liá»‡u) cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p hoáº·c sá»­a Ä‘á»•i bá»Ÿi nhiá»u hÆ¡n má»™t luá»“ng. Trong má»™t á»©ng dá»¥ng Ä‘a luá»“ng, Ä‘Ã¢y lÃ  vÃ¹ng bá»™ nhá»› chung mÃ  táº¥t cáº£ cÃ¡c luá»“ng trong cÃ¹ng má»™t tiáº¿n trÃ¬nh Ä‘á»u cÃ³ thá»ƒ "nhÃ¬n tháº¥y" vÃ  "cháº¡m vÃ o".</p>
					<p class="mb-4">Khi má»™t luá»“ng chá»‰ Ä‘á»c dá»¯ liá»‡u tá»« tráº¡ng thÃ¡i chia sáº», thÆ°á»ng khÃ´ng cÃ³ váº¥n Ä‘á» gÃ¬ xáº£y ra. Tuy nhiÃªn, khi cÃ³ Ã­t nháº¥t má»™t luá»“ng cá»‘ gáº¯ng sá»­a Ä‘á»•i (ghi) dá»¯ liá»‡u Ä‘Ã³ trong khi cÃ¡c luá»“ng khÃ¡c cÃ³ thá»ƒ Ä‘ang Ä‘á»c hoáº·c cÅ©ng Ä‘ang ghi, cÃ¡c váº¥n Ä‘á» nghiÃªm trá»ng cÃ³ thá»ƒ phÃ¡t sinh.</p>
					<p>Äá»ƒ quáº£n lÃ½ viá»‡c truy cáº­p nÃ y, chÃºng ta Ä‘á»‹nh nghÄ©a má»™t khÃ¡i niá»‡m gá»i lÃ  <strong>VÃ¹ng gÄƒng (Critical Section)</strong>. ÄÃ¢y lÃ  má»™t Ä‘oáº¡n mÃ£ trong chÆ°Æ¡ng trÃ¬nh thá»±c hiá»‡n viá»‡c truy cáº­p hoáº·c sá»­a Ä‘á»•i tráº¡ng thÃ¡i chia sáº». ThÃ¡ch thá»©c lá»›n nháº¥t trong láº­p trÃ¬nh Ä‘a luá»“ng lÃ  lÃ m tháº¿ nÃ o Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng táº¡i má»™t thá»i Ä‘iá»ƒm, chá»‰ cÃ³ tá»‘i Ä‘a má»™t luá»“ng Ä‘Æ°á»£c phÃ©p thá»±c thi bÃªn trong vÃ¹ng gÄƒng cá»§a nÃ³. NguyÃªn táº¯c nÃ y Ä‘Æ°á»£c gá»i lÃ  loáº¡i trá»« tÆ°Æ¡ng há»— (mutual exclusion).</p>
				</div>
				
                <div id="content-race" class="hidden text-justify">
					<p class="mb-4 text-gray-700"><strong>Äiá»u kiá»‡n tranh cháº¥p (Race Condition)</strong> lÃ  má»™t trong nhá»¯ng lá»—i phá»• biáº¿n vÃ  nguy hiá»ƒm nháº¥t trong láº­p trÃ¬nh Ä‘a luá»“ng. NÃ³ xáº£y ra khi hÃ nh vi hoáº·c káº¿t quáº£ cá»§a má»™t chÆ°Æ¡ng trÃ¬nh phá»¥ thuá»™c vÃ o thá»© tá»± thá»±c thi khÃ´ng thá»ƒ Ä‘oÃ¡n trÆ°á»›c cá»§a cÃ¡c thao tÃ¡c tá»« hai hoáº·c nhiá»u luá»“ng Ä‘ang cáº¡nh tranh Ä‘á»ƒ truy cáº­p cÃ¹ng má»™t tÃ i nguyÃªn chia sáº». Khi cÃ¡c luá»“ng "cháº¡y Ä‘ua" vá»›i nhau Ä‘á»ƒ cáº­p nháº­t dá»¯ liá»‡u, káº¿t quáº£ cuá»‘i cÃ¹ng cÃ³ thá»ƒ hoÃ n toÃ n sai lá»‡ch vÃ  khÃ´ng nháº¥t quÃ¡n.</p>
					
					<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
						<div class="border p-4 rounded-lg bg-gray-100">
							<h4 class="font-semibold text-lg mb-4">VÃ­ dá»¥: Giao dá»‹ch ngÃ¢n hÃ ng</h4>
							<p>Giáº£ sá»­ chÃºng ta cÃ³ má»™t tÃ i khoáº£n ngÃ¢n hÃ ng vá»›i sá»‘ dÆ° ban Ä‘áº§u lÃ  $1,000. Hai giao dá»‹ch xáº£y ra Ä‘á»“ng thá»i:</p>
							<p><span class="font-bold text-red-700">Luá»“ng A (RÃºt tiá»n)</span>: Cá»‘ gáº¯ng rÃºt $100.</p>
							<p class="mb-4"><span class="font-bold text-green-700">Luá»“ng B (Náº¡p tiá»n)</span>: Cá»‘ gáº¯ng náº¡p $200.
							Káº¿t quáº£ mong Ä‘á»£i sau khi cáº£ hai giao dá»‹ch hoÃ n táº¥t lÃ  $1,000 - $100 + $200 = $1,100.</p>
							<p>Tuy nhiÃªn, thao tÃ¡c "cáº­p nháº­t sá»‘ dÆ°" khÃ´ng pháº£i lÃ  má»™t hÃ nh Ä‘á»™ng Ä‘Æ¡n láº», khÃ´ng thá»ƒ chia cáº¯t (atomic). NÃ³ thÆ°á»ng bao gá»“m ba bÆ°á»›c riÃªng biá»‡t:</p>
							<p>1. Äá»c giÃ¡ trá»‹ sá»‘ dÆ° hiá»‡n táº¡i tá»« bá»™ nhá»› vÃ o má»™t thanh ghi cá»§a CPU.</p>
							<p>2. Thá»±c hiá»‡n phÃ©p tÃ­nh (cá»™ng hoáº·c trá»«) trÃªn thanh ghi Ä‘Ã³.</p>
							<p>3. Ghi giÃ¡ trá»‹ má»›i tá»« thanh ghi trá»Ÿ láº¡i bá»™ nhá»›.</p>
						</div>
						<div class="border p-4 rounded-lg bg-gray-100">
							<p class="font-medium mb-2">Sá»‘ dÆ° tÃ i khoáº£n: <span id="counter-value" class="font-bold text-2xl text-cyan-700">1000</span></p>
							<div id="simulation-controls" class="flex items-center gap-2 mb-4">
								<button id="start-step-unsynced" class="flex-grow bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded transition-colors">Báº¯t Ä‘áº§u (KhÃ´ng Ä‘á»“ng bá»™)</button>
								<button id="start-step-synced" class="flex-grow bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition-colors">Báº¯t Ä‘áº§u (CÃ³ Ä‘á»“ng bá»™)</button>
								<button id="run-next-step" class="hidden flex-grow bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition-colors">BÆ°á»›c tiáº¿p theo &rarr;</button>
								<button id="reset-counter" class="hidden bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded transition-colors">Reset</button>
							</div>
							<div id="simulation-log" class="text-sm bg-sky-100 p-2 rounded h-40 overflow-y-auto font-mono">Nháº¥n nÃºt Ä‘á»ƒ mÃ´ phá»ng giao dá»‹ch...<br>Mong Ä‘á»£i: 1000 - 100 + 200 = 1100.</div>
						</div>
					</div>
				
					<p class="mt-4 mb-4 text-gray-700">Káº¿t quáº£ cuá»‘i cÃ¹ng lÃ  <strong>$900</strong>. Giao dá»‹ch náº¡p tiá»n $200 cá»§a Luá»“ng B Ä‘Ã£ hoÃ n toÃ n bá»‹ "máº¥t". Náº¿u thá»© tá»± thá»±c thi hÆ¡i khÃ¡c má»™t chÃºt, káº¿t quáº£ cuá»‘i cÃ¹ng cÃ³ thá»ƒ lÃ  $1,200 (giao dá»‹ch rÃºt tiá»n bá»‹ máº¥t). Cáº£ hai káº¿t quáº£ Ä‘á»u sai. ÄÃ¢y chÃ­nh lÃ  sá»± <strong>khÃ´ng nháº¥t quÃ¡n dá»¯ liá»‡u (Data Inconsistency)</strong> gÃ¢y ra bá»Ÿi race condition.</p>
					<p class="mb-4 text-gray-700">Báº£n cháº¥t cá»§a race condition khiáº¿n nÃ³ trá»Ÿ thÃ nh má»™t loáº¡i lá»—i logic <strong>"áº©n"</strong>, cá»±c ká»³ khÃ³ phÃ¡t hiá»‡n vÃ  tÃ¡i táº¡o. KhÃ´ng giá»‘ng nhÆ° cÃ¡c lá»—i rÃµ rÃ ng nhÆ° chia cho khÃ´ng, race condition khÃ´ng pháº£i lÃºc nÃ o cÅ©ng xáº£y ra. NÃ³ phá»¥ thuá»™c hoÃ n toÃ n vÃ o má»™t chuá»—i sá»± kiá»‡n "khÃ´ng may máº¯n" trong viá»‡c láº­p lá»‹ch cá»§a há»‡ Ä‘iá»u hÃ nh, vá»‘n bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi nhiá»u yáº¿u tá»‘ nhÆ° táº£i há»‡ thá»‘ng, sá»‘ lÆ°á»£ng lÃµi CPU, vÃ  thá»i gian thá»±c thi cá»§a cÃ¡c tÃ¡c vá»¥ khÃ¡c. Má»™t chÆ°Æ¡ng trÃ¬nh cÃ³ thá»ƒ cháº¡y Ä‘Ãºng 100 láº§n trong mÃ´i trÆ°á»ng thá»­ nghiá»‡m (QA) nhÆ°ng láº¡i gáº·p lá»—i ngay trong láº§n cháº¡y Ä‘áº§u tiÃªn trÃªn mÃ´i trÆ°á»ng sáº£n pháº©m (production) chá»‰ vÃ¬ sá»± khÃ¡c biá»‡t vá» táº£i.</p>
					<p class="mb-4 text-gray-700">Äiá»u nÃ y lÃ m cho viá»‡c <strong>gá»¡ lá»—i (debugging)</strong> trá»Ÿ nÃªn vÃ´ cÃ¹ng khÃ³ khÄƒn. Viá»‡c sá»­ dá»¥ng cÃ¡c cÃ´ng cá»¥ gá»¡ lá»—i truyá»n thá»‘ng nhÆ° Ä‘áº·t Ä‘iá»ƒm dá»«ng (breakpoints) cÃ³ thá»ƒ lÃ m thay Ä‘á»•i hoÃ n toÃ n thá»© tá»± vÃ  thá»i gian thá»±c thi cá»§a cÃ¡c luá»“ng, khiáº¿n cho lá»—i khÃ´ng cÃ²n tÃ¡i hiá»‡n Ä‘Æ°á»£c ná»¯a. Do Ä‘Ã³, cÃ¡ch tiáº¿p cáº­n hiá»‡u quáº£ nháº¥t khÃ´ng pháº£i lÃ  "sÄƒn lÃ¹ng" vÃ  sá»­a chá»¯a cÃ¡c race condition Ä‘Ã£ xáº£y ra, mÃ  lÃ  thiáº¿t káº¿ há»‡ thá»‘ng má»™t cÃ¡ch phÃ²ng ngá»«a. Báº±ng cÃ¡ch sá»­ dá»¥ng cÃ¡c cÆ¡ cháº¿ Ä‘á»“ng bá»™ hÃ³a (sáº½ Ä‘Æ°á»£c tháº£o luáº­n trong <strong>Pháº§n 5</strong>), chÃºng ta cÃ³ thá»ƒ loáº¡i bá» hoÃ n toÃ n kháº£ nÄƒng xáº£y ra race condition ngay tá»« Ä‘áº§u, Ä‘áº£m báº£o tÃ­nh Ä‘Ãºng Ä‘áº¯n cá»§a chÆ°Æ¡ng trÃ¬nh trong má»i ká»‹ch báº£n thá»±c thi.</p>
				</div>
				
                <div id="content-deadlock" class="hidden">
					<p class="mb-4 text-gray-700"><strong>KhÃ³a cháº¿t (Deadlock)</strong> lÃ  má»™t tÃ¬nh huá»‘ng báº¿ táº¯c trong Ä‘Ã³ hai hoáº·c nhiá»u luá»“ng bá»‹ cháº·n vÃ´ thá»i háº¡n, má»—i luá»“ng Ä‘ang chá» má»™t tÃ i nguyÃªn mÃ  má»™t luá»“ng khÃ¡c trong nhÃ³m Ä‘ang giá»¯.  Khi deadlock xáº£y ra, cÃ¡c luá»“ng liÃªn quan sáº½ ngá»«ng hoáº¡t Ä‘á»™ng vÄ©nh viá»…n, thÆ°á»ng dáº«n Ä‘áº¿n viá»‡c chÆ°Æ¡ng trÃ¬nh bá»‹ treo.</p>
					<p class="mb-4">Äá»ƒ má»™t deadlock xáº£y ra, bá»‘n Ä‘iá»u kiá»‡n sau Ä‘Ã¢y, Ä‘Æ°á»£c gá»i lÃ  <strong>Ä‘iá»u kiá»‡n Coffman</strong>, pháº£i Ä‘Æ°á»£c thá»a mÃ£n Ä‘á»“ng thá»i :</p>
					<p><strong>1. Mutual Exclusion (Loáº¡i trá»« tÆ°Æ¡ng há»—)</strong>: Ãt nháº¥t má»™t tÃ i nguyÃªn pháº£i á»Ÿ tráº¡ng thÃ¡i khÃ´ng thá»ƒ chia sáº». Tá»©c lÃ , táº¡i má»™t thá»i Ä‘iá»ƒm, chá»‰ cÃ³ má»™t luá»“ng Ä‘Æ°á»£c phÃ©p sá»­ dá»¥ng tÃ i nguyÃªn Ä‘Ã³.</p>
					<p><strong>2. Hold and Wait (Giá»¯ vÃ  chá»)</strong>: Má»™t luá»“ng pháº£i Ä‘ang giá»¯ Ã­t nháº¥t má»™t tÃ i nguyÃªn vÃ  Ä‘á»“ng thá»i yÃªu cáº§u thÃªm cÃ¡c tÃ i nguyÃªn khÃ¡c Ä‘ang bá»‹ cÃ¡c luá»“ng khÃ¡c giá»¯.</p>
					<p><strong>3. No Preemption (KhÃ´ng thu há»“i)</strong>: TÃ i nguyÃªn khÃ´ng thá»ƒ bá»‹ thu há»“i má»™t cÃ¡ch cÆ°á»¡ng bá»©c tá»« luá»“ng Ä‘ang giá»¯ nÃ³. Má»™t tÃ i nguyÃªn chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c giáº£i phÃ³ng má»™t cÃ¡ch tá»± nguyá»‡n bá»Ÿi luá»“ng Ä‘ang giá»¯ nÃ³ sau khi luá»“ng Ä‘Ã³ Ä‘Ã£ hoÃ n thÃ nh cÃ´ng viá»‡c.</p>
					<p class="mb-4"><strong>4. Circular Wait (Chá» Ä‘á»£i vÃ²ng trÃ²n)</strong>: Tá»“n táº¡i má»™t chuá»—i cÃ¡c luá»“ng Ä‘ang chá» Ä‘á»£i {T<sub>0</sub>, T<sub>1</sub>,..., T<sub>n</sub>} sao cho T<sub>0</sub> Ä‘ang chá» má»™t tÃ i nguyÃªn do T<sub>1</sub> giá»¯, T<sub>1</sub> Ä‘ang chá» má»™t tÃ i nguyÃªn do T<sub>2</sub> giá»¯,..., vÃ  Tn Ä‘ang chá» má»™t tÃ i nguyÃªn do T<sub>0</sub> giá»¯, táº¡o thÃ nh má»™t chu ká»³ khÃ©p kÃ­n.</p>
					<h4 class="font-semibold text-lg mb-4">VÃ­ dá»¥ mÃ´ phá»ng: BÃ i toÃ¡n cÃ¡c Triáº¿t gia Äƒn tá»‘i (Dining Philosophers Problem)</h4>
					<p class="mb-4">CÃ³ nÄƒm triáº¿t gia ngá»“i quanh má»™t chiáº¿c bÃ n trÃ²n. TrÆ°á»›c máº·t má»—i ngÆ°á»i lÃ  má»™t Ä‘Ä©a má»³ spaghetti. Giá»¯a má»—i cáº·p triáº¿t gia liá»n ká» cÃ³ má»™t chiáº¿c nÄ©a. Tá»•ng cá»™ng cÃ³ nÄƒm triáº¿t gia vÃ  nÄƒm chiáº¿c nÄ©a. CÃ¡c triáº¿t gia luÃ¢n phiÃªn giá»¯a hai tráº¡ng thÃ¡i: suy nghÄ© vÃ  Äƒn. Äá»ƒ Äƒn Ä‘Æ°á»£c má»³, má»™t triáº¿t gia cáº§n pháº£i cÃ³ cáº£ hai chiáº¿c nÄ©a: chiáº¿c bÃªn trÃ¡i vÃ  chiáº¿c bÃªn pháº£i cá»§a mÃ¬nh.</p>
					<p><strong>Ká»‹ch báº£n Deadlock</strong>: HÃ£y tÆ°á»Ÿng tÆ°á»£ng má»™t ká»‹ch báº£n mÃ  má»—i triáº¿t gia Ä‘á»u tuÃ¢n theo má»™t thuáº­t toÃ¡n Ä‘Æ¡n giáº£n:</p>
					<p>1. Suy nghÄ© má»™t lÃºc.</p>
					<p>2. Khi Ä‘Ã³i, cáº§m chiáº¿c nÄ©a bÃªn trÃ¡i cá»§a mÃ¬nh.</p>
					<p>3. Sau Ä‘Ã³, cáº§m chiáº¿c nÄ©a bÃªn pháº£i cá»§a mÃ¬nh.<p>
					<p>4. Ä‚n.</p>
					<p>5. Äáº·t cáº£ hai chiáº¿c nÄ©a xuá»‘ng.</p>
					<p class="mb-4">Náº¿u táº¥t cáº£ nÄƒm triáº¿t gia cÃ¹ng lÃºc cáº£m tháº¥y Ä‘Ã³i vÃ  Ä‘á»“ng thá»i thá»±c hiá»‡n bÆ°á»›c 2 (cáº§m chiáº¿c nÄ©a bÃªn trÃ¡i), thÃ¬ má»—i triáº¿t gia sáº½ giá»¯ má»™t chiáº¿c nÄ©a. BÃ¢y giá», táº¥t cáº£ há» sáº½ chuyá»ƒn sang bÆ°á»›c 3 vÃ  cá»‘ gáº¯ng cáº§m chiáº¿c nÄ©a bÃªn pháº£i. Tuy nhiÃªn, chiáº¿c nÄ©a bÃªn pháº£i cá»§a má»—i ngÆ°á»i láº¡i chÃ­nh lÃ  chiáº¿c nÄ©a bÃªn trÃ¡i cá»§a ngÆ°á»i hÃ ng xÃ³m, vÃ  nÃ³ Ä‘Ã£ bá»‹ cáº§m máº¥t. Do Ä‘Ã³, táº¥t cáº£ nÄƒm triáº¿t gia sáº½ ngá»“i chá» Ä‘á»£i vÄ©nh viá»…n chiáº¿c nÄ©a thá»© hai, khÃ´ng ai cÃ³ thá»ƒ Äƒn vÃ  cÅ©ng khÃ´ng ai chá»‹u nháº£ chiáº¿c nÄ©a mÃ¬nh Ä‘ang cáº§m ra. ÄÃ¢y lÃ  má»™t tÃ¬nh huá»‘ng deadlock hoÃ n háº£o, thá»a mÃ£n cáº£ <strong>bá»‘n Ä‘iá»u kiá»‡n Coffman</strong>.</p>

				
					<div class="flex flex-col items-center">
						<div id="deadlock-circle"></div>
						<div class="flex space-x-2 mt-4"> 
							<button id="run-deadlock-step" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded transition-colors mb-2">Cháº¡y</button>
							<button id="reset-deadlock" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded transition-colors mb-2">Reset</button>
						</div>
						<p id="deadlock-status" class="text-lg font-medium h-8 text-center"></p>
					</div>
					
					<div class="border p-4 rounded-lg bg-gray-50 mt-6">
					<h5 class="font-semibold mb-2">Giáº£i phÃ¡p 1: PhÃ¢n cáº¥p tÃ i nguyÃªn (Resource Hierarchy) </h5><p class="text-sm mb-2">PhÃ¡ vá»¡ Ä‘iá»u kiá»‡n Chá» Ä‘á»£i vÃ²ng trÃ²n: Má»™t giáº£i phÃ¡p thanh lá»‹ch lÃ  Ä‘Ã¡nh sá»‘ cÃ¡c chiáº¿c nÄ©a tá»« 1 Ä‘áº¿n 5. Sau Ä‘Ã³, Ä‘áº·t ra má»™t quy táº¯c: má»—i triáº¿t gia pháº£i luÃ´n cá»‘ gáº¯ng cáº§m chiáº¿c nÄ©a cÃ³ sá»‘ hiá»‡u nhá» hÆ¡n trÆ°á»›c, sau Ä‘Ã³ má»›i Ä‘áº¿n chiáº¿c nÄ©a cÃ³ sá»‘ hiá»‡u lá»›n hÆ¡n. Vá»›i quy táº¯c nÃ y, bá»‘n triáº¿t gia Ä‘áº§u tiÃªn (1 Ä‘áº¿n 4) sáº½ cáº§m chiáº¿c nÄ©a bÃªn trÃ¡i cá»§a há» (tÆ°Æ¡ng á»©ng lÃ  nÄ©a 1, 2, 3, 4). Tuy nhiÃªn, triáº¿t gia thá»© nÄƒm, ngá»“i giá»¯a nÄ©a 5 vÃ  nÄ©a 1, sáº½ pháº£i cá»‘ gáº¯ng cáº§m nÄ©a 1 trÆ°á»›c. NhÆ°ng nÄ©a 1 Ä‘Ã£ bá»‹ triáº¿t gia Ä‘áº§u tiÃªn cáº§m. Do Ä‘Ã³, triáº¿t gia thá»© nÄƒm sáº½ bá»‹ cháº·n ngay tá»« Ä‘áº§u, khÃ´ng thá»ƒ cáº§m Ä‘Æ°á»£c chiáº¿c nÄ©a nÃ o. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  chiáº¿c nÄ©a 5 váº«n cÃ²n tá»± do. Triáº¿t gia thá»© tÆ°, sau khi Ä‘Ã£ cáº§m Ä‘Æ°á»£c nÄ©a 4, sáº½ cÃ³ thá»ƒ cáº§m tiáº¿p nÄ©a 5 vÃ  báº¯t Ä‘áº§u Äƒn. Sau khi Äƒn xong, Ã´ng ta sáº½ nháº£ cáº£ hai nÄ©a ra, cho phÃ©p cÃ¡c triáº¿t gia khÃ¡c tiáº¿p tá»¥c. Báº±ng cÃ¡ch Ã¡p Ä‘áº·t má»™t thá»© tá»±, chÃºng ta Ä‘Ã£ phÃ¡ vá»¡ chu ká»³ chá» Ä‘á»£i.</p>
					<h5 class="font-semibold mb-2">Giáº£i phÃ¡p 2: NgÆ°á»i phá»¥c vá»¥ (Arbitrator/Waiter)</h5><p class="text-sm mb-2">PhÃ¡ vá»¡ Ä‘iá»u kiá»‡n Giá»¯ vÃ  chá»: Má»™t giáº£i phÃ¡p khÃ¡c lÃ  giá»›i thiá»‡u má»™t "ngÆ°á»i phá»¥c vá»¥" (cÃ³ thá»ƒ Ä‘Æ°á»£c hiá»‡n thá»±c hÃ³a báº±ng má»™t khÃ³a duy nháº¥t, gá»i lÃ  mutex). TrÆ°á»›c khi cáº§m báº¥t ká»³ chiáº¿c nÄ©a nÃ o, má»™t triáº¿t gia pháº£i xin phÃ©p ngÆ°á»i phá»¥c vá»¥. NgÆ°á»i phá»¥c vá»¥ chá»‰ cho phÃ©p má»™t triáº¿t gia cáº§m nÄ©a táº¡i má»™t thá»i Ä‘iá»ƒm. Sau khi triáº¿t gia Ä‘Ã³ Ä‘Ã£ láº¥y Ä‘á»§ cáº£ hai nÄ©a vÃ  Äƒn xong, Ã´ng ta sáº½ bÃ¡o cho ngÆ°á»i phá»¥c vá»¥ biáº¿t. Báº±ng cÃ¡ch nÃ y, chÃºng ta Ä‘áº£m báº£o khÃ´ng bao giá» xáº£y ra tÃ¬nh huá»‘ng má»™t triáº¿t gia "giá»¯" má»™t nÄ©a vÃ  "chá»" nÄ©a cÃ²n láº¡i, vÃ¬ viá»‡c láº¥y cáº£ hai nÄ©a Ä‘Æ°á»£c coi lÃ  má»™t hÃ nh Ä‘á»™ng nguyÃªn tá»­ dÆ°á»›i sá»± giÃ¡m sÃ¡t cá»§a ngÆ°á»i phá»¥c vá»¥.</p>
					</div>
				</div>
                
				<div id="content-other" class="hidden">
					<div class="grid md:grid-cols-2 gap-6">
						<div class="bg-rose-50 border border-rose-200 p-4 rounded-lg">
							<h5 class="font-semibold text-lg">Starvation (Cháº¿t Ä‘Ã³i)</h5>
							<p class="text-gray-700 mt-2">ÄÃ¢y lÃ  tÃ¬nh huá»‘ng má»™t luá»“ng khÃ´ng bao giá» Ä‘Æ°á»£c cáº¥p phÃ¡t cÃ¡c tÃ i nguyÃªn cáº§n thiáº¿t Ä‘á»ƒ thá»±c thi, máº·c dÃ¹ cÃ¡c tÃ i nguyÃªn Ä‘Ã³ váº«n Ä‘Æ°á»£c cáº¥p phÃ¡t cho cÃ¡c luá»“ng khÃ¡c. Luá»“ng Ä‘Ã³ bá»‹ "bá» Ä‘Ã³i" vÃ  khÃ´ng thá»ƒ tiáº¿n triá»ƒn. Äiá»u nÃ y thÆ°á»ng xáº£y ra trong cÃ¡c há»‡ thá»‘ng cÃ³ cÆ¡ cháº¿ Æ°u tiÃªn. Náº¿u cÃ¡c luá»“ng cÃ³ Ä‘á»™ Æ°u tiÃªn cao liÃªn tá»¥c xuáº¥t hiá»‡n vÃ  chiáº¿m dá»¥ng CPU hoáº·c tÃ i nguyÃªn, má»™t luá»“ng cÃ³ Ä‘á»™ Æ°u tiÃªn tháº¥p cÃ³ thá»ƒ khÃ´ng bao giá» cÃ³ cÆ¡ há»™i Ä‘Æ°á»£c cháº¡y.</p>
						</div>
						<div class="bg-indigo-50 border border-indigo-200 p-4 rounded-lg">
							<h5 class="font-semibold text-lg">Priority Inversion (Äáº£o ngÆ°á»£c Æ¯u tiÃªn)</h5>
							<p class="text-gray-700 mt-2">Má»™t luá»“ng cÃ³ Ä‘á»™ Æ°u tiÃªn tháº¥p Ä‘ang giá»¯ má»™t tÃ i nguyÃªn mÃ  luá»“ng cÃ³ Ä‘á»™ Æ°u tiÃªn cao cáº§n, nhÆ°ng láº¡i bá»‹ má»™t luá»“ng cÃ³ Ä‘á»™ Æ°u tiÃªn trung bÃ¬nh chiáº¿m quyá»n thá»±c thi, khiáº¿n luá»“ng Æ°u tiÃªn cao pháº£i chá» Ä‘á»£i má»™t cÃ¡ch vÃ´ lÃ½.</p>
						</div>
					</div>
				</div>
            </div>
        </section>
        
        <section id="part5" class="py-12 bg-white rounded-lg shadow-xl my-12 p-6 md:p-8">
			<h3 class="text-3xl font-bold text-center mb-2">5. CÃ¡c cÆ¡ cháº¿ Äá»“ng bá»™ hÃ³a</h3>
			<p class="text-center max-w-3xl mx-auto text-gray-600 mb-12">Äá»ƒ giáº£i quyáº¿t cÃ¡c thÃ¡ch thá»©c Ä‘Ã£ nÃªu, cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh vÃ  há»‡ Ä‘iá»u hÃ nh cung cáº¥p má»™t bá»™ cÃ´ng cá»¥ máº¡nh máº½ gá»i lÃ  cÃ¡c <strong>cÆ¡ cháº¿ Ä‘á»“ng bá»™ hÃ³a (synchronization primitives)</strong>. Viá»‡c lá»±a chá»n vÃ  sá»­ dá»¥ng Ä‘Ãºng cÃ´ng cá»¥ cho tá»«ng váº¥n Ä‘á» lÃ  ká»¹ nÄƒng cá»‘t lÃµi cá»§a má»™t láº­p trÃ¬nh viÃªn Ä‘a luá»“ng.</p>

			<div class="border-t pt-8 mt-8 text-justify">
				<h4 class="font-bold text-2xl mb-3 text-cyan-700">5.1. Mutex (Mutual Exclusion)</h4>
				<p class="mb-4"><strong>Mutex</strong> lÃ  cÆ¡ cháº¿ khÃ³a cÆ¡ báº£n vÃ  phá»• biáº¿n nháº¥t, Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ thá»±c thi nguyÃªn táº¯c <strong>loáº¡i trá»« tÆ°Æ¡ng há»— (mutual exclusion)</strong>. TÃªn cá»§a nÃ³ lÃ  viáº¿t táº¯t cá»§a <strong>"Mutual Exclusion"</strong>. Má»™t mutex cÃ³ thá»ƒ Ä‘Æ°á»£c hÃ¬nh dung nhÆ° <strong>má»™t chiáº¿c chÃ¬a khÃ³a</strong> cá»§a má»™t cÄƒn phÃ²ng (vÃ¹ng gÄƒng). TrÆ°á»›c khi vÃ o phÃ²ng, má»™t luá»“ng pháº£i láº¥y Ä‘Æ°á»£c chÃ¬a khÃ³a. Chá»‰ cÃ³ má»™t chiáº¿c chÃ¬a khÃ³a duy nháº¥t, vÃ¬ váº­y táº¡i má»™t thá»i Ä‘iá»ƒm chá»‰ cÃ³ má»™t luá»“ng cÃ³ thá»ƒ á»Ÿ trong phÃ²ng. CÃ¡c luá»“ng khÃ¡c Ä‘áº¿n sau sáº½ pháº£i xáº¿p hÃ ng Ä‘á»£i bÃªn ngoÃ i cho Ä‘áº¿n khi luá»“ng bÃªn trong ra ngoÃ i vÃ  tráº£ láº¡i chÃ¬a khÃ³a.</p>
				<p><strong>CÃ¡ch hoáº¡t Ä‘á»™ng:</strong> Má»™t mutex cÃ³ hai tráº¡ng thÃ¡i cÆ¡ báº£n: Ä‘Ã£ khÃ³a (locked) vÃ  chÆ°a khÃ³a (unlocked).</p>
				
				<ul class="list-disc list-inside space-y-1 text-gray-700 mb-4">
					<li><code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">lock()</code>: Má»™t luá»“ng gá»i hÃ m nÃ y Ä‘á»ƒ yÃªu cáº§u quyá»n sá»Ÿ há»¯u mutex. Náº¿u mutex Ä‘ang á»Ÿ tráº¡ng thÃ¡i chÆ°a khÃ³a, luá»“ng Ä‘Ã³ sáº½ khÃ³a nÃ³ láº¡i vÃ  tiáº¿p tá»¥c thá»±c thi vÃ¹ng gÄƒng. Náº¿u mutex Ä‘Ã£ bá»‹ má»™t luá»“ng khÃ¡c khÃ³a, luá»“ng gá»i lock() sáº½ bá»‹ cháº·n (blocked) vÃ  Ä‘Æ°a vÃ o hÃ ng Ä‘á»£i cho Ä‘áº¿n khi mutex Ä‘Æ°á»£c giáº£i phÃ³ng.</li>
					<li><code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">unlock()</code>: Sau khi hoÃ n thÃ nh cÃ´ng viá»‡c trong vÃ¹ng gÄƒng, luá»“ng pháº£i gá»i hÃ m nÃ y Ä‘á»ƒ giáº£i phÃ³ng mutex, Ä‘Æ°a nÃ³ vá» tráº¡ng thÃ¡i chÆ°a khÃ³a vÃ  cho phÃ©p má»™t luá»“ng khÃ¡c trong hÃ ng Ä‘á»£i cÃ³ thá»ƒ chiáº¿m há»¯u nÃ³.</li>
				</ul>
				
				<p><strong>HÆ°á»›ng dáº«n trong C++:</strong></p>
				<p class="mb-4">ThÆ° viá»‡n chuáº©n C++ cung cáº¥p <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::mutex</code> trong header <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">&lt;mutex&gt;</code>. Tuy nhiÃªn, viá»‡c sá»­ dá»¥ng trá»±c tiáº¿p <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">lock()</code> vÃ  <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">unlock()</code> thá»§ cÃ´ng tiá»m áº©n nhiá»u rá»§i ro. Náº¿u má»™t ngoáº¡i lá»‡ (exception) xáº£y ra bÃªn trong vÃ¹ng gÄƒng, cÃ¢u lá»‡nh <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">unlock()</code> cÃ³ thá»ƒ bá»‹ bá» qua, khiáº¿n mutex bá»‹ khÃ³a vÄ©nh viá»…n vÃ  gÃ¢y ra deadlock.</p>
				<p>Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y, C++ khuyáº¿n khÃ­ch sá»­ dá»¥ng máº«u thiáº¿t káº¿ RAII (Resource Acquisition Is Initialization). Hai lá»›p <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::lock_guard</code> vÃ  <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::unique_lock</code> Ä‘Æ°á»£c cung cáº¥p Ä‘á»ƒ tá»± Ä‘á»™ng quáº£n lÃ½ vÃ²ng Ä‘á»i cá»§a mutex:</p>
				<ul class="list-disc list-inside space-y-1 text-gray-700 mb-4">
					<li><code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::lock_guard</code>: LÃ  lá»±a chá»n Ä‘Æ¡n giáº£n vÃ  hiá»‡u quáº£ nháº¥t. Khi má»™t Ä‘á»‘i tÆ°á»£ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::lock_guard</code> Ä‘Æ°á»£c táº¡o, nÃ³ sáº½ tá»± Ä‘á»™ng gá»i <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">lock()</code> trÃªn mutex Ä‘Æ°á»£c cung cáº¥p. Khi Ä‘á»‘i tÆ°á»£ng nÃ y ra khá»i pháº¡m vi (scope), hÃ m há»§y cá»§a nÃ³ sáº½ tá»± Ä‘á»™ng gá»i <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">unlock()</code>. Äiá»u nÃ y Ä‘áº£m báº£o mutex luÃ´n Ä‘Æ°á»£c giáº£i phÃ³ng má»™t cÃ¡ch an toÃ n, ngay cáº£ khi cÃ³ exception.</li>
					<li><code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::unique_lock</code>: Linh hoáº¡t hÆ¡n <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::lock_guard</code> nhÆ°ng cÅ©ng phá»©c táº¡p vÃ  cÃ³ chi phÃ­ cao hÆ¡n má»™t chÃºt. NÃ³ cho phÃ©p cÃ¡c thao tÃ¡c nÃ¢ng cao nhÆ° khÃ³a vÃ  má»Ÿ khÃ³a má»™t cÃ¡ch tÆ°á»ng minh, thá»­ khÃ³a mÃ  khÃ´ng bá»‹ cháº·n (try_lock), vÃ  chuyá»ƒn quyá»n sá»Ÿ há»¯u khÃ³a. NÃ³ Ä‘áº·c biá»‡t cáº§n thiáº¿t khi sá»­ dá»¥ng vá»›i biáº¿n Ä‘iá»u kiá»‡n (condition variables).</li>
				</ul>

				
				<h5 class="font-semibold text-lg text-cyan-700">VÃ­ dá»¥ 1:</h5>
				<p class="mb-4 text-gray-700">HÃ£y xem láº¡i váº¥n Ä‘á» race condition vá»›i biáº¿n Ä‘áº¿m.</p>
        
				<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
					<div class="code-container">
						<p class="font-medium mb-2">MÃ£ bá»‹ lá»—i (Race Condition):</p>
						<div class="code-block" data-example-id="race-condition-error">
<pre><code><span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;iostream&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;thread&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;vector&gt;</span>

<span style="color: #d19a66;">long long</span> counter = <span style="color: #d19a66;">0</span>;

<span style="color: #c678dd;">void</span> <span style="color: #61afef;">increment</span>() {
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">100000</span>; ++i) {
        counter++; <span style="color: #e06c75;">// Thao tÃ¡c nÃ y khÃ´ng nguyÃªn tá»­</span>
    }
}

<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    std::vector&lt;std::thread&gt; threads;
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">10</span>; ++i) {
        threads.push_back(std::thread(increment));
    }

    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">auto</span>&amp; th : threads) {
        th.join();
    }

    std::cout &lt;&lt; <span style="color: #98c379;">"Final counter: "</span> &lt;&lt; counter &lt;&lt; std::endl; <span style="color: #5c6370;">// Káº¿t quáº£ thÆ°á»ng &lt; 1,000,000</span>
    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}
</code></pre>
						</div>
						<div class="explanation-panel hidden mt-4 border-l-4 border-sky-500 bg-sky-50 p-4 rounded-r-lg text-gray-700">
							<h6 class="font-bold text-lg mb-2 text-sky-800">Giáº£i thÃ­ch Lá»—i</h6>
							<p class="mb-2">Äoáº¡n code nÃ y táº¡o ra 10 luá»“ng, má»—i luá»“ng cá»‘ gáº¯ng tÄƒng biáº¿n <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">counter</code> lÃªn 100,000 láº§n. Tuy nhiÃªn, do khÃ´ng cÃ³ cÆ¡ cháº¿ báº£o vá»‡, cÃ¡c luá»“ng sáº½ "giáº«m chÃ¢n" lÃªn nhau, gÃ¢y ra máº¥t mÃ¡t dá»¯ liá»‡u.</p>
							<p class="mb-2">Váº¥n Ä‘á» náº±m á»Ÿ dÃ²ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">counter++</code>. DÃ¹ trÃ´ng cÃ³ váº» Ä‘Æ¡n giáº£n, vá»›i CPU nÃ³ thá»±c cháº¥t lÃ  má»™t chuá»—i 3 bÆ°á»›c:</p>
							<ol class="list-decimal list-inside space-y-1 mb-2 ml-4">
								<li><strong>Äá»c (Read):</strong> Äá»c giÃ¡ trá»‹ hiá»‡n táº¡i cá»§a <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">counter</code> tá»« bá»™ nhá»› vÃ o má»™t thanh ghi.</li>
								<li><strong>Sá»­a (Modify):</strong> TÄƒng giÃ¡ trá»‹ trong thanh ghi lÃªn 1.]</li>
								<li><strong>Ghi (Write):</strong> Ghi giÃ¡ trá»‹ má»›i tá»« thanh ghi trá»Ÿ láº¡i vÃ o biáº¿n <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">counter</code> trong bá»™ nhá»›.</li>
							</ol>
							<p class="mb-2">TÃ¬nh huá»‘ng tranh cháº¥p (<strong>Race Condition</strong>) xáº£y ra nhÆ° sau:</p>
							<ol class="list-decimal list-inside space-y-1 mb-2 ml-4">
								<li>Luá»“ng A Ä‘á»c <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">counter</code> (giáº£ sá»­ lÃ  50). </li>
								<li>Há»‡ Ä‘iá»u hÃ nh ngáº¯t quÃ£ng Luá»“ng A vÃ  chuyá»ƒn sang Luá»“ng B.</li>
								<li>Luá»“ng B cÅ©ng Ä‘á»c <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">counter</code> (váº«n lÃ  50).</li>
								<li>Luá»“ng B tÄƒng giÃ¡ trá»‹ Ä‘á»c Ä‘Æ°á»£c lÃªn 51 vÃ  ghi 51 vÃ o <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">counter</code>.</li>
								<li>Há»‡ Ä‘iá»u hÃ nh chuyá»ƒn láº¡i cho Luá»“ng A.</li>
								<li>Luá»“ng A khÃ´ng biáº¿t giÃ¡ trá»‹ Ä‘Ã£ bá»‹ thay Ä‘á»•i, nÃ³ tiáº¿p tá»¥c tá»« bÆ°á»›c cá»§a mÃ¬nh, tÄƒng giÃ¡ trá»‹ nÃ³ Ä‘Ã£ Ä‘á»c (50) lÃªn 51 vÃ  cÅ©ng ghi 51 vÃ o <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">counter</code>.</li>
							</ol>
							<p><strong>Káº¿t quáº£:</strong> Cáº£ hai luá»“ng Ä‘á»u Ä‘Ã£ thá»±c thi, nhÆ°ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">counter</code> chá»‰ tÄƒng lÃªn 1 láº§n. Má»™t láº§n tÄƒng Ä‘Ã£ bá»‹ "máº¥t". Vá»›i 10 luá»“ng cháº¡y song song, viá»‡c nÃ y xáº£y ra liÃªn tá»¥c, dáº«n Ä‘áº¿n káº¿t quáº£ cuá»‘i cÃ¹ng tháº¥p hÆ¡n nhiá»u so vá»›i 1,000,000.</p>
						</div>
					</div>
					<div class="code-container">
						<p class="font-medium mb-2">MÃ£ Ä‘Ã£ Ä‘Æ°á»£c sá»­a báº±ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::mutex</code> vÃ  <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::lock_guard</code>:</p>
						<div class="code-block" data-example-id="mutex-fix">
<pre><code><span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;iostream&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;thread&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;vector&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;mutex&gt;</span>

<span style="color: #d19a66;">long long</span> counter = <span style="color: #d19a66;">0</span>;
std::mutex mtx; <span style="color: #5c6370;">// Khai bÃ¡o mutex</span>

<span style="color: #c678dd;">void</span> <span style="color: #61afef;">increment_safe</span>() {
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">100000</span>; ++i) {
        <span style="color: #98c379;">std::lock_guard&lt;std::mutex&gt; lock(mtx);</span> <span style="color: #5c6370;">// KhÃ³a mutex trong scope nÃ y</span>
        counter++; <span style="color: #5c6370;">// VÃ¹ng gÄƒng, Ä‘Æ°á»£c báº£o vá»‡</span>
    } <span style="color: #5c6370;">// lock_guard bá»‹ há»§y, mutex tá»± Ä‘á»™ng Ä‘Æ°á»£c unlock</span>
}

<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    std::vector&lt;std::thread&gt; threads;
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">10</span>; ++i) {
        threads.push_back(std::thread(increment_safe));
    }

    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">auto</span>&amp; th : threads) {
        th.join();
    }

    std::cout &lt;&lt; <span style="color: #98c379;">"Final counter: "</span> &lt;&lt; counter &lt;&lt; std::endl; <span style="color: #5c6370;">// Káº¿t quáº£ luÃ´n lÃ  1,000,000</span>
    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}
</code></pre>
						</div>
						<div class="explanation-panel hidden mt-4 border-l-4 border-sky-500 bg-sky-50 p-4 rounded-r-lg text-gray-700">
							<h6 class="font-bold text-lg mb-2 text-sky-800">Giáº£i thÃ­ch Giáº£i phÃ¡p</h6>
							<p class="mb-2">Äoáº¡n code nÃ y kháº¯c phá»¥c váº¥n Ä‘á» trÃªn báº±ng cÃ¡ch sá»­ dá»¥ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::mutex</code> (Mutual Exclusion - Loáº¡i trá»« tÆ°Æ¡ng há»—) Ä‘á»ƒ báº£o vá»‡ vÃ¹ng code nguy hiá»ƒm (<code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">counter++</code>).</p>
							<p class="mb-2">NÃ³ hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?</p>
							<ol class="list-decimal list-inside space-y-2 mt-2">
								<li><strong><code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::mutex mtx;</code></strong>: TÆ°á»Ÿng tÆ°á»£ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">mtx</code> nhÆ° má»™t chiáº¿c chÃ¬a khÃ³a cá»§a má»™t cÄƒn phÃ²ng.</li>
								<li><strong><code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::lock_guard&lt;std::mutex&gt; lock(mtx);</code></strong>: Khi má»™t luá»“ng Ä‘áº¿n dÃ²ng nÃ y, nÃ³ sáº½ cá»‘ gáº¯ng láº¥y chiáº¿c chÃ¬a khÃ³a (<code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">mtx.lock()</code>).
									<ul class="list-disc list-inside ml-4 mt-1">
										<li>Náº¿u chÃ¬a khÃ³a Ä‘ang cÃ³ sáºµn, luá»“ng sáº½ láº¥y nÃ³, Ä‘i vÃ o "vÃ¹ng gÄƒng" (Ä‘oáº¡n code bÃªn trong), vÃ  thá»±c hiá»‡n <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">counter++</code>.</li>
										<li>Náº¿u má»™t luá»“ng khÃ¡c Ä‘ang giá»¯ chÃ¬a khÃ³a, luá»“ng nÃ y sáº½ pháº£i Ä‘á»©ng Ä‘á»£i cho Ä‘áº¿n khi chÃ¬a khÃ³a Ä‘Æ°á»£c tráº£ láº¡i.</li>
									</ul>
								</li>
								<li><strong>Káº¿t thÃºc scope:</strong> Khi luá»“ng thá»±c thi xong <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">counter++</code> vÃ  Ä‘i Ä‘áº¿n dáº¥u <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">}</code> cá»§a vÃ²ng láº·p, Ä‘á»‘i tÆ°á»£ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">lock_guard</code> bá»‹ há»§y. Trong hÃ m há»§y cá»§a nÃ³, nÃ³ sáº½ tá»± Ä‘á»™ng tráº£ láº¡i chÃ¬a khÃ³a (<code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">mtx.unlock()</code>). LÃºc nÃ y, má»™t luá»“ng khÃ¡c Ä‘ang Ä‘á»£i cÃ³ thá»ƒ láº¥y chÃ¬a khÃ³a vÃ  Ä‘i vÃ o.</li>
							</ol>
							<p class="mt-2">CÆ¡ cháº¿ nÃ y Ä‘áº£m báº£o ráº±ng chuá»—i thao tÃ¡c Äá»c-Sá»­a-Ghi Ä‘á»‘i vá»›i <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">counter</code> khÃ´ng bao giá» bá»‹ xen ngang bá»Ÿi luá»“ng khÃ¡c, giÃºp thao tÃ¡c nÃ y trá»Ÿ nÃªn "nguyÃªn tá»­" vÃ  báº£o toÃ n dá»¯ liá»‡u. Viá»‡c sá»­ dá»¥ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::lock_guard</code> Ä‘Æ°á»£c khuyáº¿n khÃ­ch vÃ¬ nÃ³ Ä‘áº£m báº£o mutex luÃ´n Ä‘Æ°á»£c giáº£i phÃ³ng, ngay cáº£ khi cÃ³ lá»—i xáº£y ra (exception), trÃ¡nh Ä‘Æ°á»£c tÃ¬nh tráº¡ng <strong>deadlock</strong>.</p>
						</div>
					</div>
				</div>
			</div>

			<div class="border-t pt-8 mt-8 text-justify">
				<h4 class="font-bold text-2xl mb-3 text-cyan-700">5.2. Semaphore</h4>
				<p class="mb-4"><strong>Semaphore</strong> lÃ  má»™t cÆ¡ cháº¿ tá»•ng quÃ¡t hÆ¡n mutex, hoáº¡t Ä‘á»™ng nhÆ° má»™t biáº¿n Ä‘áº¿m Ä‘Æ°á»£c báº£o vá»‡ dÃ¹ng Ä‘á»ƒ quáº£n lÃ½ quyá»n truy cáº­p vÃ o má»™t nhÃ³m cÃ¡c tÃ i nguyÃªn cÃ³ sá»‘ lÆ°á»£ng giá»›i háº¡n. Trong khi mutex chá»‰ cho phÃ©p má»™t luá»“ng truy cáº­p, semaphore cho phÃ©p tá»‘i Ä‘a <strong>N luá»“ng truy cáº­p Ä‘á»“ng thá»i</strong>, vá»›i N lÃ  giÃ¡ trá»‹ khá»Ÿi táº¡o cá»§a semaphore.</p>
				<p><strong>CÃ¡ch hoáº¡t Ä‘á»™ng</strong>: Semaphore há»— trá»£ hai thao tÃ¡c chÃ­nh (tÃªn gá»i cÃ³ thá»ƒ khÃ¡c nhau tÃ¹y theo há»‡ thá»‘ng):</p>
				<ul class="list-disc list-inside space-y-1 text-gray-700 mb-4">
					<li><code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">acquire()</code>(cÃ²n gá»i lÃ  <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">wait()</code> hoáº·c <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">P()</code>): Cá»‘ gáº¯ng "láº¥y" má»™t tÃ i nguyÃªn. Thao tÃ¡c nÃ y sáº½ kiá»ƒm tra bá»™ Ä‘áº¿m cá»§a semaphore. Náº¿u bá»™ Ä‘áº¿m lá»›n hÆ¡n 0, nÃ³ sáº½ giáº£m bá»™ Ä‘áº¿m Ä‘i 1 vÃ  cho phÃ©p luá»“ng tiáº¿p tá»¥c. Náº¿u bá»™ Ä‘áº¿m báº±ng 0 (tá»©c lÃ  táº¥t cáº£ tÃ i nguyÃªn Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng), luá»“ng sáº½ bá»‹ cháº·n cho Ä‘áº¿n khi cÃ³ má»™t tÃ i nguyÃªn Ä‘Æ°á»£c giáº£i phÃ³ng.</li>
					<li><code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">release()</code>(cÃ²n gá»i lÃ  <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">signal()</code> hoáº·c <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">V()</code>): "Tráº£ láº¡i" má»™t tÃ i nguyÃªn. Thao tÃ¡c nÃ y tÄƒng bá»™ Ä‘áº¿m cá»§a semaphore lÃªn 1. Náº¿u cÃ³ cÃ¡c luá»“ng Ä‘ang bá»‹ cháº·n chá» tÃ i nguyÃªn, má»™t trong sá»‘ chÃºng sáº½ Ä‘Æ°á»£c Ä‘Ã¡nh thá»©c.</li>
				</ul>

				<p><strong>PhÃ¢n loáº¡i</strong>:</p>
				<ul class="list-disc list-inside space-y-1 text-gray-700 mb-4">
					<li><strong>Semaphore Äáº¿m (Counting Semaphore)</strong>: Bá»™ Ä‘áº¿m cÃ³ thá»ƒ lÃ  báº¥t ká»³ sá»‘ nguyÃªn khÃ´ng Ã¢m nÃ o. ÄÃ¢y lÃ  loáº¡i semaphore tá»•ng quÃ¡t, dÃ¹ng Ä‘á»ƒ giá»›i háº¡n sá»‘ lÆ°á»£ng luá»“ng truy cáº­p Ä‘á»“ng thá»i. VÃ­ dá»¥: má»™t á»©ng dá»¥ng cÃ³ má»™t pool 5 káº¿t ná»‘i cÆ¡ sá»Ÿ dá»¯ liá»‡u cÃ³ thá»ƒ sá»­ dá»¥ng má»™t semaphore Ä‘Æ°á»£c khá»Ÿi táº¡o vá»›i giÃ¡ trá»‹ 5 Ä‘á»ƒ Ä‘áº£m báº£o khÃ´ng quÃ¡ 5 luá»“ng sá»­ dá»¥ng káº¿t ná»‘i cÃ¹ng lÃºc.</li>
					<li><strong>Semaphore Nhá»‹ phÃ¢n (Binary Semaphore)</strong>: Má»™t trÆ°á»ng há»£p Ä‘áº·c biá»‡t cá»§a semaphore Ä‘áº¿m, trong Ä‘Ã³ bá»™ Ä‘áº¿m chá»‰ cÃ³ thá»ƒ nháº­n giÃ¡ trá»‹ 0 hoáº·c 1. NÃ³ hoáº¡t Ä‘á»™ng ráº¥t giá»‘ng vá»›i mutex. Tuy nhiÃªn, cÃ³ má»™t khÃ¡c biá»‡t quan trá»ng: vá»›i mutex, luá»“ng Ä‘Ã£ khÃ³a (lock) nÃ³ pháº£i lÃ  luá»“ng giáº£i phÃ³ng (unlock) nÃ³. Vá»›i semaphore, má»™t luá»“ng cÃ³ thá»ƒ gá»i <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">release()</code> ngay cáº£ khi nÃ³ khÃ´ng pháº£i lÃ  luá»“ng Ä‘Ã£ gá»i <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">acquire()</code> trÆ°á»›c Ä‘Ã³. Äiá»u nÃ y cho phÃ©p semaphore Ä‘Æ°á»£c sá»­ dá»¥ng trong cÃ¡c ká»‹ch báº£n bÃ¡o hiá»‡u phá»©c táº¡p hÆ¡n.</li>
				</ul>
				
				<p><strong>HÆ°á»›ng dáº«n trong C++ (tá»« C++20)</strong>:</p>
				<p>ThÆ° viá»‡n chuáº©n C++20 Ä‘Ã£ chÃ­nh thá»©c giá»›i thiá»‡u semaphore trong header &lt;semaphore&gt;:</p>
				<ul class="list-disc list-inside space-y-1 text-gray-700 mb-4">
					<li><code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::counting_semaphore</code>: DÃ nh cho semaphore Ä‘áº¿m.</li>
					<li><code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::binary_semaphore</code>: LÃ  má»™t bÃ­ danh (alias) cho <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::counting_semaphore</code>. NghÄ©a lÃ  <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::binary_semaphore</code> chÃ­nh lÃ  <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::counting_semaphore</code> nhÆ°ng Ä‘Æ°á»£c giá»›i háº¡n tá»‘i Ä‘a báº±ng 1.</li>
				</ul>
				
				<div class="code-container">
					<h5 class="font-semibold text-lg mb-2 text-cyan-700">VÃ­ dá»¥ 2:</h5>
                    <p class="mb-4 text-gray-700">VÃ­ dá»¥ sau sá»­ dá»¥ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::counting_semaphore</code> Ä‘á»ƒ giá»›i háº¡n sá»‘ lÆ°á»£ng "worker" cÃ³ thá»ƒ thá»±c hiá»‡n má»™t tÃ¡c vá»¥ tá»‘n thá»i gian cÃ¹ng má»™t lÃºc. DÃ¹ 10 luá»“ng Ä‘Æ°á»£c táº¡o ra, nhÆ°ng táº¡i báº¥t ká»³ thá»i Ä‘iá»ƒm nÃ o cÅ©ng chá»‰ cÃ³ tá»‘i Ä‘a 3 luá»“ng thá»±c sá»± "lÃ m viá»‡c".</p>
                    <p class="mt-3 text-gray-500 text-sm italic">LÆ°u Ã½: Sá»­ dá»¥ng C++20 Ä‘á»ƒ dÃ¹ng Semaphore: <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">g++ file_name.cpp -o file_name.exe -std=c++20 -pthread</code></p>

                    <div class="code-block" data-example-id="semaphore-worker">
<pre><code><span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;iostream&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;thread&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;vector&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;semaphore&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;chrono&gt;</span>

<span style="color: #5c6370;">// Giá»›i háº¡n chá»‰ cÃ³ 3 worker Ä‘Æ°á»£c cháº¡y Ä‘á»“ng thá»i</span>
std::counting_semaphore&lt;<span style="color: #d19a66;">3</span>&gt; worker_slots(<span style="color: #d19a66;">3</span>);

<span style="color: #c678dd;">void</span> <span style="color: #61afef;">worker</span>(<span style="color: #d19a66;">int</span> id) {
    std::cout &lt;&lt; <span style="color: #98c379;">"Worker "</span> &lt;&lt; id &lt;&lt; <span style="color: #98c379;">" is waiting for a slot...\n"</span>;
    
    worker_slots.acquire(); <span style="color: #5c6370;">// Chá» vÃ  chiáº¿m má»™t slot</span>
    
    std::cout &lt;&lt; <span style="color: #98c379;">"Worker "</span> &lt;&lt; id &lt;&lt; <span style="color: #98c379;">" has acquired a slot and is working.\n"</span>;
    std::this_thread::sleep_for(std::chrono::seconds(<span style="color: #d19a66;">2</span>)); <span style="color: #5c6370;">// Giáº£ láº­p cÃ´ng viá»‡c</span>
    
    std::cout &lt;&lt; <span style="color: #98c379;">"Worker "</span> &lt;&lt; id &lt;&lt; <span style="color: #98c379;">" has finished and is releasing the slot.\n"</span>;
    
    worker_slots.release(); <span style="color: #5c6370;">// Giáº£i phÃ³ng slot</span>
}

<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    std::vector&lt;std::thread&gt; workers;
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">10</span>; ++i) {
        workers.emplace_back(worker, i);
    }

    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">auto</span>&amp; w : workers) {
        w.join();
    }

    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}
</code></pre>
                    </div>
					
					<div class="explanation-panel hidden mt-4 border-l-4 border-sky-500 bg-sky-50 p-4 rounded-r-lg text-gray-700">
                        <h6 class="font-bold text-lg mb-2 text-sky-800">Giáº£i thÃ­ch hoáº¡t Ä‘á»™ng cá»§a Semaphore</h6>
                        <p class="mb-2">Äoáº¡n code nÃ y minh há»a cÃ¡ch dÃ¹ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::counting_semaphore</code> Ä‘á»ƒ giá»›i háº¡n sá»‘ lÆ°á»£ng luá»“ng truy cáº­p tÃ i nguyÃªn cÃ¹ng lÃºc. TÆ°á»Ÿng tÆ°á»£ng báº¡n cÃ³ má»™t nhÃ  báº¿p vá»›i chá»‰ 3 cÃ¡i báº¿p, nhÆ°ng láº¡i cÃ³ 10 Ä‘áº§u báº¿p muá»‘n náº¥u Äƒn. Semaphore chÃ­nh lÃ  ngÆ°á»i quáº£n lÃ½ 3 cÃ¡i báº¿p Ä‘Ã³.</p>
                        <p class="font-semibold">Luá»“ng hoáº¡t Ä‘á»™ng cá»§a chÆ°Æ¡ng trÃ¬nh:</p>
                        <ol class="list-decimal list-inside space-y-2 mt-2">
                            <li><strong>Khá»Ÿi táº¡o:</strong> Má»™t semaphore tÃªn lÃ  <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">worker_slots</code> Ä‘Æ°á»£c táº¡o vá»›i bá»™ Ä‘áº¿m ban Ä‘áº§u lÃ  3.</li>
                            <li><strong>Táº¡o Luá»“ng:</strong> 10 luá»“ng Ä‘Æ°á»£c táº¡o ra, má»—i luá»“ng báº¯t Ä‘áº§u cháº¡y hÃ m <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">worker</code>.</li>
                            <li><strong>Cuá»™c Ä‘ua giÃ nh slot:</strong>
                                <ul class="list-disc list-inside ml-4">
                                    <li>3 luá»“ng Ä‘áº§u tiÃªn gá»i <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">acquire()</code> sáº½ thÃ nh cÃ´ng, lÃ m giáº£m bá»™ Ä‘áº¿m xuá»‘ng 0 vÃ  báº¯t Ä‘áº§u "lÃ m viá»‡c".</li>
                                    <li>7 luá»“ng cÃ²n láº¡i khi gá»i <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">acquire()</code> sáº½ tháº¥y bá»™ Ä‘áº¿m lÃ  0 vÃ  bá»‹ block (dá»«ng láº¡i Ä‘á»ƒ chá»).</li>
                                </ul>
                            </li>
                            <li><strong>Giáº£i phÃ³ng vÃ  Tiáº¿p tá»¥c:</strong> Sau 2 giÃ¢y, má»™t luá»“ng lÃ m viá»‡c xong sáº½ gá»i <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">release()</code>, lÃ m tÄƒng bá»™ Ä‘áº¿m lÃªn 1. Ngay láº­p tá»©c, má»™t trong cÃ¡c luá»“ng Ä‘ang chá» sáº½ Ä‘Æ°á»£c Ä‘Ã¡nh thá»©c, láº¥y slot Ä‘Ã³ vÃ  báº¯t Ä‘áº§u cháº¡y.</li>
                            <li><strong>Láº·p láº¡i:</strong> QuÃ¡ trÃ¬nh nÃ y tiáº¿p tá»¥c cho Ä‘áº¿n khi táº¥t cáº£ cÃ¡c luá»“ng Ä‘á»u hoÃ n thÃ nh. Äiá»u nÃ y Ä‘áº£m báº£o khÃ´ng bao giá» cÃ³ quÃ¡ 3 luá»“ng "lÃ m viá»‡c" cÃ¹ng má»™t lÃºc. </li>
                        </ol>
                    </div>
				</div>	

			</div>
				
			<div class="border-t pt-8 mt-8">
				<h4 class="font-bold text-2xl mb-3 text-cyan-700">5.3. Condition Variable (Biáº¿n Ä‘iá»u kiá»‡n)</h4>
				<p class="mb-4"><strong>Biáº¿n Ä‘iá»u kiá»‡n</strong> lÃ  má»™t cÆ¡ cháº¿ Ä‘á»“ng bá»™ hÃ³a phá»©c táº¡p hÆ¡n, cho phÃ©p cÃ¡c luá»“ng chá» Ä‘á»£i (wait) má»™t cÃ¡ch hiá»‡u quáº£ cho Ä‘áº¿n khi má»™t Ä‘iá»u kiá»‡n hoáº·c sá»± kiá»‡n cá»¥ thá»ƒ nÃ o Ä‘Ã³ xáº£y ra. ChÃºng khÃ´ng pháº£i lÃ  má»™t cÆ¡ cháº¿ khÃ³a, mÃ  lÃ  má»™t cÆ¡ cháº¿ <strong>bÃ¡o hiá»‡u (signaling)</strong>. Do Ä‘Ã³, chÃºng luÃ´n luÃ´n pháº£i Ä‘Æ°á»£c sá»­ dá»¥ng cÃ¹ng vá»›i má»™t mutex Ä‘á»ƒ trÃ¡nh race condition trÃªn chÃ­nh Ä‘iá»u kiá»‡n Ä‘ang Ä‘Æ°á»£c kiá»ƒm tra.</p>
				
				<p class="mb-4"><strong>CÃ¡ch hoáº¡t Ä‘á»™ng</strong>: Luá»“ng lÃ m viá»‡c cá»§a biáº¿n Ä‘iá»u kiá»‡n thÆ°á»ng theo má»™t chu trÃ¬nh ba bÆ°á»›c: chá» - thay Ä‘á»•i - bÃ¡o hiá»‡u.</p>
				
				<ol class="list-decimal list-inside space-y-1 text-gray-700 mb-4">
					<strong><li>Luá»“ng chá» (Waiting Thread)</strong>:
						<ul class="list-disc list-inside ml-6 mt-1 space-y-1">
							<li>KhÃ³a mutex (sá»­ dá»¥ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::unique_lock)</code>.</li>
							<li>Kiá»ƒm tra Ä‘iá»u kiá»‡n trong má»™t vÃ²ng láº·p <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">while</code>. Viá»‡c dÃ¹ng vÃ²ng láº·p lÃ  báº¯t buá»™c Ä‘á»ƒ xá»­ lÃ½ "spurious wakeups" (tÃ¬nh tráº¡ng luá»“ng bá»‹ Ä‘Ã¡nh thá»©c má»™t cÃ¡ch giáº£ máº¡o mÃ  khÃ´ng cÃ³ thÃ´ng bÃ¡o).</li>
							<li>Náº¿u Ä‘iá»u kiá»‡n sai, luá»“ng gá»i <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">wait()</code> trÃªn biáº¿n Ä‘iá»u kiá»‡n. Lá»‡nh <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">wait()</code> sáº½ lÃ m ba viá»‡c má»™t cÃ¡ch nguyÃªn tá»­:</li>
							<ol type="a" class="list-[lower-alpha] list-inside ml-6 mt-1 space-y-1">
								<li>Tá»± Ä‘á»™ng giáº£i phÃ³ng mutex.</li>
								<li>ÄÆ°a luá»“ng vÃ o tráº¡ng thÃ¡i chá» (blocked).</li>
								<li>Khi Ä‘Æ°á»£c Ä‘Ã¡nh thá»©c, nÃ³ sáº½ cá»‘ gáº¯ng khÃ³a láº¡i mutex trÆ°á»›c khi thoÃ¡t khá»i hÃ m <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">wait()</code>.</li>
							</ol>
						</ul>
					</li>
					<strong><li>Luá»“ng bÃ¡o hiá»‡u (Notifying Thread)</strong>:
						<ul class="list-disc list-inside ml-6 mt-1 space-y-1">
							<li>KhÃ³a cÃ¹ng má»™t mutex.</li>
							<li>Thay Ä‘á»•i tráº¡ng thÃ¡i chia sáº» Ä‘á»ƒ lÃ m cho Ä‘iá»u kiá»‡n trá»Ÿ thÃ nh Ä‘Ãºng.</li>
							<li>Gá»i <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">notify_one()</code>  (Ä‘Ã¡nh thá»©c má»™t luá»“ng Ä‘ang chá») hoáº·c <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">notify_all()</code> (Ä‘Ã¡nh thá»©c táº¥t cáº£ cÃ¡c luá»“ng Ä‘ang chá») trÃªn cÃ¹ng má»™t biáº¿n Ä‘iá»u kiá»‡n.</li>
							<li>Giáº£i phÃ³ng mutex.</li>
						</ul>	
					</li>
				</ol>
				
				<div class="code-container">
					<h5 class="font-semibold text-lg mb-2 text-cyan-700">VÃ­ dá»¥ 3: BÃ i toÃ¡n NhÃ  sáº£n xuáº¥t - NgÆ°á»i tiÃªu dÃ¹ng</h5>
					<p class="mb-4">Má»™t hoáº·c nhiá»u luá»“ng "NhÃ  sáº£n xuáº¥t" táº¡o ra cÃ¡c má»¥c dá»¯ liá»‡u vÃ  Ä‘áº·t chÃºng vÃ o má»™t hÃ ng Ä‘á»£i (buffer) chung cÃ³ kÃ­ch thÆ°á»›c giá»›i háº¡n. Má»™t hoáº·c nhiá»u luá»“ng "NgÆ°á»i tiÃªu dÃ¹ng" láº¥y cÃ¡c má»¥c dá»¯ liá»‡u tá»« hÃ ng Ä‘á»£i Ä‘Ã³ Ä‘á»ƒ xá»­ lÃ½.</p>
				
					<p><strong>Váº¥n Ä‘á» cáº§n giáº£i quyáº¿t</strong>:
						<ul class="list-disc list-inside space-y-1 text-gray-700 mb-4">
							<li>"NgÆ°á»i tiÃªu dÃ¹ng" khÃ´ng Ä‘Æ°á»£c cá»‘ gáº¯ng láº¥y dá»¯ liá»‡u khi buffer rá»—ng (pháº£i chá»).</li>
							<li>"NhÃ  sáº£n xuáº¥t" khÃ´ng Ä‘Æ°á»£c cá»‘ gáº¯ng thÃªm dá»¯ liá»‡u khi buffer Ä‘Ã£ Ä‘áº§y (pháº£i chá»).</li>
						</ul>
					</p>
					<p class="mb-4"><strong>Giáº£i phÃ¡p</strong>: Sá»­ dá»¥ng má»™t mutex Ä‘á»ƒ báº£o vá»‡ buffer vÃ  hai biáº¿n Ä‘iá»u kiá»‡n: <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">cv_not_full</code> Ä‘á»ƒ bÃ¡o hiá»‡u cho Producer ráº±ng buffer Ä‘Ã£ cÃ³ chá»— trá»‘ng vÃ  <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">cv_not_empty </code>Ä‘á»ƒ bÃ¡o hiá»‡u cho Consumer ráº±ng buffer Ä‘Ã£ cÃ³ dá»¯ liá»‡u.</p>

					<div class="code-block" data-example-id="producer-consumer">
<pre><code><span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;iostream&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;thread&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;queue&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;mutex&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;condition_variable&gt;</span>

std::queue&lt;<span style="color: #d19a66;">int</span>&gt; buffer;
std::mutex mtx;
std::condition_variable cv;
<span style="color: #c678dd;">const unsigned int</span> MAX_BUFFER_SIZE = <span style="color: #d19a66;">5</span>;

<span style="color: #c678dd;">void</span> <span style="color: #61afef;">producer</span>(<span style="color: #d19a66;">int</span> id) {
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">10</span>; ++i) {
        std::unique_lock&lt;std::mutex&gt; lock(mtx);
        cv.wait(lock, []{ <span style="color: #c678dd;">return</span> buffer.size() &lt; MAX_BUFFER_SIZE; });
        
        buffer.push(i);
        std::cout &lt;&lt; <span style="color: #98c379;">"Producer "</span> &lt;&lt; id &lt;&lt; <span style="color: #98c379;">" produced item "</span> &lt;&lt; i &lt;&lt; <span style="color: #98c379;">".\n"</span>;
        
        lock.unlock();
        cv.notify_one();
    }
}

<span style="color: #c678dd;">void</span> <span style="color: #61afef;">consumer</span>(<span style="color: #d19a66;">int</span> id) {
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">10</span>; ++i) {
        std::unique_lock&lt;std::mutex&gt; lock(mtx);
        cv.wait(lock, []{ <span style="color: #c678dd;">return</span> !buffer.empty(); });
        
        <span style="color: #d19a66;">int</span> item = buffer.front();
        buffer.pop();
        std::cout &lt;&lt; <span style="color: #98c379;">"Consumer "</span> &lt;&lt; id &lt;&lt; <span style="color: #98c379;">" consumed item "</span> &lt;&lt; item &lt;&lt; <span style="color: #98c379;">".\n"</span>;
        
        lock.unlock();
        cv.notify_one();
    }
}

<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    std::thread p1(producer, 1);
    std::thread c1(consumer, 1);
    p1.join();
    c1.join();
    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}
</code></pre>
					</div>
				
					<div class="explanation-panel hidden mt-4 border-l-4 border-sky-500 bg-sky-50 p-4 rounded-r-lg text-gray-700">
						<h6 class="font-bold text-lg mb-2 text-sky-800">Giáº£i thÃ­ch</h6>
							<p class="mb-2">Äoáº¡n code nÃ y lÃ  má»™t vÃ­ dá»¥ kinh Ä‘iá»ƒn vá» "BÃ i toÃ¡n NhÃ  sáº£n xuáº¥t - NgÆ°á»i tiÃªu dÃ¹ng" (Producer-Consumer Problem), má»™t váº¥n Ä‘á» cá»‘t lÃµi trong láº­p trÃ¬nh Ä‘á»“ng thá»i. NÃ³ giáº£i quyáº¿t ká»‹ch báº£n nÆ¡i má»™t hoáº·c nhiá»u luá»“ng (Producer) táº¡o ra dá»¯ liá»‡u vÃ  Ä‘Æ°a vÃ o má»™t bá»™ Ä‘á»‡m chung, trong khi má»™t hoáº·c nhiá»u luá»“ng khÃ¡c (Consumer) láº¥y dá»¯ liá»‡u ra khá»i bá»™ Ä‘á»‡m Ä‘Ã³ Ä‘á»ƒ xá»­ lÃ½. Váº¥n Ä‘á» lÃ  pháº£i lÃ m sao Ä‘á»ƒ Producer khÃ´ng thÃªm dá»¯ liá»‡u khi bá»™ Ä‘á»‡m Ä‘Ã£ Ä‘áº§y vÃ  Consumer khÃ´ng cá»‘ láº¥y dá»¯ liá»‡u khi bá»™ Ä‘á»‡m Ä‘ang rá»—ng, táº¥t cáº£ pháº£i diá»…n ra má»™t cÃ¡ch an toÃ n vÃ  hiá»‡u quáº£.</p>
							<p class="mb-2">CÃ´ng cá»¥ chÃ­nh Ä‘Æ°á»£c sá»­ dá»¥ng á»Ÿ Ä‘Ã¢y lÃ  <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::condition_variable</code>, hoáº¡t Ä‘á»™ng nhÆ° má»™t há»‡ thá»‘ng tÃ­n hiá»‡u cho phÃ©p cÃ¡c luá»“ng chá» Ä‘á»£i má»™t Ä‘iá»u kiá»‡n nÃ o Ä‘Ã³ xáº£y ra mÃ  khÃ´ng cáº§n liÃªn tá»¥c kiá»ƒm tra (busy-waiting), giÃºp tiáº¿t kiá»‡m tÃ i nguyÃªn CPU.</p>
							<p class="font-semibold mt-4">TÆ°á»Ÿng tÆ°á»£ng má»™t dÃ¢y chuyá»n trong tiá»‡m bÃ¡nh:</p>
							<ul class="list-disc list-inside space-y-1 mt-2">
								<li><strong>Producer (NgÆ°á»i sáº£n xuáº¥t):</strong> lÃ  ngÆ°á»i thá»£ lÃ m bÃ¡nh.</li>
								<li><strong>Consumer (NgÆ°á»i tiÃªu dÃ¹ng):</strong> lÃ  ngÆ°á»i Ä‘Ã³ng gÃ³i bÃ¡nh.</li>
								<li><strong>Buffer (Bá»™ Ä‘á»‡m):</strong> lÃ  bÄƒng chuyá»n Ä‘áº·t bÃ¡nh.</li>
								<li><strong>Mutex:</strong> lÃ  quy táº¯c "chá»‰ má»™t ngÆ°á»i Ä‘Æ°á»£c cháº¡m vÃ o bÄƒng chuyá»n táº¡i má»™t thá»i Ä‘iá»ƒm".</li>
								<li><strong>Condition Variable:</strong> lÃ  há»‡ thá»‘ng liÃªn láº¡c. NgÆ°á»i lÃ m bÃ¡nh sáº½ hÃ©t lÃªn "CÃ³ bÃ¡nh má»›i!" khi Ä‘áº·t bÃ¡nh lÃªn, vÃ  ngÆ°á»i Ä‘Ã³ng gÃ³i sáº½ hÃ©t lÃªn "Láº¥y bÃ¡nh rá»“i, cÃ³ chá»— trá»‘ng!" khi láº¥y bÃ¡nh Ä‘i.</li>
							</ul>
							<p class="font-semibold mt-4">Luá»“ng hoáº¡t Ä‘á»™ng chÃ­nh:</p>
							<ol class="list-decimal list-inside space-y-2 mt-2">
								<li>Producer khÃ³a mutex, kiá»ƒm tra buffer chÆ°a Ä‘áº§y, nÃ³ liá»n Ä‘áº·t bÃ¡nh vÃ o, sau Ä‘Ã³ má»Ÿ khÃ³a vÃ  thÃ´ng bÃ¡o (<code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">notify_one()</code>).</li>
								<li>Consumer láº¥y Ä‘Æ°á»£c khÃ³a, kiá»ƒm tra buffer khÃ´ng rá»—ng, nÃ³ liá»n láº¥y bÃ¡nh ra, sau Ä‘Ã³ má»Ÿ khÃ³a vÃ  thÃ´ng bÃ¡o.</li>
								<li>Khi buffer Ä‘áº§y, Producer sáº½ tháº¥y Ä‘iá»u kiá»‡n sai, nÃ³ tá»± Ä‘á»™ng nháº£ khÃ³a mutex vÃ  "Ä‘i ngá»§" (<code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">cv.wait</code>).</li>
								<li>LÃºc nÃ y chá»‰ cÃ³ Consumer cÃ³ thá»ƒ cháº¡y. Sau khi láº¥y bÃ¡nh, nÃ³ gá»i <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">notify_one()</code> Ä‘á»ƒ "Ä‘Ã¡nh thá»©c" Producer Ä‘ang ngá»§ dáº­y.</li>
								<li>Producer thá»©c dáº­y, khÃ³a láº¡i mutex, kiá»ƒm tra láº¡i Ä‘iá»u kiá»‡n (láº§n nÃ y lÃ  Ä‘Ãºng) vÃ  tiáº¿p tá»¥c cÃ´ng viá»‡c.</li>
							</ol>
							<p class="mt-2">QuÃ¡ trÃ¬nh nÃ y cá»© tháº¿ tiáº¿p diá»…n, táº¡o ra má»™t sá»± phá»‘i há»£p nhá»‹p nhÃ ng vÃ  hiá»‡u quáº£ giá»¯a hai luá»“ng.</p>
					</div>
				</div>
			</div>

			<div class="border-t pt-8 mt-8">
				<h4 class="font-bold text-2xl mb-3 text-cyan-700">5.4. Atomic Operations (Thao tÃ¡c NguyÃªn tá»­)</h4>
				<p class="mb-4"><strong>Thao tÃ¡c nguyÃªn tá»­</strong> lÃ  cÃ¡c thao tÃ¡c Ä‘Æ°á»£c Ä‘áº£m báº£o thá»±c hiá»‡n nhÆ° má»™t Ä‘Æ¡n vá»‹ duy nháº¥t, khÃ´ng thá»ƒ bá»‹ chia cáº¯t hay xen ngang bá»Ÿi cÃ¡c luá»“ng khÃ¡c. ChÃºng thÆ°á»ng Ä‘Æ°á»£c thá»±c thi trá»±c tiáº¿p bá»Ÿi cÃ¡c chá»‰ thá»‹ Ä‘áº·c biá»‡t cá»§a pháº§n cá»©ng (CPU instructions), do Ä‘Ã³ cá»±c ká»³ hiá»‡u quáº£ vÃ  khÃ´ng gÃ¢y ra tÃ¬nh tráº¡ng cháº·n luá»“ng nhÆ° mutex. ChÃºng lÃ  ná»n táº£ng cá»§a <strong>láº­p trÃ¬nh khÃ´ng khÃ³a (lock-free programming)</strong>.</p>
				<p class="mb-4"><strong>Má»¥c Ä‘Ã­ch</strong>: CÃ¡c thao tÃ¡c nguyÃªn tá»­ Ä‘Æ°á»£c sá»­ dá»¥ng cho cÃ¡c tÃ¡c vá»¥ Ä‘á»“ng bá»™ hÃ³a ráº¥t Ä‘Æ¡n giáº£n vÃ  thÆ°á»ng xuyÃªn, cháº³ng háº¡n nhÆ° tÄƒng má»™t biáº¿n Ä‘áº¿m, Ä‘á»c/ghi má»™t cá» tráº¡ng thÃ¡i (flag), hay thá»±c hiá»‡n so sÃ¡nh vÃ  trao Ä‘á»•i (compare-and-swap). Viá»‡c sá»­ dá»¥ng chÃºng giÃºp trÃ¡nh Ä‘Æ°á»£c chi phÃ­ quáº£n lÃ½ (overhead) cá»§a mutex trong nhá»¯ng trÆ°á»ng há»£p Ä‘Æ¡n giáº£n nÃ y.</p>
				<p><strong>HÆ°á»›ng dáº«n trong C++:</strong>
				<p class="mb-4">ThÆ° viá»‡n chuáº©n C++ cung cáº¥p lá»›p template <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::atomic&lt;T&gt;</code> trong header <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">&lt;atomic&gt;</code>. NÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng vá»›i háº§u háº¿t cÃ¡c kiá»ƒu dá»¯ liá»‡u cÆ¡ báº£n (nhÆ° bool, int, long long, con trá»).</p>
				
				<div class="code-container">				
					<h5 class="font-semibold text-lg mb-2 text-cyan-700">VÃ­ dá»¥ 4: Giáº£i phÃ¡p thay tháº¿ Mutex hiá»‡u nÄƒng cao</h5>
					<h5 class="font-semibold text-lg mb-2">Giáº£i phÃ¡p thay tháº¿ Mutex hiá»‡u nÄƒng cao</h5>
					<p class="mb-4 text-gray-700">MÃ£ nguá»“n dÆ°á»›i Ä‘Ã¢y viáº¿t láº¡i vÃ­ dá»¥ biáº¿n Ä‘áº¿m bá»‹ race condition báº±ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::atomic</code>. Káº¿t quáº£ khÃ´ng chá»‰ ngáº¯n gá»n hÆ¡n mÃ  cÃ²n cÃ³ hiá»‡u nÄƒng cao hÆ¡n Ä‘Ã¡ng ká»ƒ so vá»›i phiÃªn báº£n dÃ¹ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">mutex</code>, vÃ¬ nÃ³ trÃ¡nh Ä‘Æ°á»£c viá»‡c cháº·n vÃ  chuyá»ƒn Ä‘á»•i ngá»¯ cáº£nh cá»§a cÃ¡c luá»“ng.</p>
					<div class="code-block" data-example-id="atomic-counter">
<pre><code><span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;iostream&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;thread&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;vector&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;atomic&gt;</span>

<span style="color: #5c6370;">// Sá»­ dá»¥ng std::atomic Ä‘á»ƒ Ä‘áº£m báº£o cÃ¡c thao tÃ¡c lÃ  nguyÃªn tá»­</span>
std::atomic&lt;<span style="color: #d19a66;">long long</span>&gt; atomic_counter(<span style="color: #d19a66;">0</span>);

<span style="color: #c678dd;">void</span> <span style="color: #61afef;">increment_atomic</span>() {
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">100000</span>; ++i) {
        <span style="color: #5c6370;">// fetch_add lÃ  má»™t thao tÃ¡c RMW (Read-Modify-Write) nguyÃªn tá»­</span>
        <span style="color: #5c6370;">// TÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i atomic_counter++</span>
        atomic_counter.fetch_add(<span style="color: #d19a66;">1</span>, std::memory_order_relaxed);
    }
}

<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    std::vector&lt;std::thread&gt; threads;
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">10</span>; ++i) {
        threads.push_back(std::thread(increment_atomic));
    }

    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">auto</span>&amp; th : threads) {
        th.join();
    }

    <span style="color: #5c6370;">// load() lÃ  má»™t thao tÃ¡c Ä‘á»c nguyÃªn tá»­</span>
    std::cout &lt;&lt; <span style="color: #98c379;">"Final counter: "</span> &lt;&lt; atomic_counter.load() &lt;&lt; std::endl; <span style="color: #5c6370;">// Káº¿t quáº£ luÃ´n lÃ  1,000,000</span>
    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}
</code></pre>
				</div>
						<div class="explanation-panel hidden mt-4 border-l-4 border-sky-500 bg-sky-50 p-4 rounded-r-lg text-gray-700">
							<h6 class="font-bold text-lg mb-2 text-sky-800">Giáº£i thÃ­ch</h6>
							<p class="mb-2">Äoáº¡n code nÃ y trÃ¬nh bÃ y má»™t cÃ¡ch khÃ¡c Ä‘á»ƒ giáº£i quyáº¿t váº¥n Ä‘á» Race Condition mÃ  khÃ´ng cáº§n dÃ¹ng Ä‘áº¿n mutex, thay vÃ o Ä‘Ã³ nÃ³ sá»­ dá»¥ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::atomic</code>. Má»™t thao tÃ¡c Ä‘Æ°á»£c gá»i lÃ  "nguyÃªn tá»­" khi nÃ³ Ä‘Æ°á»£c Ä‘áº£m báº£o sáº½ thá»±c thi hoÃ n chá»‰nh mÃ  khÃ´ng bá»‹ báº¥t ká»³ luá»“ng nÃ o khÃ¡c xen ngang. HÃ£y tÆ°á»Ÿng tÆ°á»£ng nÃ³ nhÆ° má»™t hÃ nh Ä‘á»™ng "táº¥t cáº£ hoáº·c khÃ´ng gÃ¬ cáº£", khÃ´ng cÃ³ tráº¡ng thÃ¡i lÆ°ng chá»«ng.</p>
							<p class="mb-2">So vá»›i viá»‡c dÃ¹ng mutex Ä‘á»ƒ "khÃ³a" cáº£ má»™t khu vá»±c, <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::atomic</code> hoáº¡t Ä‘á»™ng á»Ÿ cáº¥p Ä‘á»™ tháº¥p hÆ¡n, thÆ°á»ng Ä‘Æ°á»£c dá»‹ch trá»±c tiáº¿p thÃ nh cÃ¡c chá»‰ thá»‹ Ä‘áº·c biá»‡t cá»§a CPU, giÃºp nÃ³ trá»Ÿ nÃªn cá»±c ká»³ hiá»‡u quáº£ cho cÃ¡c thao tÃ¡c Ä‘Æ¡n giáº£n.</p>
							<p class="mt-4"><strong>Khi nÃ o nÃªn dÃ¹ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::atomic</code>?</strong></p>
							<p class="mb-2"><code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::atomic</code> lÃ  lá»±a chá»n lÃ½ tÆ°á»Ÿng khi báº¡n chá»‰ cáº§n thá»±c hiá»‡n cÃ¡c thao tÃ¡c Ä‘Æ¡n giáº£n (tÄƒng, giáº£m, gÃ¡n, so sÃ¡nh-vÃ -trao-Ä‘á»•i) trÃªn má»™t biáº¿n duy nháº¥t (nhÆ° biáº¿n Ä‘áº¿m, cá» tráº¡ng thÃ¡i). NÃ³ mang láº¡i sá»± an toÃ n mÃ  khÃ´ng cÃ³ chi phÃ­ hiá»‡u nÄƒng lá»›n nhÆ° mutex. </p>
							<p class="mt-2"><strong>Khi nÃ o nÃªn dÃ¹ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::mutex</code>?</strong></p>
							<p>Khi báº¡n cáº§n báº£o vá»‡ má»™t vÃ¹ng mÃ£ thá»±c hiá»‡n nhiá»u thao tÃ¡c trÃªn má»™t hoáº·c nhiá»u biáº¿n Ä‘Æ°á»£c chia sáº». VÃ­ dá»¥, báº¡n cáº§n Ä‘á»c má»™t biáº¿n, tÃ­nh toÃ¡n phá»©c táº¡p, rá»“i cáº­p nháº­t hai biáº¿n khÃ¡c dá»±a trÃªn káº¿t quáº£ Ä‘Ã³. ToÃ n bá»™ chuá»—i hÃ nh Ä‘á»™ng nÃ y cáº§n Ä‘Æ°á»£c báº£o vá»‡ nhÆ° má»™t khá»‘i duy nháº¥t, vÃ  Ä‘Ã³ lÃ  lÃºc mutex phÃ¡t huy tÃ¡c dá»¥ng. </p>
						</div>
                </div>
			</div>
		</section>
        
        <section id="part6" class="py-12 bg-white rounded-lg shadow-xl my-12 p-6 md:p-8">
			<h3 class="text-3xl font-bold text-center mb-2">6. Thá»±c hÃ nh láº­p trÃ¬nh Ä‘a luá»“ng trong C++</h3>
			<p class="text-center max-w-3xl mx-auto text-gray-600 mb-12">Thá»±c hiá»‡n bÃ i toÃ¡n nhÃ¢n ma tráº­n vá»›i kÃ­ch thÆ°á»›c lá»›n Ä‘á»ƒ so sÃ¡nh Ä‘á»™ hiá»‡u quáº£ cá»§a ká»¹ thuáº­t láº­p trÃ¬nh Ä‘a luá»“ng so vá»›i láº­p trÃ¬nh thÃ´ng thÆ°á»ng</p>

			<div class="border-t pt-8 mt-8 text-justify">
				<h4 class="font-bold text-2xl mb-3 text-cyan-700">6.1. Giá»›i thiá»‡u ThÆ° viá»‡n <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">&lt;thread&gt;</code> cá»§a C++11</h4>
				<p class="mb-4">Ká»ƒ tá»« phiÃªn báº£n C++11, thÆ° viá»‡n chuáº©n Ä‘Ã£ cung cáº¥p sá»± há»— trá»£ máº¡nh máº½ cho láº­p trÃ¬nh Ä‘a luá»“ng thÃ´ng qua header <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">&lt;thread&gt;</code>.</p>
				
				<h5 class="font-semibold text-lg mb-2 text-cyan-700">Táº¡o má»™t luá»“ng má»›i:</h5>
				<p class="mb-4 text-gray-700">Äá»ƒ táº¡o má»™t luá»“ng má»›i, ta chá»‰ cáº§n khá»Ÿi táº¡o má»™t Ä‘á»‘i tÆ°á»£ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::thread</code> vÃ  truyá»n vÃ o cho nÃ³ má»™t hÃ m (hoáº·c má»™t Ä‘á»‘i tÆ°á»£ng cÃ³ thá»ƒ gá»i Ä‘Æ°á»£c - callable object) lÃ m Ä‘iá»ƒm báº¯t Ä‘áº§u thá»±c thi cá»§a luá»“ng Ä‘Ã³.</p>
				<div class="code-block mb-6">
<pre><code><span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;iostream&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;thread&gt;</span>

<span style="color: #c678dd;">void</span> <span style="color: #61afef;">task_function</span>() {
    std::cout &lt;&lt; <span style="color: #98c379;">"Hello from a new thread!\n"</span>;
}

<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    <span style="color: #5c6370;">// Táº¡o má»™t luá»“ng má»›i vÃ  báº¯t Ä‘áº§u thá»±c thi task_function</span>
    std::thread my_thread(task_function);

    <span style="color: #5c6370;">//... (luá»“ng main cÃ³ thá»ƒ lÃ m viá»‡c khÃ¡c á»Ÿ Ä‘Ã¢y)</span>

    <span style="color: #5c6370;">// Chá» luá»“ng con káº¿t thÃºc</span>
    my_thread.join();

    std::cout &lt;&lt; <span style="color: #98c379;">"Thread has finished.\n"</span>;
    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}
</code></pre>
				</div>

				<h5 class="font-semibold text-lg mb-2 text-cyan-700"><code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">join()</code> vÃ  <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">detach()</code></h5>
				<p class="mb-4 text-gray-700">Má»—i Ä‘á»‘i tÆ°á»£ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::thread</code> pháº£i Ä‘Æ°á»£c xá»­ lÃ½ trÆ°á»›c khi nÃ³ bá»‹ há»§y (vÃ­ dá»¥, khi ra khá»i scope). CÃ³ hai cÃ¡ch Ä‘á»ƒ lÃ m Ä‘iá»u nÃ y:</p>
				<ul class="list-disc list-inside space-y-2 text-gray-700">
					<li><code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">join()</code>: Luá»“ng gá»i (vÃ­ dá»¥: luá»“ng main) sáº½ bá»‹ cháº·n vÃ  chá» cho Ä‘áº¿n khi luá»“ng Ä‘Æ°á»£c <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">join</code> hoÃ n thÃ nh viá»‡c thá»±c thi cá»§a nÃ³. ÄÃ¢y lÃ  cÃ¡ch phá»• biáº¿n nháº¥t Ä‘á»ƒ Ä‘á»“ng bá»™ hÃ³a vÃ  Ä‘áº£m báº£o ráº±ng má»i cÃ´ng viá»‡c cá»§a luá»“ng con Ä‘Ã£ Ä‘Æ°á»£c hoÃ n táº¥t trÆ°á»›c khi chÆ°Æ¡ng trÃ¬nh chÃ­nh tiáº¿p tá»¥c hoáº·c káº¿t thÃºc.</li>
					<li><code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">detach()</code>: TÃ¡ch luá»“ng con ra khá»i Ä‘á»‘i tÆ°á»£ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::thread</code>. Sau khi <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">detach</code>, luá»“ng con sáº½ tiáº¿p tá»¥c cháº¡y Ä‘á»™c láº­p trong ná»n. Luá»“ng con sáº½ tá»± Ä‘á»™ng Ä‘Æ°á»£c dá»n dáº¹p tÃ i nguyÃªn bá»Ÿi há»‡ thá»‘ng khi nÃ³ thá»±c thi xong. Viá»‡c sá»­ dá»¥ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">detach</code> cáº§n cáº©n tháº­n, vÃ¬ luá»“ng chÃ­nh sáº½ máº¥t kháº£ nÄƒng giao tiáº¿p hoáº·c chá» Ä‘á»£i luá»“ng con.</li>
				</ul>
				chÆ°Æ¡ng trÃ¬nh sáº½ bá»‹ cháº¥m dá»©t (terminate) náº¿u má»™t Ä‘á»‘i tÆ°á»£ng <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">std::thread</code> bá»‹ há»§y mÃ  chÆ°a Ä‘Æ°á»£c <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">join</code> hoáº·c <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">detach</code>.</p>
			</div>

			<div class="border-t pt-8 mt-8">
				<h4 class="font-bold text-2xl mb-3 text-cyan-700">6.2. Thá»±c hÃ nh nhÃ¢n hai ma tráº­n kÃ­ch thÆ°á»›c lá»›n</h4>
				<div class="code-container">
					<h5 class="font-semibold text-lg mt-4 mb-4 text-cyan-700">Tá»‡p Header DÃ¹ng chung: <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">matrix_utils.h</code></h5>
					<p class="mb-4">Äá»ƒ mÃ£ nguá»“n sáº¡ch sáº½ vÃ  dá»… quáº£n lÃ½, táº¥t cáº£ ba phiÃªn báº£n nhÃ¢n ma tráº­n Ä‘á»u sá»­ dá»¥ng má»™t tá»‡p header chung chá»©a <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">struct Matrix</code> vÃ  cÃ¡c hÃ m Ä‘á»c/ghi file.</p>
					<div class="code-block" data-example-id="matrix-utils">
<pre><code><span style="color: #c678dd;">#ifndef</span> <span style="color: #e5c07b;">MATRIX_UTILS_H</span>
<span style="color: #c678dd;">#define</span> <span style="color: #e5c07b;">MATRIX_UTILS_H</span>

<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;iostream&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;vector&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;string&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;fstream&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;stdexcept&gt;</span> <span style="color: #5c6370;">// Äá»ƒ dÃ¹ng std::runtime_error</span>

<span style="color: #5c6370;">// Sá»­ dá»¥ng struct Ä‘á»ƒ Ä‘Ã³ng gÃ³i dá»¯ liá»‡u cá»§a ma tráº­n má»™t cÃ¡ch gá»n gÃ ng</span>
<span style="color: #c678dd;">struct</span> <span style="color: #e5c07b;">Matrix</span> {
    <span style="color: #d19a66;">int</span> rows = <span style="color: #d19a66;">0</span>;
    <span style="color: #d19a66;">int</span> cols = <span style="color: #d19a66;">0</span>;
    std::vector&lt;std::vector&lt;<span style="color: #d19a66;">int</span>&gt;&gt; data;
};

<span style="color: #5c6370;">// HÃ m Ä‘á»c ma tráº­n tá»« file, tráº£ vá» má»™t Ä‘á»‘i tÆ°á»£ng Matrix</span>
<span style="color: #5c6370;">// NÃ©m ra ngoáº¡i lá»‡ (exception) náº¿u cÃ³ lá»—i thay vÃ¬ thoÃ¡t chÆ°Æ¡ng trÃ¬nh</span>
<span style="color: #c678dd;">inline</span> Matrix <span style="color: #61afef;">read_matrix_from_file</span>(<span style="color: #c678dd;">const</span> std::string&amp; filename) {
    std::ifstream file(filename);
    <span style="color: #c678dd;">if</span> (!file.is_open()) {
        <span style="color: #c678dd;">throw</span> std::runtime_error(<span style="color: #98c379;">"Error: Could not open file "</span> + filename);
    }

    Matrix mat;
    file &gt;&gt; mat.rows &gt;&gt; mat.cols;
    <span style="color: #c678dd;">if</span> (mat.rows &lt;= <span style="color: #d19a66;">0</span> || mat.cols &lt;= <span style="color: #d19a66;">0</span>) {
        <span style="color: #c678dd;">throw</span> std::runtime_error(<span style="color: #98c379;">"Invalid matrix dimensions in file: "</span> + filename);
    }

    mat.data.assign(mat.rows, std::vector&lt;<span style="color: #d19a66;">int</span>&gt;(mat.cols));
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; mat.rows; ++i) {
        <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> j = <span style="color: #d19a66;">0</span>; j &lt; mat.cols; ++j) {
            <span style="color: #c678dd;">if</span> (!(file &gt;&gt; mat.data[i][j])) {
                 <span style="color: #c678dd;">throw</span> std::runtime_error(<span style="color: #98c379;">"Error reading data from file: "</span> + filename);
            }
        }
    }
    <span style="color: #c678dd;">return</span> mat;
}

<span style="color: #5c6370;">// HÃ m ghi ma tráº­n ra file</span>
<span style="color: #c678dd;">inline</span> <span style="color: #c678dd;">void</span> <span style="color: #61afef;">write_matrix_to_file</span>(<span style="color: #c678dd;">const</span> Matrix&amp; mat, <span style="color: #c678dd;">const</span> std::string&amp; filename) {
    std::ofstream file(filename);
    <span style="color: #c678dd;">if</span> (!file.is_open()) {
        <span style="color: #c678dd;">throw</span> std::runtime_error(<span style="color: #98c379;">"Error: Could not open file for writing "</span> + filename);
    }

    file &lt;&lt; mat.rows &lt;&lt; <span style="color: #98c379;">" "</span> &lt;&lt; mat.cols &lt;&lt; <span style="color: #98c379;">"\n"</span>;
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; mat.rows; ++i) {
        <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> j = <span style="color: #d19a66;">0</span>; j &lt; mat.cols; ++j) {
            file &lt;&lt; mat.data[i][j] &lt;&lt; (j == mat.cols - <span style="color: #d19a66;">1</span> ? <span style="color: #98c379;">""</span> : <span style="color: #98c379;">" "</span>);
        }
        file &lt;&lt; <span style="color: #98c379;">"\n"</span>;
    }
}

<span style="color: #c678dd;">#endif</span> <span style="color: #5c6370;">// MATRIX_UTILS_H</span>
</code></pre>
					</div>
					<div class="explanation-panel hidden mt-4 border-l-4 border-sky-500 bg-sky-50 p-4 rounded-r-lg text-gray-700">
						<h6 class="font-bold text-lg mb-2 text-sky-800">Giáº£i thÃ­ch</h6>
						<p class="mb-2">Tá»‡p <code>matrix_utils.h</code> nÃ y lÃ  má»™t vÃ­ dá»¥ Ä‘iá»ƒn hÃ¬nh vá» má»™t mÃ´-Ä‘un tiá»‡n Ã­ch trong láº­p trÃ¬nh. NÃ³ cung cáº¥p cÃ¡c cÃ´ng cá»¥ cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng Ä‘á»ƒ thao tÃ¡c vá»›i ma tráº­n, giÃºp cho mÃ£ nguá»“n chÃ­nh (vÃ­ dá»¥: tá»‡p <code>main.cpp</code>) trá»Ÿ nÃªn gá»n gÃ ng vÃ  táº­p trung vÃ o logic nghiá»‡p vá»¥ hÆ¡n lÃ  cÃ¡c chi tiáº¿t Ä‘á»c/ghi file.</p>
						
						<p class="font-semibold mt-4">1. CÃ¡c ThÃ nh pháº§n ChÃ­nh</p>
						<ul class="list-disc list-inside space-y-2 mt-2">
							<li><strong><code>Matrix</code>:</strong> Viá»‡c sá»­ dá»¥ng <code>struct</code> Ä‘á»ƒ nhÃ³m sá»‘ hÃ ng (rows), sá»‘ cá»™t (cols), vÃ  dá»¯ liá»‡u (data) láº¡i vá»›i nhau lÃ  má»™t thá»±c hÃ nh láº­p trÃ¬nh ráº¥t tá»‘t. NÃ³ táº¡o ra má»™t kiá»ƒu dá»¯ liá»‡u má»›i, giÃºp mÃ£ nguá»“n dá»… Ä‘á»c vÃ  dá»… quáº£n lÃ½ hÆ¡n. Thay vÃ¬ pháº£i truyá»n ba biáº¿n riÃªng láº» cho cÃ¡c hÃ m, báº¡n chá»‰ cáº§n truyá»n má»™t Ä‘á»‘i tÆ°á»£ng <code>Matrix</code>.</li>
							<li><strong><code>read_matrix_from_file</code>:</strong> HÃ m nÃ y Ä‘áº£m nháº­n toÃ n bá»™ quÃ¡ trÃ¬nh phá»©c táº¡p cá»§a viá»‡c Ä‘á»c file: má»Ÿ file, kiá»ƒm tra lá»—i, Ä‘á»c kÃ­ch thÆ°á»›c, cáº¥p phÃ¡t bá»™ nhá»›, vÃ  Ä‘á»c tá»«ng pháº§n tá»­. NÃ³ Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ ráº¥t máº¡nh máº½ (robust) nhá» viá»‡c kiá»ƒm tra lá»—i á»Ÿ má»i bÆ°á»›c.</li>
							<li><strong><code>write_matrix_to_file</code>:</strong> TÆ°Æ¡ng tá»±, hÃ m nÃ y Ä‘Ã³ng gÃ³i logic ghi ma tráº­n ra file theo má»™t Ä‘á»‹nh dáº¡ng chuáº©n (dÃ²ng Ä‘áº§u lÃ  kÃ­ch thÆ°á»›c, cÃ¡c dÃ²ng sau lÃ  dá»¯ liá»‡u), Ä‘áº£m báº£o ráº±ng tá»‡p Ä‘Æ°á»£c táº¡o ra bá»Ÿi hÃ m nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘á»c láº¡i má»™t cÃ¡ch chÃ­nh xÃ¡c bá»Ÿi <code>read_matrix_from_file</code>.</li>
						</ul>

						<p class="font-semibold mt-4">2. CÃ¡ch Xá»­ lÃ½ Lá»—i Báº±ng Ngoáº¡i lá»‡ (Exceptions)</p>
						<p class="mb-2">Má»™t trong nhá»¯ng Ä‘iá»ƒm thiáº¿t káº¿ quan trá»ng nháº¥t á»Ÿ Ä‘Ã¢y lÃ  viá»‡c sá»­ dá»¥ng <code>throw std::runtime_error</code>. ÄÃ¢y lÃ  má»™t cÃ¡ch xá»­ lÃ½ lá»—i hiá»‡n Ä‘áº¡i vÃ  linh hoáº¡t.</p>
						<ul class="list-disc list-inside space-y-1 mt-2">
							<li><strong>Táº¡i sao láº¡i dÃ¹ng <code>throw</code>?:</strong> Thay vÃ¬ in ra má»™t thÃ´ng bÃ¡o lá»—i vÃ  gá»i <code>exit(1)</code> (lÃ m chÆ°Æ¡ng trÃ¬nh dá»«ng ngay láº­p tá»©c), viá»‡c "nÃ©m" má»™t ngoáº¡i lá»‡ cho phÃ©p chÆ°Æ¡ng trÃ¬nh gá»i hÃ m quyáº¿t Ä‘á»‹nh cÃ¡ch xá»­ lÃ½. VÃ­ dá»¥, trong <code>main.cpp</code>, báº¡n cÃ³ thá»ƒ Ä‘áº·t lá»i gá»i hÃ m <code>read_matrix_from_file</code> trong má»™t khá»‘i <code>try...catch</code> Ä‘á»ƒ:
								<ul class="list-disc list-inside ml-4 mt-1">
									<li>Báº¯t lá»—i vÃ  thÃ´ng bÃ¡o cho ngÆ°á»i dÃ¹ng má»™t cÃ¡ch thÃ¢n thiá»‡n.</li>
									<li>Cá»‘ gáº¯ng Ä‘á»c má»™t tá»‡p dá»± phÃ²ng.</li>
									<li>Ghi lá»—i vÃ o má»™t tá»‡p log.</li>
								</ul>
							</li>
						</ul>

						<p class="font-semibold mt-4">3. CÃ¡c Äiá»ƒm ÄÃ¡ng ChÃº Ã vá» Hiá»‡u nÄƒng vÃ  CÃº phÃ¡p</p>
						<ul class="list-disc list-inside space-y-2 mt-2">
							<li><strong>Truyá»n báº±ng Tham chiáº¿u Háº±ng (<code>const &</code>):</strong> Khi truyá»n cÃ¡c Ä‘á»‘i tÆ°á»£ng lá»›n nhÆ° <code>std::string</code> hay <code>Matrix</code> vÃ o hÃ m, viá»‡c sá»­ dá»¥ng tham chiáº¿u (<code>&</code>) sáº½ ngÄƒn viá»‡c táº¡o ra má»™t báº£n sao hoÃ n chá»‰nh cá»§a Ä‘á»‘i tÆ°á»£ng, giÃºp tiáº¿t kiá»‡m bá»™ nhá»› vÃ  thá»i gian xá»­ lÃ½. ThÃªm <code>const</code> Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng hÃ m sáº½ khÃ´ng vÃ´ tÃ¬nh thay Ä‘á»•i giÃ¡ trá»‹ cá»§a Ä‘á»‘i tÆ°á»£ng gá»‘c.</li>
							<li><strong>ToÃ¡n tá»­ ba ngÃ´i (<code>? :</code>):</strong> CÃº phÃ¡p <code>(condition ? value_if_true : value_if_false)</code> trong hÃ m <code>write_matrix_to_file</code> lÃ  má»™t cÃ¡ch viáº¿t ngáº¯n gá»n vÃ  thanh lá»‹ch cho má»™t cÃ¢u lá»‡nh <code>if...else</code> Ä‘Æ¡n giáº£n, giÃºp mÃ£ nguá»“n gá»n hÆ¡n khi xá»­ lÃ½ Ä‘á»‹nh dáº¡ng Ä‘áº§u ra.</li>
						</ul>
					</div>
				</div>
				
				
				<div class="code-container">
					<h5 class="font-semibold text-lg mt-8 text-cyan-700"><strong>PhiÃªn báº£n 1</strong>: NhÃ¢n ma tráº­n Tuáº§n tá»±</h5>
					<p class="mb-4">ÄÃ¢y lÃ  thuáº­t toÃ¡n cÆ¡ báº£n, thá»±c hiá»‡n toÃ n bá»™ phÃ©p tÃ­nh trÃªn má»™t luá»“ng duy nháº¥t.</p>
					<div class="code-block" data-example-id="sequential-mult">
<pre><code><span style="color: #5c6370;">// sequential_multiplication.cpp</span>
<span style="color: #5c6370;">// MÃ´ táº£: NhÃ¢n ma tráº­n má»™t cÃ¡ch tuáº§n tá»± sá»­ dá»¥ng má»™t luá»“ng duy nháº¥t.</span>
<span style="color: #5c6370;">// DÃ¹ng lÃ m cÆ¡ sá»Ÿ Ä‘á»ƒ so sÃ¡nh hiá»‡u nÄƒng.</span>

<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">"matrix_utils.h"</span> <span style="color: #5c6370;">// Sá»­ dá»¥ng cÃ¡c hÃ m vÃ  struct chung</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;chrono&gt;</span>

<span style="color: #5c6370;">// HÃ m nhÃ¢n ma tráº­n tuáº§n tá»±</span>
Matrix <span style="color: #61afef;">multiply_sequentially</span>(<span style="color: #c678dd;">const</span> Matrix&amp; A, <span style="color: #c678dd;">const</span> Matrix&amp; B) {
    Matrix C;
    C.rows = A.rows;
    C.cols = B.cols;
    C.data.assign(C.rows, std::vector&lt;<span style="color: #d19a66;">int</span>&gt;(C.cols, <span style="color: #d19a66;">0</span>));

    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; A.rows; ++i) {
        <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> j = <span style="color: #d19a66;">0</span>; j &lt; B.cols; ++j) {
            <span style="color: #d19a66;">int</span> sum = <span style="color: #d19a66;">0</span>;
            <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> k = <span style="color: #d19a66;">0</span>; k &lt; A.cols; ++k) {
                sum += A.data[i][k] * B.data[k][j];
            }
            C.data[i][j] = sum;
        }
    }
    <span style="color: #c678dd;">return</span> C;
}

<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    <span style="color: #c678dd;">try</span> {
        Matrix A = read_matrix_from_file(<span style="color: #98c379;">"A.txt"</span>);
        Matrix B = read_matrix_from_file(<span style="color: #98c379;">"B.txt"</span>);

        <span style="color: #c678dd;">if</span> (A.cols != B.rows) {
            <span style="color: #c678dd;">throw</span> std::invalid_argument(<span style="color: #98c379;">"Error: Incompatible matrix dimensions for multiplication."</span>);
        }

        <span style="color: #d19a66;">auto</span> start_time = std::chrono::high_resolution_clock::now();
        Matrix C = multiply_sequentially(A, B);
        <span style="color: #d19a66;">auto</span> end_time = std::chrono::high_resolution_clock::now();

        <span style="color: #d19a66;">auto</span> duration = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(end_time - start_time);
        std::cout &lt;&lt; <span style="color: #98c379;">"Time taken for sequential multiplication: "</span> &lt;&lt; duration.count() &lt;&lt; <span style="color: #98c379;">" milliseconds\n"</span>;

        write_matrix_to_file(C, <span style="color: #98c379;">"C_sequential.txt"</span>);
        std::cout &lt;&lt; <span style="color: #98c379;">"Result saved to C_sequential.txt\n"</span>;

    } <span style="color: #c678dd;">catch</span> (<span style="color: #c678dd;">const</span> std::exception&amp; e) {
        std::cerr &lt;&lt; <span style="color: #98c379;">"An error occurred: "</span> &lt;&lt; e.what() &lt;&lt; std::endl;
        <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">1</span>;
    }
    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}
</code></pre>
					</div>
					<div class="explanation-panel hidden mt-4 border-l-4 border-sky-500 bg-sky-50 p-4 rounded-r-lg text-gray-700">
						<h6 class="font-bold text-lg mb-2 text-sky-800">Giáº£i thÃ­ch sÃ¢u hÆ¡n</h6>
						<p class="mb-2">ChÆ°Æ¡ng trÃ¬nh nÃ y thá»±c hiá»‡n má»™t nhiá»‡m vá»¥ cÆ¡ báº£n trong Ä‘áº¡i sá»‘ tuyáº¿n tÃ­nh: nhÃ¢n hai ma tráº­n. Tuy nhiÃªn, nÃ³ Ä‘Æ°á»£c viáº¿t vá»›i má»¥c Ä‘Ã­ch rÃµ rÃ ng lÃ  táº¡o ra má»™t chuáº©n cÆ¡ sá»Ÿ (baseline) vá» hiá»‡u nÄƒng.</p>
						
						<p class="font-semibold mt-4">1. Thuáº­t toÃ¡n nhÃ¢n ma tráº­n</p>
						<p class="mb-2">HÃ m <code>multiply_sequentially</code> sá»­ dá»¥ng thuáº­t toÃ¡n nhÃ¢n ma tráº­n kinh Ä‘iá»ƒn mÃ  báº¡n thÆ°á»ng há»c á»Ÿ trÆ°á»ng. Äá»ƒ tÃ­nh giÃ¡ trá»‹ cá»§a má»™t pháº§n tá»­ táº¡i vá»‹ trÃ­ (i, j) trong ma tráº­n káº¿t quáº£ C, thuáº­t toÃ¡n sáº½:</p>
						<ul class="list-disc list-inside space-y-1 mt-2 ml-4">
							<li>Láº¥y hÃ ng thá»© <strong>i</strong> cá»§a ma tráº­n A.</li>
							<li>Láº¥y cá»™t thá»© <strong>j</strong> cá»§a ma tráº­n B.</li>
							<li>Thá»±c hiá»‡n phÃ©p tÃ­ch vÃ´ hÆ°á»›ng (dot product) giá»¯a chÃºng: nhÃ¢n tá»«ng cáº·p pháº§n tá»­ tÆ°Æ¡ng á»©ng rá»“i cá»™ng táº¥t cáº£ láº¡i.</li>
						</ul>
						<p class="mt-2 mb-2">Ba vÃ²ng láº·p lá»“ng nhau mÃ´ phá»ng chÃ­nh xÃ¡c quÃ¡ trÃ¬nh nÃ y:</p>
						<ul class="list-disc list-inside space-y-1 mt-2 ml-4">
							<li>VÃ²ng láº·p <strong>i</strong> vÃ  <strong>j</strong> chá»n vá»‹ trÃ­ C[i][j] Ä‘á»ƒ tÃ­nh toÃ¡n.</li>
							<li>VÃ²ng láº·p <strong>k</strong> thá»±c hiá»‡n phÃ©p tÃ­ch vÃ´ hÆ°á»›ng, duyá»‡t qua cÃ¡c pháº§n tá»­ cá»§a hÃ ng A[i] vÃ  cá»™t B[j].</li>
						</ul>
						<p class="mt-2">Äá»™ phá»©c táº¡p tÃ­nh toÃ¡n cá»§a thuáº­t toÃ¡n nÃ y lÃ  $O(n^3)$ náº¿u cÃ¡c ma tráº­n lÃ  vuÃ´ng vÃ  cÃ³ kÃ­ch thÆ°á»›c $n \times n$. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  náº¿u báº¡n tÄƒng gáº¥p Ä‘Ã´i kÃ­ch thÆ°á»›c cá»§a ma tráº­n, thá»i gian tÃ­nh toÃ¡n sáº½ tÄƒng lÃªn khoáº£ng $2^3 = 8$ láº§n. ÄÃ¢y lÃ  lÃ½ do táº¡i sao viá»‡c tá»‘i Æ°u hÃ³a phÃ©p nhÃ¢n ma tráº­n (vÃ­ dá»¥, báº±ng cÃ¡ch sá»­ dá»¥ng Ä‘a luá»“ng) láº¡i ráº¥t quan trá»ng Ä‘á»‘i vá»›i cÃ¡c ma tráº­n lá»›n.</p>

						<p class="font-semibold mt-4">2. Äo lÆ°á»ng hiá»‡u nÄƒng (Benchmarking)</p>
						<p class="mb-2">Má»¥c Ä‘Ã­ch chÃ­nh cá»§a tá»‡p nÃ y lÃ  Ä‘o thá»i gian thá»±c thi. ThÆ° viá»‡n <code>&lt;chrono&gt;</code> cá»§a C++ cung cáº¥p má»™t bá»™ cÃ´ng cá»¥ máº¡nh máº½ vÃ  chÃ­nh xÃ¡c Ä‘á»ƒ lÃ m viá»‡c nÃ y.</p>
						<ul class="list-disc list-inside space-y-2 mt-2">
							<li><strong><code>std::chrono::high_resolution_clock</code>:</strong> ÄÃ¢y lÃ  loáº¡i Ä‘á»“ng há»“ Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ cung cáº¥p Ä‘á»™ phÃ¢n giáº£i (tá»©c Ä‘á»™ chÃ­nh xÃ¡c) cao nháº¥t mÃ  há»‡ thá»‘ng cÃ³ thá»ƒ há»— trá»£. NÃ³ lÃ½ tÆ°á»Ÿng cho viá»‡c Ä‘o cÃ¡c khoáº£ng thá»i gian ngáº¯n nhÆ° thá»i gian cháº¡y cá»§a má»™t hÃ m.</li>
							<li><strong><code>auto start_time = ...::now()</code>:</strong> Láº¥y "dáº¥u thá»i gian" (timestamp) hiá»‡n táº¡i.</li>
							<li><strong><code>duration_cast&lt;std::chrono::milliseconds&gt;</code>:</strong> Sau khi cÃ³ thá»i gian báº¯t Ä‘áº§u vÃ  káº¿t thÃºc, phÃ©p trá»« <code>end_time - start_time</code> cho ra má»™t Ä‘á»‘i tÆ°á»£ng duration. <code>duration_cast</code> Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ chuyá»ƒn Ä‘á»•i duration nÃ y sang má»™t Ä‘Æ¡n vá»‹ dá»… Ä‘á»c hÆ¡n, cháº³ng háº¡n nhÆ° mili giÃ¢y.</li>
						</ul>
						<p class="mt-2">Káº¿t quáº£ Ä‘o Ä‘Æ°á»£c tá»« chÆ°Æ¡ng trÃ¬nh tuáº§n tá»± nÃ y sáº½ lÃ  thÆ°á»›c Ä‘o Ä‘á»ƒ so sÃ¡nh vá»›i cÃ¡c phiÃªn báº£n song song sau nÃ y. Náº¿u phiÃªn báº£n Ä‘a luá»“ng cháº¡y nhanh hÆ¡n, con sá»‘ nÃ y sáº½ chá»©ng minh sá»± cáº£i thiá»‡n vá» hiá»‡u nÄƒng.</p>

						<p class="font-semibold mt-4">3. Xá»­ lÃ½ Lá»—i Máº¡nh máº½ (Robust Error Handling)</p>
						<p class="mb-2">ToÃ n bá»™ logic trong <code>main</code> Ä‘Æ°á»£c Ä‘áº·t trong má»™t khá»‘i <code>try...catch</code>. ÄÃ¢y lÃ  má»™t thá»±c hÃ nh láº­p trÃ¬nh ráº¥t tá»‘t:</p>
						<ul class="list-disc list-inside space-y-2 mt-2">
							<li><strong>Dá»± Ä‘oÃ¡n lá»—i:</strong> ChÆ°Æ¡ng trÃ¬nh dá»± Ä‘oÃ¡n cÃ¡c lá»—i cÃ³ thá»ƒ xáº£y ra, cháº³ng háº¡n nhÆ° tá»‡p <code>A.txt</code> hoáº·c <code>B.txt</code> khÃ´ng tá»“n táº¡i, hoáº·c kÃ­ch thÆ°á»›c ma tráº­n khÃ´ng tÆ°Æ¡ng thÃ­ch (<code>A.cols != B.rows</code>).</li>
							<li><strong>Xá»­ lÃ½ táº­p trung:</strong> Thay vÃ¬ kiá»ƒm tra lá»—i á»Ÿ nhiá»u nÆ¡i, khá»‘i <code>try...catch</code> cho phÃ©p báº¡n xá»­ lÃ½ táº¥t cáº£ cÃ¡c lá»—i dá»± kiáº¿n táº¡i má»™t nÆ¡i duy nháº¥t. CÃ¡c hÃ m trong <code>matrix_utils.h</code> vÃ  cáº£ logic trong <code>main</code> Ä‘á»u "nÃ©m" (throw) ngoáº¡i lá»‡ khi cÃ³ sá»± cá»‘. Khá»‘i <code>catch</code> sáº½ "báº¯t" chÃºng.</li>
							<li><strong>ThÃ´ng bÃ¡o thÃ¢n thiá»‡n:</strong> Khi lá»—i xáº£y ra, chÆ°Æ¡ng trÃ¬nh khÃ´ng bá»‹ sáº­p má»™t cÃ¡ch khÃ³ hiá»ƒu. Thay vÃ o Ä‘Ã³, nÃ³ in ra má»™t thÃ´ng bÃ¡o lá»—i rÃµ rÃ ng cho ngÆ°á»i dÃ¹ng (<code>e.what()</code>) vÃ  káº¿t thÃºc má»™t cÃ¡ch cÃ³ kiá»ƒm soÃ¡t.</li>
						</ul>
					</div>
				</div>
				
				<div class="code-container">
					<h5 class="font-semibold text-lg mt-8 text-cyan-700"><strong>PhiÃªn báº£n 2</strong>: Äa luá»“ng CÆ¡ báº£n</h5>
					<p class="mb-4">CÃ´ng viá»‡c Ä‘Æ°á»£c chia cho nhiá»u luá»“ng Ä‘á»ƒ tÃ­nh toÃ¡n.</p>
					<div class="code-block" data-example-id="standard-mult">
<pre><code><span style="color: #5c6370;">// multithread_standard.cpp</span>
<span style="color: #5c6370;">// MÃ´ táº£: NhÃ¢n ma tráº­n song song sá»­ dá»¥ng Ä‘a luá»“ng.</span>
<span style="color: #5c6370;">// PhiÃªn báº£n nÃ y minh há»a cÃ¡ch chia viá»‡c cÆ¡ báº£n nhÆ°ng chÆ°a tá»‘i Æ°u truy cáº­p bá»™ nhá»›.</span>

<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">"matrix_utils.h"</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;chrono&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;thread&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;functional&gt;</span> <span style="color: #5c6370;">// DÃ¹ng cho std::ref, std::cref</span>

<span style="color: #5c6370;">// HÃ m cÃ´ng viá»‡c cho má»—i luá»“ng (phiÃªn báº£n chÆ°a tá»‘i Æ°u)</span>
<span style="color: #c678dd;">void</span> <span style="color: #61afef;">standard_worker_task</span>(<span style="color: #c678dd;">const</span> Matrix&amp; A, <span style="color: #c678dd;">const</span> Matrix&amp; B, Matrix&amp; C, <span style="color: #d19a66;">int</span> start_row, <span style="color: #d19a66;">int</span> end_row) {
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = start_row; i &lt; end_row; ++i) {
        <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> j = <span style="color: #d19a66;">0</span>; j &lt; B.cols; ++j) {
            <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> k = <span style="color: #d19a66;">0</span>; k &lt; A.cols; ++k) {
                C.data[i][j] += A.data[i][k] * B.data[k][j];
            }
        }
    }
}

<span style="color: #5c6370;">// HÃ m Ä‘iá»u phá»‘i viá»‡c nhÃ¢n ma tráº­n Ä‘a luá»“ng</span>
Matrix <span style="color: #61afef;">multiply_multithreaded</span>(<span style="color: #c678dd;">const</span> Matrix&amp; A, <span style="color: #c678dd;">const</span> Matrix&amp; B) {
    <span style="color: #d19a66;">unsigned int</span> num_threads = std::thread::hardware_concurrency();
    Matrix C;
    C.rows = A.rows;
    C.cols = B.cols;
    C.data.assign(C.rows, std::vector&lt;<span style="color: #d19a66;">int</span>&gt;(C.cols, <span style="color: #d19a66;">0</span>));
    std::vector&lt;std::thread&gt; threads;
    
    <span style="color: #d19a66;">int</span> rows_per_thread = A.rows / num_threads;

    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">unsigned int</span> i = <span style="color: #d19a66;">0</span>; i &lt; num_threads; ++i) {
        <span style="color: #d19a66;">int</span> start = i * rows_per_thread;
        <span style="color: #d19a66;">int</span> end = (i == num_threads - <span style="color: #d19a66;">1</span>) ? A.rows : start + rows_per_thread;
        threads.emplace_back(standard_worker_task, std::cref(A), std::cref(B), std::ref(C), start, end);
    }

    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">auto</span>&amp; th : threads) {
        th.join();
    }
    <span style="color: #c678dd;">return</span> C;
}

<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    <span style="color: #c678dd;">try</span> {
        Matrix A = read_matrix_from_file(<span style="color: #98c379;">"A.txt"</span>);
        Matrix B = read_matrix_from_file(<span style="color: #98c379;">"B.txt"</span>);

        <span style="color: #c678dd;">if</span> (A.cols != B.rows) {
            <span style="color: #c678dd;">throw</span> std::invalid_argument(<span style="color: #98c379;">"Error: Incompatible matrix dimensions."</span>);
        }

        <span style="color: #d19a66;">auto</span> start_time = std::chrono::high_resolution_clock::now();
        Matrix C = multiply_multithreaded(A, B);
        <span style="color: #d19a66;">auto</span> end_time = std::chrono::high_resolution_clock::now();

        <span style="color: #d19a66;">auto</span> duration = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(end_time - start_time);
        std::cout &lt;&lt; <span style="color: #98c379;">"Time taken for standard multi-threading: "</span> &lt;&lt; duration.count() &lt;&lt; <span style="color: #98c379;">" milliseconds\n"</span>;

        write_matrix_to_file(C, <span style="color: #98c379;">"C_multithread_standard.txt"</span>);
        std::cout &lt;&lt; <span style="color: #98c379;">"Result saved to C_multithread_standard.txt\n"</span>;

    } <span style="color: #c678dd;">catch</span> (<span style="color: #c678dd;">const</span> std::exception&amp; e) {
        std::cerr &lt;&lt; <span style="color: #98c379;">"An error occurred: "</span> &lt;&lt; e.what() &lt;&lt; std::endl;
        <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">1</span>;
    }
    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}
</code></pre>
					</div>
					<div class="explanation-panel hidden mt-4 border-l-4 border-sky-500 bg-sky-50 p-4 rounded-r-lg text-gray-700">
						<h6 class="font-bold text-lg mb-2 text-sky-800">Giáº£i thÃ­ch sÃ¢u hÆ¡n</h6>
						<p class="mb-2">ChÆ°Æ¡ng trÃ¬nh nÃ y lÃ  má»™t bÆ°á»›c tiáº¿n tá»« phiÃªn báº£n tuáº§n tá»± báº±ng cÃ¡ch Ã¡p dá»¥ng láº­p trÃ¬nh song song Ä‘á»ƒ tÄƒng tá»‘c Ä‘á»™ tÃ­nh toÃ¡n. Ã tÆ°á»Ÿng cá»‘t lÃµi lÃ  chia nhá» cÃ´ng viá»‡c vÃ  giao cho nhiá»u "cÃ´ng nhÃ¢n" (luá»“ng) lÃ m viá»‡c cÃ¹ng má»™t lÃºc.</p>

						<p class="font-semibold mt-4">1. Chiáº¿n lÆ°á»£c song song hÃ³a: Chia theo hÃ ng ğŸ“‹</p>
						<p class="mb-2">Chiáº¿n lÆ°á»£c Ä‘Æ°á»£c sá»­ dá»¥ng á»Ÿ Ä‘Ã¢y lÃ  phÃ¢n rÃ£ dá»¯ liá»‡u (data decomposition). ToÃ n bá»™ cÃ´ng viá»‡c tÃ­nh toÃ¡n ma tráº­n C Ä‘Æ°á»£c chia thÃ nh cÃ¡c pháº§n Ä‘á»™c láº­p. Má»—i pháº§n lÃ  viá»‡c tÃ­nh toÃ¡n má»™t táº­p há»£p cÃ¡c hÃ ng cá»§a ma tráº­n C.</p>
						<p class="mt-2"><strong>Táº¡i sao chia theo hÃ ng lÃ  an toÃ n?</strong> Viá»‡c tÃ­nh toÃ¡n giÃ¡ trá»‹ cho má»™t hÃ ng <code>C[i]</code> chá»‰ phá»¥ thuá»™c vÃ o hÃ ng <code>A[i]</code> vÃ  toÃ n bá»™ ma tráº­n B. NÃ³ hoÃ n toÃ n Ä‘á»™c láº­p vá»›i viá»‡c tÃ­nh toÃ¡n cÃ¡c hÃ ng khÃ¡c cá»§a C. Do Ä‘Ã³, cÃ¡c luá»“ng cÃ³ thá»ƒ ghi káº¿t quáº£ vÃ o cÃ¡c hÃ ng khÃ¡c nhau cá»§a ma tráº­n C mÃ  khÃ´ng gÃ¢y ra tÃ¬nh tráº¡ng tranh cháº¥p (<code>race condition</code>). ÄÃ¢y lÃ  má»™t Æ°u Ä‘iá»ƒm lá»›n vÃ¬ chÃºng ta khÃ´ng cáº§n cÃ¡c cÆ¡ cháº¿ khÃ³a (locking) phá»©c táº¡p nhÆ° <code>mutex</code>, giÃºp mÃ£ nguá»“n Ä‘Æ¡n giáº£n vÃ  hiá»‡u quáº£ hÆ¡n.</p>

						<p class="font-semibold mt-4">2. Vai trÃ² cá»§a cÃ¡c hÃ m</p>
						<p class="mb-2"><strong><code>multiply_multithreaded</code> (HÃ m Ä‘iá»u phá»‘i - Dispatcher):</strong> HÃ m nÃ y Ä‘Ã³ng vai trÃ² nhÆ° má»™t ngÆ°á»i quáº£n lÃ½ dá»± Ã¡n.</p>
						<ul class="list-disc list-inside space-y-2 mt-2 ml-4">
							<li><strong>XÃ¡c Ä‘á»‹nh nhÃ¢n lá»±c:</strong> DÃ¹ng <code>std::thread::hardware_concurrency()</code> Ä‘á»ƒ biáº¿t cÃ³ bao nhiÃªu cÃ´ng nhÃ¢n (luá»“ng) lÃ  tá»‘i Æ°u.</li>
							<li><strong>Chuáº©n bá»‹ cÃ´ng viá»‡c:</strong> Khá»Ÿi táº¡o ma tráº­n káº¿t quáº£ C.</li>
							<li><strong>PhÃ¢n cÃ´ng:</strong> VÃ²ng láº·p <code>for</code> chia cÃ¡c hÃ ng cá»§a C thÃ nh cÃ¡c "gÃ³i cÃ´ng viá»‡c" (xÃ¡c Ä‘á»‹nh bá»Ÿi <code>start_row</code> vÃ  <code>end_row</code>).</li>
							<li><strong>Tuyá»ƒn dá»¥ng vÃ  giao viá»‡c:</strong> Táº¡o ra cÃ¡c Ä‘á»‘i tÆ°á»£ng <code>std::thread</code>, má»—i Ä‘á»‘i tÆ°á»£ng Ä‘Æ°á»£c giao cho má»™t hÃ m <code>standard_worker_task</code> cÃ¹ng vá»›i "gÃ³i cÃ´ng viá»‡c" tÆ°Æ¡ng á»©ng.</li>
							<li><strong>Chá» Ä‘á»£i:</strong> DÃ¹ng <code>join()</code> Ä‘á»ƒ Ä‘áº£m báº£o ngÆ°á»i quáº£n lÃ½ khÃ´ng "bÃ¡o cÃ¡o hoÃ n thÃ nh" dá»± Ã¡n trÆ°á»›c khi táº¥t cáº£ cÃ´ng nhÃ¢n lÃ m xong viá»‡c.</li>
						</ul>
						<p class="mt-2 mb-2"><strong><code>standard_worker_task</code> (HÃ m cÃ´ng nhÃ¢n - Worker):</strong> ÄÃ¢y lÃ  hÃ m mÃ  má»—i luá»“ng sáº½ thá»±c thi. NÃ³ nháº­n pháº§n viá»‡c cá»§a mÃ¬nh (má»™t khoáº£ng cÃ¡c hÃ ng) vÃ  chá»‰ táº­p trung lÃ m Ä‘Ãºng pháº§n viá»‡c Ä‘Ã³. Logic tÃ­nh toÃ¡n bÃªn trong nÃ³ giá»‘ng há»‡t nhÆ° thuáº­t toÃ¡n tuáº§n tá»±, nhÆ°ng pháº¡m vi Ä‘Ã£ Ä‘Æ°á»£c thu háº¹p láº¡i.</p>

						<p class="font-semibold mt-4">3. <code>std::ref</code> vÃ  <code>std::cref</code> - Ká»¹ thuáº­t quan trá»ng khi lÃ m viá»‡c vá»›i luá»“ng</p>
						<p class="mb-2">Theo máº·c Ä‘á»‹nh, khi báº¡n truyá»n tham sá»‘ Ä‘á»ƒ khá»Ÿi táº¡o má»™t <code>std::thread</code>, cÃ¡c tham sá»‘ Ä‘Ã³ sáº½ Ä‘Æ°á»£c sao chÃ©p. Náº¿u chÃºng ta viáº¿t <code>std::thread(..., A, B, C, ...)</code>:</p>
						<ul class="list-disc list-inside space-y-1 mt-2 ml-4">
							<li>CÃ¡c ma tráº­n khá»•ng lá»“ A, B, vÃ  C sáº½ Ä‘Æ°á»£c sao chÃ©p toÃ n bá»™ cho má»—i luá»“ng. Äiá»u nÃ y cá»±c ká»³ tá»‘n kÃ©m vá» bá»™ nhá»› vÃ  thá»i gian.</li>
							<li>Quan trá»ng hÆ¡n, má»—i luá»“ng sáº½ lÃ m viá»‡c trÃªn má»™t báº£n sao cá»§a C, vÃ  káº¿t quáº£ sáº½ khÃ´ng Ä‘Æ°á»£c ghi láº¡i vÃ o ma tráº­n C gá»‘c trong hÃ m <code>multiply_multithreaded</code>.</li>
						</ul>
						<p class="mt-2 mb-2">Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y, chÃºng ta pháº£i nÃ³i rÃµ vá»›i trÃ¬nh biÃªn dá»‹ch ráº±ng "tÃ´i muá»‘n truyá»n tham chiáº¿u, khÃ´ng pháº£i báº£n sao".</p>
						<ul class="list-disc list-inside space-y-2 mt-2">
							<li><strong><code>std::cref(A)</code>:</strong> Viáº¿t táº¯t cá»§a "constant reference wrapper". NÃ³ táº¡o ra má»™t Ä‘á»‘i tÆ°á»£ng bao bá»c A Ä‘á»ƒ Ä‘áº£m báº£o nÃ³ Ä‘Æ°á»£c truyá»n dÆ°á»›i dáº¡ng tham chiáº¿u háº±ng. Luá»“ng cÃ³ thá»ƒ Ä‘á»c A nhÆ°ng khÃ´ng thá»ƒ thay Ä‘á»•i nÃ³.</li>
							<li><strong><code>std::ref(C)</code>:</strong> Viáº¿t táº¯t cá»§a "reference wrapper". NÃ³ bao bá»c C Ä‘á»ƒ Ä‘áº£m báº£o nÃ³ Ä‘Æ°á»£c truyá»n dÆ°á»›i dáº¡ng tham chiáº¿u khÃ´ng háº±ng, cho phÃ©p luá»“ng ghi káº¿t quáº£ tÃ­nh toÃ¡n cá»§a mÃ¬nh vÃ o ma tráº­n C gá»‘c.</li>
						</ul>
						
						<p class="font-semibold mt-4">4. Háº¡n cháº¿: Váº¥n Ä‘á» vá» truy cáº­p bá»™ nhá»› (Cache Locality) ğŸ§ </p>
						<p class="mb-2">Máº·c dÃ¹ nhanh hÆ¡n báº£n tuáº§n tá»±, phiÃªn báº£n nÃ y váº«n chÆ°a tá»‘i Æ°u. Váº¥n Ä‘á» náº±m á»Ÿ cÃ¡ch cÃ¡c luá»“ng truy cáº­p vÃ o ma tráº­n B. Khi tÃ­nh <code>C[i][j]</code>, vÃ²ng láº·p k truy cáº­p <code>A.data[i][k]</code> vÃ  <code>B.data[k][j]</code>.</p>
						<ul class="list-disc list-inside space-y-2 mt-2">
							<li><strong>Truy cáº­p A:</strong> CÃ¡c pháº§n tá»­ <code>A.data[i][k]</code> náº±m liá»n ká» nhau trong bá»™ nhá»› (truy cáº­p theo hÃ ng). CPU cÃ³ thá»ƒ táº£i trÆ°á»›c cáº£ má»™t Ä‘oáº¡n cá»§a hÃ ng nÃ y vÃ o bá»™ nhá»› Ä‘á»‡m (cache) tá»‘c Ä‘á»™ cao, giÃºp cÃ¡c láº§n truy cáº­p tiáº¿p theo ráº¥t nhanh. ÄÃ¢y gá»i lÃ  tÃ­nh cá»¥c bá»™ tham chiáº¿u khÃ´ng gian (spatial locality) tá»‘t.</li>
							<li><strong>Truy cáº­p B:</strong> CÃ¡c pháº§n tá»­ <code>B.data[k][j]</code> láº¡i náº±m cÃ¡ch xa nhau trong bá»™ nhá»› (truy cáº­p theo cá»™t). Äá»ƒ láº¥y <code>B[0][j]</code>, <code>B[1][j]</code>, <code>B[2][j]</code>,... CPU pháº£i nháº£y Ä‘áº¿n cÃ¡c hÃ ng khÃ¡c nhau. Äiá»u nÃ y dáº«n Ä‘áº¿n cache miss thÆ°á»ng xuyÃªn, tá»©c lÃ  dá»¯ liá»‡u cáº§n thiáº¿t khÃ´ng cÃ³ sáºµn trong cache vÃ  CPU pháº£i chá» Ä‘á»ƒ láº¥y nÃ³ tá»« RAM chÃ­nh cháº­m hÆ¡n nhiá»u.</li>
						</ul>
						<p class="mt-2">Khi nhiá»u luá»“ng cÃ¹ng thá»±c hiá»‡n Ä‘iá»u nÃ y, chÃºng cÃ³ thá»ƒ "tranh giÃ nh" cache cá»§a CPU, lÃ m giáº£m hiá»‡u quáº£ tá»•ng thá»ƒ. CÃ¡c phiÃªn báº£n tá»‘i Æ°u hÆ¡n sáº½ cá»‘ gáº¯ng giáº£i quyáº¿t váº¥n Ä‘á» nÃ y, vÃ­ dá»¥ báº±ng cÃ¡ch chuyá»ƒn vá»‹ (transpose) ma tráº­n B trÆ°á»›c khi nhÃ¢n.</p>
					</div>
				</div>
				
				<div class="code-container">
					<h5 class="font-semibold text-lg mt-8 text-cyan-700"><strong>PhiÃªn báº£n 3</strong>: Äa luá»“ng TÄƒng tá»‘c</h5>
					<p class="mb-4">Sá»­ dá»¥ng biáº¿n cá»¥c bá»™ <code class="bg-gray-200 text-cyan-800 font-mono px-1.5 py-1 rounded-md">sum</code> Ä‘á»ƒ giáº£m thiá»ƒu truy cáº­p bá»™ nhá»› chung, mang láº¡i hiá»‡u nÄƒng cao nháº¥t.</p>
					<div class="code-block" data-example-id="optimized-mult">
<pre><code><span style="color: #5c6370;">// multithread_optimized.cpp</span>
<span style="color: #5c6370;">// MÃ´ táº£: PhiÃªn báº£n nhÃ¢n ma tráº­n Ä‘a luá»“ng Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a.</span>
<span style="color: #5c6370;">// Má»—i luá»“ng tÃ­nh toÃ¡n trÃªn biáº¿n cá»¥c bá»™ Ä‘á»ƒ giáº£m thiá»ƒu truy cáº­p bá»™ nhá»› chung,</span>
<span style="color: #5c6370;">// trÃ¡nh hiá»‡n tÆ°á»£ng "False Sharing" vÃ  tÄƒng tá»‘c Ä‘á»™ Ä‘Ã¡ng ká»ƒ.</span>

<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">"matrix_utils.h"</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;chrono&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;thread&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;functional&gt;</span>

<span style="color: #5c6370;">// HÃ m cÃ´ng viá»‡c cho má»—i luá»“ng (phiÃªn báº£n Ä‘Ã£ tá»‘i Æ°u)</span>
<span style="color: #c678dd;">void</span> <span style="color: #61afef;">optimized_worker_task</span>(<span style="color: #c678dd;">const</span> Matrix&amp; A, <span style="color: #c678dd;">const</span> Matrix&amp; B, Matrix&amp; C, <span style="color: #d19a66;">int</span> start_row, <span style="color: #d19a66;">int</span> end_row) {
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = start_row; i &lt; end_row; ++i) {
        <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> j = <span style="color: #d19a66;">0</span>; j &lt; B.cols; ++j) {
            <span style="color: #d19a66;">int</span> sum = <span style="color: #d19a66;">0</span>; <span style="color: #5c6370;">// Tá»‘i Æ°u hÃ³a: tÃ­nh tá»•ng trÃªn biáº¿n cá»¥c bá»™</span>
            <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> k = <span style="color: #d19a66;">0</span>; k &lt; A.cols; ++k) {
                sum += A.data[i][k] * B.data[k][j];
            }
            C.data[i][j] = sum; <span style="color: #5c6370;">// Ghi vÃ o bá»™ nhá»› chung má»™t láº§n duy nháº¥t</span>
        }
    }
}

<span style="color: #5c6370;">// HÃ m Ä‘iá»u phá»‘i chÃ­nh (tÆ°Æ¡ng tá»± báº£n standard, chá»‰ khÃ¡c hÃ m worker)</span>
Matrix <span style="color: #61afef;">multiply_multithreaded_optimized</span>(<span style="color: #c678dd;">const</span> Matrix&amp; A, <span style="color: #c678dd;">const</span> Matrix&amp; B) {
    <span style="color: #d19a66;">unsigned int</span> num_threads = std::thread::hardware_concurrency();
    Matrix C;
    C.rows = A.rows;
    C.cols = B.cols;
    C.data.assign(C.rows, std::vector&lt;<span style="color: #d19a66;">int</span>&gt;(C.cols, <span style="color: #d19a66;">0</span>));
    std::vector&lt;std::thread&gt; threads;
    
    <span style="color: #d19a66;">int</span> rows_per_thread = A.rows / num_threads;

    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">unsigned int</span> i = <span style="color: #d19a66;">0</span>; i &lt; num_threads; ++i) {
        <span style="color: #d19a66;">int</span> start = i * rows_per_thread;
        <span style="color: #d19a66;">int</span> end = (i == num_threads - <span style="color: #d19a66;">1</span>) ? A.rows : start + rows_per_thread;
        threads.emplace_back(optimized_worker_task, std::cref(A), std::cref(B), std::ref(C), start, end);
    }

    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">auto</span>&amp; th : threads) {
        th.join();
    }
    <span style="color: #c678dd;">return</span> C;
}

<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    <span style="color: #c678dd;">try</span> {
        Matrix A = read_matrix_from_file(<span style="color: #98c379;">"A.txt"</span>);
        Matrix B = read_matrix_from_file(<span style="color: #98c379;">"B.txt"</span>);

        <span style="color: #c678dd;">if</span> (A.cols != B.rows) {
            <span style="color: #c678dd;">throw</span> std::invalid_argument(<span style="color: #98c379;">"Error: Incompatible matrix dimensions."</span>);
        }

        <span style="color: #d19a66;">auto</span> start_time = std::chrono::high_resolution_clock::now();
        Matrix C = multiply_multithreaded_optimized(A, B);
        <span style="color: #d19a66;">auto</span> end_time = std::chrono::high_resolution_clock::now();

        <span style="color: #d19a66;">auto</span> duration = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(end_time - start_time);
        std::cout &lt;&lt; <span style="color: #98c379;">"Time taken for OPTIMIZED multi-threading: "</span> &lt;&lt; duration.count() &lt;&lt; <span style="color: #98c379;">" milliseconds\n"</span>;

        write_matrix_to_file(C, <span style="color: #98c379;">"C_multithread_optimized.txt"</span>);
        std::cout &lt;&lt; <span style="color: #98c379;">"Result saved to C_multithread_optimized.txt\n"</span>;

    } <span style="color: #c678dd;">catch</span> (<span style="color: #c678dd;">const</span> std::exception&amp; e) {
        std::cerr &lt;&lt; <span style="color: #98c379;">"An error occurred: "</span> &lt;&lt; e.what() &lt;&lt; std::endl;
        <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">1</span>;
    }
    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}
</code></pre>
					</div>
					<div class="explanation-panel hidden mt-4 border-l-4 border-sky-500 bg-sky-50 p-4 rounded-r-lg text-gray-700">
						<h6 class="font-bold text-lg mb-2 text-sky-800">Giáº£i thÃ­ch sÃ¢u hÆ¡n</h6>
						<p class="mb-2">Sá»± khÃ¡c biá»‡t giá»¯a phiÃªn báº£n "standard" vÃ  "optimized" trÃ´ng cÃ³ váº» ráº¥t nhá» â€” chá»‰ lÃ  thÃªm má»™t biáº¿n <code>sum</code> cá»¥c bá»™ â€” nhÆ°ng nÃ³ láº¡i mang láº¡i má»™t lá»£i Ã­ch hiá»‡u nÄƒng ráº¥t lá»›n. Tá»‘i Æ°u hÃ³a nÃ y giáº£i quyáº¿t má»™t váº¥n Ä‘á» tinh vi liÃªn quan Ä‘áº¿n cÃ¡ch CPU vÃ  bá»™ nhá»› tÆ°Æ¡ng tÃ¡c vá»›i nhau.</p>

						<p class="font-semibold mt-4">1. Tá»‘i Æ°u hÃ³a Cá»‘t lÃµi: Local Accumulation (TÃ­ch lÅ©y cá»¥c bá»™) ğŸ§ </p>
						<p class="mb-2">HÃ£y so sÃ¡nh hai cÃ¡ch tiáº¿p cáº­n trong vÃ²ng láº·p trong cÃ¹ng:</p>
						<ul class="list-disc list-inside space-y-2 mt-2">
							<li>
								<strong>PhiÃªn báº£n Standard:</strong> <code>C.data[i][j] += A.data[i][k] * B.data[k][j];</code>
								<p class="ml-5 mt-1">ÄÃ¢y lÃ  má»™t thao tÃ¡c Äá»c-Sá»­a-Ghi (Read-Modify-Write) trá»±c tiáº¿p trÃªn bá»™ nhá»› dÃ¹ng chung (ma tráº­n C). Vá»›i má»—i giÃ¡ trá»‹ cá»§a <strong>k</strong>, luá»“ng pháº£i Ä‘á»c giÃ¡ trá»‹ hiá»‡n táº¡i cá»§a <code>C.data[i][j]</code>, sá»­a Ä‘á»•i, rá»“i ghi láº¡i. Thao tÃ¡c nÃ y Ä‘Æ°á»£c láº·p láº¡i <code>A.cols</code> láº§n cho má»—i pháº§n tá»­ cá»§a C.</p>
							</li>
							<li>
								<strong>PhiÃªn báº£n Optimized:</strong> <code>sum += A.data[i][k] * B.data[k][j];</code>
								<p class="ml-5 mt-1">Biáº¿n <code>sum</code> lÃ  má»™t biáº¿n cá»¥c bá»™ (local variable). TrÃ¬nh biÃªn dá»‹ch gáº§n nhÆ° cháº¯c cháº¯n sáº½ Ä‘áº·t biáº¿n nÃ y vÃ o má»™t thanh ghi (CPU register) - bá»™ nhá»› nhanh nháº¥t cÃ³ trong mÃ¡y tÃ­nh. Má»i phÃ©p cá»™ng dá»“n Ä‘á»u diá»…n ra bÃªn trong CPU vá»›i tá»‘c Ä‘á»™ cá»±c cao. Chá»‰ sau khi vÃ²ng láº·p <strong>k</strong> káº¿t thÃºc, má»™t thao tÃ¡c Ghi (Write) duy nháº¥t <code>C.data[i][j] = sum;</code> Ä‘Æ°á»£c thá»±c hiá»‡n.</p>
							</li>
						</ul>
						<p class="mt-2"><strong>Káº¿t quáº£:</strong> Thay vÃ¬ thá»±c hiá»‡n <code>A.cols</code> lÆ°á»£t Äá»c-Sá»­a-Ghi vÃ o bá»™ nhá»› cháº­m, chÃºng ta chá»‰ thá»±c hiá»‡n <code>A.cols</code> lÆ°á»£t cá»™ng trong thanh ghi siÃªu nhanh vÃ  chá»‰ má»™t láº§n ghi vÃ o bá»™ nhá»›.</p>

						<p class="font-semibold mt-4">2. TrÃ¡nh hiá»‡n tÆ°á»£ng "False Sharing" (Chia sáº» giáº£) ğŸ‘»</p>
						<p class="mb-2">ÄÃ¢y lÃ  má»™t lá»£i Ã­ch sÃ¢u xa vÃ  quan trá»ng hÆ¡n cá»§a viá»‡c tá»‘i Æ°u hÃ³a nÃ y.</p>
						<ul class="list-disc list-inside space-y-2 mt-2">
							<li><strong>CPU Cache lÃ  gÃ¬?</strong> CPU khÃ´ng Ä‘á»c tá»«ng byte tá»« RAM. Thay vÃ o Ä‘Ã³, nÃ³ Ä‘á»c cáº£ má»™t khá»‘i dá»¯ liá»‡u liá»n ká» gá»i lÃ  <strong>cache line</strong> (thÆ°á»ng lÃ  64 bytes) vÃ o bá»™ nhá»› Ä‘á»‡m (cache) tá»‘c Ä‘á»™ cao cá»§a nÃ³.</li>
							<li><strong>False Sharing xáº£y ra khi nÃ o?</strong> NÃ³ xáº£y ra khi nhiá»u luá»“ng trÃªn cÃ¡c lÃµi khÃ¡c nhau cÃ¹ng sá»­a Ä‘á»•i cÃ¡c biáº¿n khÃ¡c nhau, nhÆ°ng cÃ¡c biáº¿n Ä‘Ã³ láº¡i vÃ´ tÃ¬nh náº±m trÃªn cÃ¹ng má»™t cache line.</li>
						</ul>
						<p class="mt-2 mb-2"><strong>Ká»‹ch báº£n:</strong></p>
						<ol class="list-decimal list-inside space-y-1 mt-2 ml-4">
							<li>Giáº£ sá»­ <code>C.data[i][0]</code> vÃ  <code>C.data[i][1]</code> náº±m trÃªn cÃ¹ng má»™t cache line.</li>
							<li>Luá»“ng 1 Ä‘ang tÃ­nh <code>C.data[i][0]</code> vÃ  Luá»“ng 2 Ä‘ang tÃ­nh <code>C.data[i][1]</code>.</li>
							<li>Khi Luá»“ng 1 ghi vÃ o <code>C.data[i][0]</code>, toÃ n bá»™ cache line chá»©a nÃ³ trÃªn LÃµi 2 (cá»§a Luá»“ng 2) bá»‹ vÃ´ hiá»‡u hÃ³a (invalidated).</li>
							<li>Khi Luá»“ng 2 muá»‘n ghi vÃ o <code>C.data[i][1]</code>, nÃ³ pháº£i chá» LÃµi 1 gá»­i láº¡i toÃ n bá»™ cache line Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t.</li>
						</ol>
						<p class="mt-2">QuÃ¡ trÃ¬nh nÃ y láº·p Ä‘i láº·p láº¡i, cÃ¡c lÃµi CPU liÃªn tá»¥c pháº£i Ä‘á»“ng bá»™ hÃ³a má»™t khá»‘i bá»™ nhá»›, máº·c dÃ¹ chÃºng Ä‘ang lÃ m viá»‡c trÃªn cÃ¡c pháº§n tá»­ dá»¯ liá»‡u hoÃ n toÃ n Ä‘á»™c láº­p. Báº±ng cÃ¡ch sá»­ dá»¥ng biáº¿n <code>sum</code> cá»¥c bá»™, phiÃªn báº£n tá»‘i Æ°u Ä‘Ã£ loáº¡i bá» hoÃ n toÃ n cÃ¡c thao tÃ¡c ghi láº·p Ä‘i láº·p láº¡i vÃ o bá»™ nhá»› chung, do Ä‘Ã³ triá»‡t tiÃªu nguy cÆ¡ xáº£y ra False Sharing, cho phÃ©p cÃ¡c lÃµi CPU hoáº¡t Ä‘á»™ng Ä‘á»™c láº­p vÃ  hiá»‡u quáº£ hÆ¡n nhiá»u.</p>
					</div>
				</div>
				
				<h5 class="font-semibold text-lg mt-8 text-cyan-700">Lá»‡nh biÃªn dá»‹ch vÃ  thá»±c thi (trÃªn terminal cá»§a Linux/macOS/VSCode)</h5>
                <p class="mb-4">Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c lá»‡nh sau trong terminal Ä‘á»ƒ biÃªn dá»‹ch vÃ  cháº¡y cáº£ ba phiÃªn báº£n, sau Ä‘Ã³ so sÃ¡nh thá»i gian thá»±c thi cá»§a chÃºng.</p>
                <div class="code-block">
<pre><code><span style="color: #5c6370;"># 1. BiÃªn dá»‹ch cÃ¡c tá»‡p nguá»“n</span>
g++ sequential_multiplication.cpp -o sequential -std=c++11
g++ multithread_standard.cpp -o standard_mt -std=c++11 -pthread
g++ multithread_optimized.cpp -o optimized_mt -std=c++11 -pthread

<span style="color: #5c6370;"># 2. Thá»±c thi cÃ¡c tá»‡p Ä‘Ã£ biÃªn dá»‹ch</span>
./sequential
./standard_mt
./optimized_mt
</code></pre>
                </div>
			
			<div class="border-t pt-8 mt-8">
				<h4 class="font-bold text-2xl mb-3 text-cyan-700 text-center">6.3. So sÃ¡nh hiá»‡u nÄƒng</h4>
				<p class="mb-8 text-center max-w-3xl mx-auto text-gray-700">Biá»ƒu Ä‘á»“ dÆ°á»›i Ä‘Ã¢y minh há»a thá»i gian thá»±c thi cá»§a ba phiÃªn báº£n. Káº¿t quáº£ cho tháº¥y phiÃªn báº£n láº­p trÃ¬nh Ä‘a luá»“ng cÆ¡ báº£n nhanh hÆ¡n <strong>4,4 láº§n</strong> so vá»›i láº­p trÃ¬nh tuáº§n tá»±. Quan trá»ng hÆ¡n, phiÃªn báº£n tÄƒng tá»‘c nhanh hÆ¡n <strong>6,8 láº§n</strong> so vá»›i phiÃªn báº£n tuáº§n tá»± vÃ  <strong>1,5</strong> láº§n so vá»›i phiÃªn báº£n Ä‘a luá»“ng cÆ¡ báº£n, chá»©ng tá» tÃ¡c Ä‘á»™ng to lá»›n cá»§a viá»‡c tá»‘i Æ°u hÃ³a truy cáº­p bá»™ nhá»›.</p>
				
				<div class="chart-container h-80 md:h-96">
					<canvas id="performanceChart"></canvas>
				</div>
				
				<p class="mt-2 text-center text-gray-400 text-sm italic">* Sau khi cháº¡y xong má»™t chÆ°Æ¡ng trÃ¬nh pháº£i khá»Ÿi Ä‘á»™ng láº¡i mÃ¡y tÃ­nh Ä‘á»ƒ xÃ³a dá»¯ liá»‡u Ä‘Ã£ náº¡p vÃ o RAM tá»« láº§n cháº¡y trÆ°á»›c.</p>
			</div>
		</section>

    </main>

    <footer class="bg-gray-800 text-white text-center p-4 mt-8">
        <p>Nguyá»…n VÄƒn Tuáº¥n, Nguyá»…n VÅ© CÆ°á»ng, Äáº·ng Quang DÆ°, Tráº§n Há»¯u Máº¡nh, Äá»— VÄƒn Máº¡nh, DÆ°Æ¡ng Huy HoÃ ng - KTVT37</p>
    </footer>

    <button id="backToTopBtn" title="Go to top" class="hidden fixed bottom-5 right-5 bg-cyan-600 text-white p-3 rounded-full shadow-lg hover:bg-cyan-700 transition-colors z-50">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
        </svg>
    </button>

<script>
document.addEventListener('DOMContentLoaded', function() {
	
	Chart.register(ChartDataLabels);
    // --- Äiá»u hÆ°á»›ng cuá»™n mÆ°á»£t ---
    document.querySelectorAll('header a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const targetElement = document.querySelector(this.getAttribute('href'));
            if(targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth' });
            }
        });
    });

    // --- Biá»ƒu Ä‘á»“ Moore's Law ---
    const mooreCtx = document.getElementById('mooreLawChart').getContext('2d');
    new Chart(mooreCtx, {
        type: 'line',
        data: {
            labels: ['1972', '1978', '1984', '1990', '1996', '2002', '2005', '2008', '2011', '2014', '2017', '2020', '2023', '2026'],
            datasets: [{
                label: 'Chu ká»³ trÃªn giÃ¢y (triá»‡u)',
                data: [2, 4, 10, 50, 300, 3000, 4000, 4500, 4200, 5000, 4800, 5000, 5500, 6000],
				borderColor: 'rgb(0, 0, 0)',
                backgroundColor: 'rgba(0, 0, 0, 0.5)',
                yAxisID: 'y',
                tension: 0.1,
                fill: false,
                pointRadius: 4,
                pointBackgroundColor: 'rgb(0, 0, 0)'
            }, {
                label: 'Sá»‘ lÃµi',
                data: [1, 1, 1, 1, 1, 1, 2, 6, 10, 18, 32, 64, 128, 256],
                borderColor: 'rgb(54, 162, 235)',
                backgroundColor: 'rgba(54, 162, 235, 0.5)',
                yAxisID: 'y1',
                tension: 0.1,
                fill: false,
                pointRadius: 4,
                pointBackgroundColor: 'rgb(54, 162, 235)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: "Tá»‘c Ä‘á»™ CPU vÃ  sá»‘ lÆ°á»£ng lÃµi (Thang Ä‘o Logarit)"
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        label: function(context) {
							let label = context.dataset.label || '';
							if (label) { label += ': '; }
							if (context.parsed.y !== null) {
								if (context.datasetIndex === 0) { // Tá»‘c Ä‘á»™ xung nhá»‹p
									// GiÃ¡ trá»‹ bÃ¢y giá» Ä‘Ã£ lÃ  MHz, chá»‰ cáº§n thÃªm Ä‘Æ¡n vá»‹
									label += context.parsed.y.toLocaleString() + ' MHz';
								} else { // Sá»‘ lÃµi
									label += context.parsed.y;
								}
							}
							return label;
						}
                    }
                }
            },
            scales: {
				y: {
					type: 'logarithmic',
					display: true,
					position: 'left',
					title: { display: true, text: 'Chu ká»³ trÃªn giÃ¢y (triá»‡u)' }
				},
                y1: {
                    type: 'logarithmic',
                    display: true,
                    position: 'right',
                    grid: { drawOnChartArea: false },
                    title: { display: true, text: 'Sá»‘ lÃµi' },
                    min: 1,
                    ticks: {
                        callback: function(value, index, values) {
                           const coreTicks = [1, 2, 4, 8, 16, 32, 64, 128, 256];
                           if (coreTicks.includes(Number(value))) { return value; }
                        }
                    }
                }
            }
        }
    });

    // --- BIá»‚U Äá»’ SO SÃNH HIá»†U NÄ‚NG (ÄÃƒ ÄÆ¯á»¢C THÃŠM Láº I) ---
    if (document.getElementById('performanceChart')) {
        const perfCtx = document.getElementById('performanceChart').getContext('2d');
        new Chart(perfCtx, {
            type: 'bar',
            data: {
                labels: ['Tuáº§n tá»± (ÄÆ¡n luá»“ng)', 'Äa luá»“ng CÆ¡ báº£n', 'Äa luá»“ng TÄƒng tá»‘c'],
                datasets: [{
                    label: 'Thá»i gian thá»±c thi (ms)',
                    data: [43029, 9790, 6363],
                    backgroundColor: [
                        'rgba(239, 68, 68, 0.6)', // Red
                        'rgba(59, 130, 246, 0.6)', // Blue
                        'rgba(22, 163, 74, 0.6)'  // Green
                    ],
                    borderColor: [
                        'rgba(239, 68, 68, 1)',
                        'rgba(59, 130, 246, 1)',
                        'rgba(22, 163, 74, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'So sÃ¡nh thá»i gian nhÃ¢n ma tráº­n (cÃ ng tháº¥p cÃ ng tá»‘t)',
                        align: 'center',
                        font: { size: 18 },
                        padding: { bottom: 20 }
                    },
                    legend: { display: false },
                    // Cáº¥u hÃ¬nh Ä‘á»ƒ hiá»ƒn thá»‹ giÃ¡ trá»‹ trÃªn Ä‘á»‰nh cá»™t
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        offset: 4,
                        color: '#4A5568',
                        font: {
                            weight: 'bold',
                            size: 13
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Thá»i gian (mili giÃ¢y)'
                        }
                    }
                }
            }
        });
    }

    // --- VÃ²ng Ä‘á»i luá»“ng tÆ°Æ¡ng tÃ¡c ---
    const lifecycleStates = [
        { name: 'NEW', color: 'gray', description: 'ÄÃ¢y lÃ  tráº¡ng thÃ¡i Ä‘áº§u tiÃªn cá»§a luá»“ng sau khi nÃ³ Ä‘Æ°á»£c táº¡o ra (vÃ­ dá»¥, báº±ng cÃ¡ch khá»Ÿi táº¡o má»™t Ä‘á»‘i tÆ°á»£ng std::thread trong C++). á» tráº¡ng thÃ¡i nÃ y, luá»“ng Ä‘Ã£ tá»“n táº¡i nhÆ°ng chÆ°a báº¯t Ä‘áº§u thá»±c thi. MÃ£ cá»§a nÃ³ chÆ°a Ä‘Æ°á»£c cháº¡y, vÃ  há»‡ Ä‘iá»u hÃ nh chÆ°a cáº¥p phÃ¡t tÃ i nguyÃªn thá»±c thi cho nÃ³.' },
        { name: 'RUNNABLE', color: 'green', description: 'Sau khi phÆ°Æ¡ng thá»©c start() (trong Java) hoáº·c khi Ä‘á»‘i tÆ°á»£ng std::thread Ä‘Æ°á»£c khá»Ÿi táº¡o vá»›i má»™t hÃ m (trong C++), luá»“ng sáº½ chuyá»ƒn sang tráº¡ng thÃ¡i Runnable. "Runnable" khÃ´ng cÃ³ nghÄ©a lÃ  luá»“ng Ä‘ang cháº¡y. NÃ³ cÃ³ nghÄ©a lÃ  luá»“ng Ä‘Ã£ sáºµn sÃ ng Ä‘á»ƒ cháº¡y vÃ  Ä‘ang náº±m trong hÃ ng Ä‘á»£i, chá» bá»™ láº­p lá»‹ch (scheduler) cá»§a há»‡ Ä‘iá»u hÃ nh cáº¥p phÃ¡t cho nÃ³ má»™t lÃ¡t cáº¯t thá»i gian (time slice) trÃªn CPU.' },
		{ name: 'RUNNING', color: 'blue', description: 'Khi bá»™ láº­p lá»‹ch chá»n má»™t luá»“ng tá»« tráº¡ng thÃ¡i Runnable vÃ  cáº¥p phÃ¡t CPU cho nÃ³, luá»“ng Ä‘Ã³ sáº½ chuyá»ƒn sang tráº¡ng thÃ¡i Running. ÄÃ¢y lÃ  tráº¡ng thÃ¡i mÃ  cÃ¡c lá»‡nh cá»§a luá»“ng Ä‘ang thá»±c sá»± Ä‘Æ°á»£c thá»±c thi.' },
        { name: 'TERMINATED', color: 'purple', description: 'Khi má»™t luá»“ng hoÃ n thÃ nh viá»‡c thá»±c thi phÆ°Æ¡ng thá»©c chÃ­nh cá»§a nÃ³ (vÃ­ dá»¥: phÆ°Æ¡ng thá»©c run() trong Java hoáº·c hÃ m Ä‘Æ°á»£c truyá»n cho std::thread trong C++), nÃ³ sáº½ chuyá»ƒn sang tráº¡ng thÃ¡i Terminated. Luá»“ng sáº½ ngá»«ng hoáº¡t Ä‘á»™ng vÄ©nh viá»…n vÃ  khÃ´ng thá»ƒ Ä‘Æ°á»£c khá»Ÿi Ä‘á»™ng láº¡i.' },
        { name: 'BLOCKED/WAITING', color: 'red', description: 'Má»™t luá»“ng Ä‘ang cháº¡y cÃ³ thá»ƒ chuyá»ƒn sang tráº¡ng thÃ¡i bá»‹ cháº·n vÃ¬ nhiá»u lÃ½ do. á» tráº¡ng thÃ¡i nÃ y, luá»“ng táº¡m thá»i ngá»«ng thá»±c thi vÃ  khÃ´ng sá»­ dá»¥ng CPU, chá» Ä‘á»£i má»™t sá»± kiá»‡n nÃ o Ä‘Ã³ xáº£y ra.CÃ¡c nguyÃªn nhÃ¢n phá»• biáº¿n bao gá»“m: <br> - Luá»“ng Ä‘ang cá»‘ gáº¯ng chiáº¿m má»™t khÃ³a (lock) mÃ  má»™t luá»“ng khÃ¡c Ä‘ang giá»¯.<br>- Luá»“ng gá»i má»™t phÆ°Æ¡ng thá»©c gÃ¢y cháº·n, vÃ­ dá»¥ nhÆ° chá» dá»¯ liá»‡u tá»« máº¡ng hoáº·c Ä‘Ä©a (I/O operation).<br>- Luá»“ng tá»± nguyá»‡n Ä‘i vÃ o tráº¡ng thÃ¡i chá» báº±ng cÃ¡ch gá»i cÃ¡c phÆ°Æ¡ng thá»©c nhÆ° sleep(), wait(), hoáº·c join() trÃªn má»™t luá»“ng khÃ¡c. <br> Khi sá»± kiá»‡n mÃ  luá»“ng Ä‘ang chá» Ä‘á»£i xáº£y ra (vÃ­ dá»¥: khÃ³a Ä‘Æ°á»£c giáº£i phÃ³ng, dá»¯ liá»‡u I/O cÃ³ sáºµn), luá»“ng sáº½ quay trá»Ÿ láº¡i tráº¡ng thÃ¡i Runnable, sáºµn sÃ ng Ä‘á»ƒ Ä‘Æ°á»£c láº­p lá»‹ch cháº¡y láº¡i.' }
    ];

    const topRowContainer = document.getElementById('lifecycle-top-row');
    const bottomRowContainer = document.getElementById('lifecycle-bottom-row');
    const detailsPanel = document.getElementById('lifecycle-details');
    let activeStateElement = null;

    // HÃ m táº¡o má»™t khá»‘i tráº¡ng thÃ¡i
    const createStateElement = (state) => {
        const stateEl = document.createElement('div');
        stateEl.className = `cursor-pointer p-3 rounded-lg border-2 bg-white transition-all shadow-sm hover:shadow-md hover:scale-105 border-${state.color}-300`;
        stateEl.textContent = state.name;
        stateEl.dataset.description = state.description;
        stateEl.dataset.color = state.color;
        
        stateEl.addEventListener('click', () => {
            if (activeStateElement) {
                const oldColor = activeStateElement.dataset.color;
                activeStateElement.classList.remove(`bg-${oldColor}-200`, `border-${oldColor}-500`, 'scale-110');
                activeStateElement.classList.add(`bg-white`, `border-${oldColor}-300`);
            }
            detailsPanel.innerHTML = `<h5 class="font-bold text-lg text-${state.color}-600 mb-2">${state.name}</h5><p>${state.description}</p>`;
            stateEl.classList.add(`bg-${state.color}-200`, `border-${state.color}-500`, 'scale-110');
            stateEl.classList.remove(`bg-white`, `border-${state.color}-300`);
            activeStateElement = stateEl;
        });
        return stateEl;
    };

    // HÃ m táº¡o má»™t mÅ©i tÃªn
    const createArrowElement = (content) => {
        const arrow = document.createElement('div');
        arrow.className = 'text-2xl text-gray-400';
        arrow.innerHTML = content;
        return arrow;
    };

    // Äiá»n cÃ¡c tráº¡ng thÃ¡i vÃ o Ä‘Ãºng táº§ng
    lifecycleStates.forEach(state => {
        if (state.name === 'BLOCKED/WAITING') {
            bottomRowContainer.appendChild(createStateElement(state));
        } else {
            // Náº¿u khÃ´ng pháº£i tráº¡ng thÃ¡i Ä‘áº§u tiÃªn thÃ¬ thÃªm mÅ©i tÃªn vÃ o trÆ°á»›c
            if (topRowContainer.hasChildNodes()) {
                const arrowContent = (state.name === 'RUNNING') ? '&leftrightarrow;' : '&rarr;';
                topRowContainer.appendChild(createArrowElement(arrowContent));
            }
            topRowContainer.appendChild(createStateElement(state));
        }
    });

    // --- Chuyá»ƒn Tab cho Váº¥n Ä‘á» thÆ°á»ng gáº·p ---
    const tabOverall = document.getElementById('tab-overall'), tabRace = document.getElementById('tab-race'), tabDeadlock = document.getElementById('tab-deadlock'), tabOther = document.getElementById('tab-other');
    const contentOverall = document.getElementById('content-tab-overall'), contentRace = document.getElementById('content-race'), contentDeadlock = document.getElementById('content-deadlock'), contentOther = document.getElementById('content-other');
    const allTabs = [tabOverall, tabRace, tabDeadlock, tabOther], allContents = [contentOverall, contentRace, contentDeadlock, contentOther];
    const switchTab = (activeIndex) => {
        allContents.forEach((c, i) => c.classList.toggle('hidden', i !== activeIndex));
        allTabs.forEach((t, i) => {
            t.classList.toggle('border-cyan-500', i === activeIndex);
            t.classList.toggle('text-cyan-600', i === activeIndex);
            t.classList.toggle('border-transparent', i !== activeIndex);
            t.classList.toggle('text-gray-500', i !== activeIndex);
        });
    };
	tabOverall.addEventListener('click', () => switchTab(0));
    tabRace.addEventListener('click', () => switchTab(1));
    tabDeadlock.addEventListener('click', () => switchTab(2));
    tabOther.addEventListener('click', () => switchTab(3));

    // --- MÃ´ phá»ng Race Condition ---
    const counterValueEl = document.getElementById('counter-value'),
          startUnsyncedBtn = document.getElementById('start-step-unsynced'),
          startSyncedBtn = document.getElementById('start-step-synced'),
          runNextStepBtn = document.getElementById('run-next-step'),
          resetCounterBtn = document.getElementById('reset-counter'), // ThÃªm láº¡i nÃºt Reset
          simLogEl = document.getElementById('simulation-log');

    let balance = 1000, currentStep = 0;
    let tempBalanceA = 0, tempBalanceB = 0;
    let activeSteps = null;

    const unsyncedSteps = [
        () => { log('Báº¯t Ä‘áº§u mÃ´ phá»ng <strong class="text-red-500">KHÃ”NG</strong> Ä‘á»“ng bá»™...'); },
        () => { tempBalanceA = balance; log(`Luá»“ng A (rÃºt tiá»n) Ä‘á»c sá»‘ dÆ°: ${tempBalanceA}`); },
        () => { tempBalanceB = balance; log(`Luá»“ng B (náº¡p tiá»n) Ä‘á»c sá»‘ dÆ°: ${tempBalanceB}`); },
        () => { tempBalanceB += 200; balance = tempBalanceB; log(`Luá»“ng B ghi sá»‘ dÆ° má»›i: <strong class="text-blue-500">${balance}</strong>`); counterValueEl.textContent = balance; },
        () => { tempBalanceA -= 100; balance = tempBalanceA; log(`Luá»“ng A ghi Ä‘Ã¨ sá»‘ dÆ°: <strong class="text-red-500">${balance}</strong>`); counterValueEl.textContent = balance; },
        () => { log(`Káº¿t quáº£ cuá»‘i cÃ¹ng: <strong class="text-red-500">${balance}</strong>.`); runNextStepBtn.disabled = true; }
    ];

    const syncedSteps = [
        () => { log('Báº¯t Ä‘áº§u mÃ´ phá»ng <strong class="text-green-500">CÃ“</strong> Ä‘á»“ng bá»™...'); },
        () => { log('Luá»“ng A yÃªu cáº§u khÃ³a...'); },
        () => { balance -= 100; log(`Luá»“ng A khÃ³a thÃ nh cÃ´ng vÃ  rÃºt tiá»n. Sá»‘ dÆ° má»›i: <strong class="text-green-600">${balance}</strong>`); counterValueEl.textContent = balance; },
        () => { log('Luá»“ng A giáº£i phÃ³ng khÃ³a.'); },
        () => { log('Luá»“ng B yÃªu cáº§u khÃ³a...'); },
        () => { balance += 200; log(`Luá»“ng B khÃ³a thÃ nh cÃ´ng vÃ  náº¡p tiá»n. Sá»‘ dÆ° má»›i: <strong class="text-green-600">${balance}</strong>`); counterValueEl.textContent = balance; },
        () => { log('Luá»“ng B giáº£i phÃ³ng khÃ³a.'); },
        () => { log(`Káº¿t quáº£ Ä‘Ãºng: <strong class="text-green-500">${balance}</strong>.`); runNextStepBtn.disabled = true; }
    ];

    const log = (message) => { simLogEl.innerHTML += `<div>${message}</div>`; simLogEl.scrollTop = simLogEl.scrollHeight; };

    const setupSimulation = (stepsArray) => {
        resetCounter(true);
        activeSteps = stepsArray;
        currentStep = 0;
        
        // áº¨n cÃ¡c nÃºt "Báº¯t Ä‘áº§u", hiá»‡n cÃ¡c nÃºt "BÆ°á»›c tiáº¿p theo" vÃ  "Reset"
        startUnsyncedBtn.classList.add('hidden');
        startSyncedBtn.classList.add('hidden');
        runNextStepBtn.classList.remove('hidden');
        resetCounterBtn.classList.remove('hidden');
        runNextStepBtn.disabled = false;

        runNextStepBtn.click();
    };

    const resetCounter = (isPartial = false) => {
        balance = 1000;
        currentStep = 0;
        activeSteps = null;
        counterValueEl.textContent = balance;
        simLogEl.innerHTML = 'Nháº¥n nÃºt "Báº¯t Ä‘áº§u..." Ä‘á»ƒ mÃ´ phá»ng giao dá»‹ch.<br>Mong Ä‘á»£i: 1000 - 100 + 200 = 1100.';
        
        // Hiá»‡n láº¡i cÃ¡c nÃºt "Báº¯t Ä‘áº§u", áº©n cÃ¡c nÃºt "BÆ°á»›c tiáº¿p theo" vÃ  "Reset"
        startUnsyncedBtn.classList.remove('hidden');
        startSyncedBtn.classList.remove('hidden');
        runNextStepBtn.classList.add('hidden');
        resetCounterBtn.classList.add('hidden');
        
        if (isPartial) {
             simLogEl.innerHTML = '';
        }
    };
    
    // ThÃªm láº¡i sá»± kiá»‡n cho nÃºt Reset
    resetCounterBtn.addEventListener('click', () => resetCounter(false));
    startUnsyncedBtn.addEventListener('click', () => setupSimulation(unsyncedSteps));
    startSyncedBtn.addEventListener('click', () => setupSimulation(syncedSteps));

    runNextStepBtn.addEventListener('click', () => {
        if (activeSteps && currentStep < activeSteps.length) {
            activeSteps[currentStep]();
            currentStep++;
        }
    });

    // Gá»i resetCounter má»™t láº§n khi táº£i trang Ä‘á»ƒ Ä‘áº£m báº£o tráº¡ng thÃ¡i ban Ä‘áº§u Ä‘Ãºng
    resetCounter();

    // --- MÃ´ phá»ng Deadlock (5 Philosophers) ---
    const runDeadlockBtn = document.getElementById('run-deadlock-step'); // Äá»•i tÃªn tá»« StepBtn cho gá»n
    const resetDeadlockBtn = document.getElementById('reset-deadlock'); // NÃºt Reset má»›i
    const deadlockStatusEl = document.getElementById('deadlock-status');
    const deadlockCircle = document.getElementById('deadlock-circle');
    const NUM_PHILOSOPHERS = 5;
    const philosophers = [], forks = [];
    let currentDeadlockStep = 0;

    // Táº¡o vÃ  Ä‘á»‹nh vá»‹ cÃ¡c triáº¿t gia vÃ  nÄ©a
    for (let i = 0; i < NUM_PHILOSOPHERS; i++) {
        const angleP = (i / NUM_PHILOSOPHERS) * 2 * Math.PI - Math.PI / 2;
        const p = document.createElement('div');
        p.className = 'philosopher'; p.id = `p${i}`; p.textContent = `P${i}`;
        p.style.left = `${150 + 120 * Math.cos(angleP) - 30}px`;
        p.style.top = `${150 + 120 * Math.sin(angleP) - 30}px`;
        philosophers.push(p); deadlockCircle.appendChild(p);
        
        const angleF = angleP + (Math.PI / NUM_PHILOSOPHERS);
        const f = document.createElement('div');
        f.className = 'fork'; f.id = `f${i}`; f.innerHTML = 'ğŸ´';
        f.style.left = `${150 + 75 * Math.cos(angleF) - 20}px`;
        f.style.top = `${150 + 75 * Math.sin(angleF) - 20}px`;
        forks.push(f); deadlockCircle.appendChild(f);
    }
    
    // HÃ m reset tráº¡ng thÃ¡i mÃ´ phá»ng
    const resetDeadlock = () => {
        currentDeadlockStep = 0;
        deadlockStatusEl.textContent = "Nháº¥n 'Cháº¡y' Ä‘á»ƒ báº¯t Ä‘áº§u.";
        deadlockStatusEl.className = "text-lg font-medium h-8 text-center text-gray-700";
        philosophers.forEach(p => p.className = 'philosopher');
        forks.forEach(f => f.className = 'fork');
        runDeadlockBtn.disabled = false;
    };

    // Máº£ng chá»©a cÃ¡c bÆ°á»›c cá»§a mÃ´ phá»ng
    const deadlockSteps = [
        () => {
            deadlockStatusEl.textContent = `P0 cáº§m nÄ©a trÃ¡i (F0)...`;
            forks[0].classList.add('bg-blue-200', 'border-blue-500');
            philosophers[0].classList.add('scale-110');
        },
        () => {
            deadlockStatusEl.textContent = `P1 cáº§m nÄ©a trÃ¡i (F1)...`;
            forks[1].classList.add('bg-blue-200', 'border-blue-500');
            philosophers[1].classList.add('scale-110');
        },
        () => {
            deadlockStatusEl.textContent = `P2 cáº§m nÄ©a trÃ¡i (F2)...`;
            forks[2].classList.add('bg-blue-200', 'border-blue-500');
            philosophers[2].classList.add('scale-110');
        },
        () => {
            deadlockStatusEl.textContent = `P3 cáº§m nÄ©a trÃ¡i (F3)...`;
            forks[3].classList.add('bg-blue-200', 'border-blue-500');
            philosophers[3].classList.add('scale-110');
        },
        () => {
            deadlockStatusEl.textContent = `P4 cáº§m nÄ©a trÃ¡i (F4)...`;
            forks[4].classList.add('bg-blue-200', 'border-blue-500');
            philosophers[4].classList.add('scale-110');
        },
        () => { deadlockStatusEl.textContent = "Táº¥t cáº£ Ä‘ang chá» nÄ©a pháº£i..."; },
        () => {
            deadlockStatusEl.textContent = "DEADLOCK!";
            deadlockStatusEl.className = "text-lg font-bold h-8 text-center text-red-600 animate-pulse";
            philosophers.forEach(p => p.classList.add('bg-red-200', 'border-red-500'));
            runDeadlockBtn.disabled = true; // Káº¿t thÃºc, vÃ´ hiá»‡u hÃ³a nÃºt Cháº¡y
        }
    ];

    // Sá»± kiá»‡n cho nÃºt Cháº¡y
    runDeadlockBtn.addEventListener('click', () => {
        if (currentDeadlockStep === 0) { // Láº§n click Ä‘áº§u tiÃªn sáº½ reset nháº¹
            resetDeadlock();
            deadlockStatusEl.textContent = "Báº¯t Ä‘áº§u tá»«ng bÆ°á»›c...";
        }
        if (currentDeadlockStep < deadlockSteps.length) {
            deadlockSteps[currentDeadlockStep]();
            currentDeadlockStep++;
        }
    });

    // Sá»± kiá»‡n cho nÃºt Reset má»›i
    resetDeadlockBtn.addEventListener('click', resetDeadlock);

    // Äáº·t tráº¡ng thÃ¡i ban Ä‘áº§u khi táº£i trang
    resetDeadlock();

    // --- NÃºt Trá»Ÿ vá» Ä‘áº§u trang ---
    const backToTopBtn = document.getElementById('backToTopBtn');
    window.onscroll = function() {
        if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
            backToTopBtn.classList.remove('hidden');
        } else {
            backToTopBtn.classList.add('hidden');
        }
    };
    backToTopBtn.addEventListener('click', function() {
        window.scrollTo({top: 0, behavior: 'smooth'});
    });
	
	// --- SCRIPT Tá»”NG QUÃT CHO CHá»¨C NÄ‚NG GIáº¢I THÃCH VÃ€ SAO CHÃ‰P ---

    const exampleContents = {
        'race-condition-error': {
            explained: `<span style="color: #5c6370;">// ThÆ° viá»‡n cáº§n thiáº¿t</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;iostream&gt;</span> <span style="color: #5c6370;">// Cho viá»‡c nháº­p/xuáº¥t (std::cout)</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;thread&gt;</span>   <span style="color: #5c6370;">// Cho viá»‡c táº¡o vÃ  quáº£n lÃ½ luá»“ng (std::thread)</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;vector&gt;</span>   <span style="color: #5c6370;">// Äá»ƒ lÆ°u trá»¯ danh sÃ¡ch cÃ¡c luá»“ng (std::vector)</span>

<span style="color: #5c6370;">// Biáº¿n toÃ n cá»¥c, Ä‘Æ°á»£c chia sáº» bá»Ÿi táº¥t cáº£ cÃ¡c luá»“ng</span>
<span style="color: #d19a66;">long long</span> counter = <span style="color: #d19a66;">0</span>;

<span style="color: #5c6370;">// HÃ m sáº½ Ä‘Æ°á»£c thá»±c thi bá»Ÿi má»—i luá»“ng</span>
<span style="color: #c678dd;">void</span> <span style="color: #61afef;">increment</span>() {
    <span style="color: #5c6370;">// VÃ²ng láº·p 100,000 láº§n</span>
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">100000</span>; ++i) {
        <span style="color: #5c6370;">// Thao tÃ¡c tÄƒng biáº¿n Ä‘áº¿m. ÄÃ¢y lÃ  Ä‘iá»ƒm máº¥u chá»‘t gÃ¢y ra lá»—i!</span>
        counter++; <span style="color: #e06c75;">// Thao tÃ¡c nÃ y khÃ´ng nguyÃªn tá»­ (non-atomic)</span>
    }
}

<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    <span style="color: #5c6370;">// Táº¡o má»™t vector Ä‘á»ƒ chá»©a cÃ¡c Ä‘á»‘i tÆ°á»£ng luá»“ng</span>
    std::vector&lt;std::thread&gt; threads;

    <span style="color: #5c6370;">// Táº¡o vÃ  khá»Ÿi cháº¡y 10 luá»“ng</span>
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">10</span>; ++i) {
        <span style="color: #5c6370;">// Má»—i luá»“ng Ä‘Æ°á»£c táº¡o ra sáº½ cháº¡y hÃ m increment()</span>
        threads.push_back(std::thread(increment));
    }

    <span style="color: #5c6370;">// Äá»£i táº¥t cáº£ cÃ¡c luá»“ng hoÃ n thÃ nh cÃ´ng viá»‡c</span>
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">auto</span>&amp; th : threads) {
        <span style="color: #5c6370;">// main() sáº½ bá»‹ block á»Ÿ Ä‘Ã¢y cho Ä‘áº¿n khi luá»“ng 'th' káº¿t thÃºc</span>
        th.join();
    }

    <span style="color: #5c6370;">// In ra giÃ¡ trá»‹ cuá»‘i cÃ¹ng cá»§a counter</span>
    <span style="color: #5c6370;">// Káº¿t quáº£ thÆ°á»ng sáº½ nhá» hÆ¡n 1,000,000 (10 luá»“ng * 100,000)</span>
    std::cout &lt;&lt; <span style="color: #98c379;">"Final counter: "</span> &lt;&lt; counter &lt;&lt; std::endl;
    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}`
        },
        'mutex-fix': {
            explained: `<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;iostream&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;thread&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;vector&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;mutex&gt;</span> <span style="color: #5c6370;">// ThÃªm thÆ° viá»‡n mutex</span>

<span style="color: #5c6370;">// Biáº¿n toÃ n cá»¥c, Ä‘Æ°á»£c chia sáº»</span>
<span style="color: #d19a66;">long long</span> counter = <span style="color: #d19a66;">0</span>;
<span style="color: #5c6370;">// Khai bÃ¡o má»™t Ä‘á»‘i tÆ°á»£ng mutex toÃ n cá»¥c</span>
std::mutex mtx;

<span style="color: #5c6370;">// HÃ m Ä‘Æ°á»£c báº£o vá»‡, sáº½ Ä‘Æ°á»£c thá»±c thi bá»Ÿi má»—i luá»“ng</span>
<span style="color: #c678dd;">void</span> <span style="color: #61afef;">increment_safe</span>() {
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">100000</span>; ++i) {
        <span style="color: #5c6370;">// Táº¡o má»™t Ä‘á»‘i tÆ°á»£ng lock_guard. Ngay khi Ä‘Æ°á»£c táº¡o, nÃ³ sáº½</span>
        <span style="color: #5c6370;">// tá»± Ä‘á»™ng khÃ³a (lock) mutex 'mtx'.</span>
        <span style="color: #98c379;">std::lock_guard&lt;std::mutex&gt; lock(mtx);</span>

        <span style="color: #5c6370;">// Báº¥t ká»³ Ä‘oáº¡n code nÃ o trong scope nÃ y Ä‘á»u lÃ  "vÃ¹ng gÄƒng" (critical section).</span>
        <span style="color: #5c6370;">// Táº¡i má»™t thá»i Ä‘iá»ƒm, chá»‰ cÃ³ DUY NHáº¤T má»™t luá»“ng Ä‘Æ°á»£c phÃ©p thá»±c thi code á»Ÿ Ä‘Ã¢y.</span>
        counter++;
    } <span style="color: #5c6370;">// Khi 'lock' ra khá»i scope (káº¿t thÃºc vÃ²ng láº·p), nÃ³ sáº½ tá»± Ä‘á»™ng</span>
      <span style="color: #5c6370;">// Ä‘Æ°á»£c há»§y vÃ  mutex 'mtx' sáº½ Ä‘Æ°á»£c má»Ÿ khÃ³a (unlock).</span>
}

<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    std::vector&lt;std::thread&gt; threads;
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">10</span>; ++i) {
        <span style="color: #5c6370;">// Táº¡o 10 luá»“ng, má»—i luá»“ng cháº¡y hÃ m increment_safe Ä‘Ã£ Ä‘Æ°á»£c báº£o vá»‡</span>
        threads.push_back(std::thread(increment_safe));
    }

    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">auto</span>&amp; th : threads) {
        th.join();
    }

    <span style="color: #5c6370;">// Káº¿t quáº£ luÃ´n luÃ´n lÃ  1,000,000</span>
    std::cout &lt;&lt; <span style="color: #98c379;">"Final counter: "</span> &lt;&lt; counter &lt;&lt; std::endl;
    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}`
        },
        'semaphore-worker': {
            explained: `<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;iostream&gt;</span>      <span style="color: #5c6370;">// Cho viá»‡c nháº­p/xuáº¥t (std::cout)</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;thread&gt;</span>        <span style="color: #5c6370;">// Cho viá»‡c táº¡o vÃ  quáº£n lÃ½ luá»“ng (std::thread)</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;vector&gt;</span>        <span style="color: #5c6370;">// Äá»ƒ lÆ°u trá»¯ danh sÃ¡ch cÃ¡c luá»“ng (std::vector)</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;semaphore&gt;</span>     <span style="color: #5c6370;">// Cho semaphore (std::counting_semaphore)</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;chrono&gt;</span>        <span style="color: #5c6370;">// Cho cÃ¡c chá»©c nÄƒng vá» thá»i gian (std::this_thread::sleep_for)</span>

<span style="color: #5c6370;">// Khá»Ÿi táº¡o má»™t counting_semaphore.</span>
<span style="color: #5c6370;">// Con sá»‘ &lt;3&gt; trong template nghÄ©a lÃ  giÃ¡ trá»‹ tá»‘i Ä‘a cá»§a bá»™ Ä‘áº¿m lÃ  3.</span>
<span style="color: #5c6370;">// Con sá»‘ (3) trong hÃ m khá»Ÿi táº¡o nghÄ©a lÃ  giÃ¡ trá»‹ ban Ä‘áº§u cá»§a bá»™ Ä‘áº¿m lÃ  3.</span>
<span style="color: #5c6370;">// TÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i viá»‡c cÃ³ 3 "slot" (chá»— trá»‘ng) hoáº·c "giáº¥y phÃ©p" ban Ä‘áº§u.</span>
std::counting_semaphore&lt;<span style="color: #d19a66;">3</span>&gt; worker_slots(<span style="color: #d19a66;">3</span>);

<span style="color: #5c6370;">// HÃ m nÃ y sáº½ Ä‘Æ°á»£c thá»±c thi bá»Ÿi má»—i luá»“ng (má»—i "worker")</span>
<span style="color: #c678dd;">void</span> <span style="color: #61afef;">worker</span>(<span style="color: #d19a66;">int</span> id) {
    <span style="color: #5c6370;">// In ra thÃ´ng bÃ¡o ráº±ng worker nÃ y Ä‘ang báº¯t Ä‘áº§u vÃ  Ä‘ang chá»</span>
    std::cout &lt;&lt; <span style="color: #98c379;">"Worker "</span> &lt;&lt; id &lt;&lt; <span style="color: #98c379;">" is waiting for a slot...\\n"</span>;
    
    <span style="color: #5c6370;">// YÃªu cáº§u má»™t slot tá»« semaphore.</span>
    <span style="color: #5c6370;">// - Náº¿u bá»™ Ä‘áº¿m &gt; 0, luá»“ng sáº½ láº¥y 1 slot (bá»™ Ä‘áº¿m giáº£m Ä‘i 1) vÃ  Ä‘i tiáº¿p ngay láº­p tá»©c.</span>
    <span style="color: #5c6370;">// - Náº¿u bá»™ Ä‘áº¿m == 0 (háº¿t slot), luá»“ng sáº½ bá»‹ block (dá»«ng) á»Ÿ Ä‘Ã¢y vÃ  chá» cho Ä‘áº¿n khi cÃ³ luá»“ng khÃ¡c giáº£i phÃ³ng slot.</span>
    worker_slots.acquire(); 
    
    <span style="color: #5c6370;">// Khi luá»“ng vÆ°á»£t qua Ä‘Æ°á»£c dÃ²ng acquire(), nÃ³ Ä‘Ã£ chiáº¿m Ä‘Æ°á»£c má»™t slot.</span>
    std::cout &lt;&lt; <span style="color: #98c379;">"Worker "</span> &lt;&lt; id &lt;&lt; <span style="color: #98c379;">" has acquired a slot and is working.\\n"</span>;
    
    <span style="color: #5c6370;">// Giáº£ láº­p má»™t cÃ´ng viá»‡c tá»‘n thá»i gian (vÃ­ dá»¥: xá»­ lÃ½ dá»¯ liá»‡u, truy cáº­p file...)</span>
    <span style="color: #5c6370;">// Luá»“ng sáº½ "ngá»§" trong 2 giÃ¢y.</span>
    std::this_thread::sleep_for(std::chrono::seconds(<span style="color: #d19a66;">2</span>)); 
    
    std::cout &lt;&lt; <span style="color: #98c379;">"Worker "</span> &lt;&lt; id &lt;&lt; <span style="color: #98c379;">" has finished and is releasing the slot.\\n"</span>;
    
    <span style="color: #5c6370;">// Sau khi lÃ m xong viá»‡c, luá»“ng pháº£i giáº£i phÃ³ng slot Ä‘Ã£ chiáº¿m.</span>
    <span style="color: #5c6370;">// Thao tÃ¡c nÃ y lÃ m tÄƒng bá»™ Ä‘áº¿m cá»§a semaphore lÃªn 1.</span>
    <span style="color: #5c6370;">// Viá»‡c nÃ y cho phÃ©p má»™t luá»“ng khÃ¡c Ä‘ang chá» á»Ÿ acquire() cÃ³ thá»ƒ Ä‘i tiáº¿p.</span>
    worker_slots.release();
}

<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    <span style="color: #5c6370;">// Táº¡o má»™t vector Ä‘á»ƒ chá»©a cÃ¡c Ä‘á»‘i tÆ°á»£ng luá»“ng</span>
    std::vector&lt;std::thread&gt; workers;

    <span style="color: #5c6370;">// Táº¡o vÃ  khá»Ÿi cháº¡y 10 luá»“ng worker</span>
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">10</span>; ++i) {
        <span style="color: #5c6370;">// Má»—i luá»“ng Ä‘Æ°á»£c táº¡o ra sáº½ cháº¡y hÃ m worker() vá»›i id tÆ°Æ¡ng á»©ng (0 Ä‘áº¿n 9)</span>
        workers.emplace_back(worker, i);
    }

    <span style="color: #5c6370;">// Äá»£i táº¥t cáº£ cÃ¡c luá»“ng worker hoÃ n thÃ nh cÃ´ng viá»‡c cá»§a chÃºng</span>
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">auto</span>&amp; w : workers) {
        w.join();
    }

    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}`
        },
        'producer-consumer': {
            explained: `<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;iostream&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;thread&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;queue&gt;</span>                <span style="color: #5c6370;">// HÃ ng Ä‘á»£i (First-In, First-Out) Ä‘á»ƒ lÃ m bá»™ Ä‘á»‡m</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;mutex&gt;</span>                <span style="color: #5c6370;">// Äá»ƒ báº£o vá»‡ buffer</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;condition_variable&gt;</span>   <span style="color: #5c6370;">// Äá»ƒ chá» vÃ  thÃ´ng bÃ¡o Ä‘iá»u kiá»‡n</span>

<span style="color: #5c6370;">// ----- CÃ¡c tÃ i nguyÃªn Ä‘Æ°á»£c chia sáº» -----</span>
std::queue&lt;<span style="color: #d19a66;">int</span>&gt; buffer;         <span style="color: #5c6370;">// Bá»™ Ä‘á»‡m chung, chá»©a cÃ¡c sá»‘ nguyÃªn</span>
std::mutex mtx;                 <span style="color: #5c6370;">// Mutex Ä‘á»ƒ báº£o vá»‡ viá»‡c truy cáº­p vÃ o buffer</span>
std::condition_variable cv;     <span style="color: #5c6370;">// Biáº¿n Ä‘iá»u kiá»‡n Ä‘á»ƒ Ä‘á»“ng bá»™ hÃ³a producer vÃ  consumer</span>
<span style="color: #c678dd;">const unsigned int</span> MAX_BUFFER_SIZE = <span style="color: #d19a66;">5</span>; <span style="color: #5c6370;">// KÃ­ch thÆ°á»›c tá»‘i Ä‘a cá»§a bá»™ Ä‘á»‡m</span>

<span style="color: #5c6370;">// ----- Luá»“ng Producer (NhÃ  sáº£n xuáº¥t) -----</span>
<span style="color: #c678dd;">void</span> <span style="color: #61afef;">producer</span>(<span style="color: #d19a66;">int</span> id) {
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">10</span>; ++i) {
        <span style="color: #5c6370;">// KhÃ³a mutex. std::unique_lock linh hoáº¡t hÆ¡n lock_guard,</span>
        <span style="color: #5c6370;">// cho phÃ©p chÃºng ta tá»± má»Ÿ khÃ³a (unlock) trÆ°á»›c khi ra khá»i scope.</span>
        std::unique_lock&lt;std::mutex&gt; lock(mtx);
        
        <span style="color: #5c6370;">// Chá» Ä‘á»£i cho Ä‘áº¿n khi buffer khÃ´ng cÃ²n Ä‘áº§y.</span>
        <span style="color: #5c6370;">// cv.wait sáº½:</span>
        <span style="color: #5c6370;">// 1. Kiá»ƒm tra Ä‘iá»u kiá»‡n (lambda function \`[]{ return buffer.size() &lt; MAX_BUFFER_SIZE; }\`).</span>
        <span style="color: #5c6370;">// 2. Náº¿u Ä‘iá»u kiá»‡n sai (buffer Ä‘ang Ä‘áº§y), nÃ³ sáº½ tá»± Ä‘á»™ng Má» KHÃ“A mutex vÃ  Ä‘Æ°a luá»“ng nÃ y vÃ o tráº¡ng thÃ¡i ngá»§.</span>
        <span style="color: #5c6370;">// 3. Khi luá»“ng khÃ¡c gá»i notify(), luá»“ng nÃ y sáº½ thá»©c dáº­y, KHÃ“A Láº I mutex vÃ  kiá»ƒm tra láº¡i Ä‘iá»u kiá»‡n.</span>
        cv.wait(lock, []{ <span style="color: #c678dd;">return</span> buffer.size() &lt; MAX_BUFFER_SIZE; });
        
        <span style="color: #5c6370;">// Khi Ä‘iá»u kiá»‡n Ä‘Ã£ thá»a mÃ£n (buffer cÃ³ chá»— trá»‘ng), thÃªm má»™t item vÃ o</span>
        buffer.push(i);
        std::cout &lt;&lt; <span style="color: #98c379;">"Producer "</span> &lt;&lt; id &lt;&lt; <span style="color: #98c379;">" produced item "</span> &lt;&lt; i &lt;&lt; <span style="color: #98c379;">".\\n"</span>;
        
        <span style="color: #5c6370;">// Má»Ÿ khÃ³a mutex sá»›m Ä‘á»ƒ consumer cÃ³ thá»ƒ vÃ o lÃ m viá»‡c ngay</span>
        <span style="color: #5c6370;">// mÃ  khÃ´ng cáº§n Ä‘á»£i producer káº¿t thÃºc cÃ¡c thao tÃ¡c khÃ¡c.</span>
        lock.unlock();
        
        <span style="color: #5c6370;">// ThÃ´ng bÃ¡o cho Má»˜T luá»“ng Ä‘ang chá» (cÃ³ thá»ƒ lÃ  consumer) ráº±ng cÃ³ Ä‘iá»u gÃ¬ Ä‘Ã³ Ä‘Ã£ thay Ä‘á»•i.</span>
        <span style="color: #5c6370;">// Consumer Ä‘ang chá» buffer khÃ´ng rá»—ng sáº½ Ä‘Æ°á»£c Ä‘Ã¡nh thá»©c.</span>
        cv.notify_one();
    }
}

<span style="color: #5c6370;">// ----- Luá»“ng Consumer (NgÆ°á»i tiÃªu dÃ¹ng) -----</span>
<span style="color: #c678dd;">void</span> <span style="color: #61afef;">consumer</span>(<span style="color: #d19a66;">int</span> id) {
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">10</span>; ++i) {
        <span style="color: #5c6370;">// KhÃ³a mutex Ä‘á»ƒ chuáº©n bá»‹ truy cáº­p buffer</span>
        std::unique_lock&lt;std::mutex&gt; lock(mtx);
        
        <span style="color: #5c6370;">// Chá» Ä‘á»£i cho Ä‘áº¿n khi buffer khÃ´ng cÃ²n rá»—ng.</span>
        <span style="color: #5c6370;">// TÆ°Æ¡ng tá»± nhÆ° producer, náº¿u buffer Ä‘ang rá»—ng, luá»“ng nÃ y sáº½ ngá»§</span>
        <span style="color: #5c6370;">// vÃ  táº¡m thá»i nháº£ khÃ³a mutex ra.</span>
        cv.wait(lock, []{ <span style="color: #c678dd;">return</span> !buffer.empty(); });
        
        <span style="color: #5c6370;">// Khi Ä‘iá»u kiá»‡n Ä‘Ã£ thá»a mÃ£n (buffer cÃ³ item), láº¥y item ra</span>
        <span style="color: #d19a66;">int</span> item = buffer.front();
        buffer.pop();
        std::cout &lt;&lt; <span style="color: #98c379;">"Consumer "</span> &lt;&lt; id &lt;&lt; <span style="color: #98c379;">" consumed item "</span> &lt;&lt; item &lt;&lt; <span style="color: #98c379;">".\\n"</span>;
        
        <span style="color: #5c6370;">// Má»Ÿ khÃ³a mutex</span>
        lock.unlock();
        
        <span style="color: #5c6370;">// ThÃ´ng bÃ¡o cho Má»˜T luá»“ng Ä‘ang chá» (cÃ³ thá»ƒ lÃ  producer) ráº±ng cÃ³ Ä‘iá»u gÃ¬ Ä‘Ã³ Ä‘Ã£ thay Ä‘á»•i.</span>
        <span style="color: #5c6370;">// Producer Ä‘ang chá» buffer cÃ³ chá»— trá»‘ng sáº½ Ä‘Æ°á»£c Ä‘Ã¡nh thá»©c.</span>
        cv.notify_one();
    }
}

<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    <span style="color: #5c6370;">// Táº¡o 1 luá»“ng producer vÃ  1 luá»“ng consumer</span>
    std::thread p1(producer, 1);
    std::thread c1(consumer, 1);
    
    <span style="color: #5c6370;">// Äá»£i cáº£ hai luá»“ng hoÃ n thÃ nh cÃ´ng viá»‡c</span>
    p1.join();
    c1.join();
    
    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}`
        },
        'atomic-counter': {
            explained: `<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;iostream&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;thread&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;vector&gt;</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;atomic&gt;</span> <span style="color: #5c6370;">// ThÃªm thÆ° viá»‡n atomic</span>

<span style="color: #5c6370;">// Khai bÃ¡o má»™t biáº¿n counter kiá»ƒu long long, nhÆ°ng bá»c trong template std::atomic.</span>
<span style="color: #5c6370;">// Má»i thao tÃ¡c trÃªn biáº¿n nÃ y giá» Ä‘Ã¢y sáº½ tuÃ¢n theo cÃ¡c quy táº¯c nguyÃªn tá»­.</span>
<span style="color: #5c6370;">// Khá»Ÿi táº¡o giÃ¡ trá»‹ ban Ä‘áº§u lÃ  0.</span>
std::atomic&lt;<span style="color: #d19a66;">long long</span>&gt; atomic_counter(<span style="color: #d19a66;">0</span>);

<span style="color: #5c6370;">// HÃ m sáº½ Ä‘Æ°á»£c thá»±c thi bá»Ÿi má»—i luá»“ng</span>
<span style="color: #c678dd;">void</span> <span style="color: #61afef;">increment_atomic</span>() {
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">100000</span>; ++i) {
        <span style="color: #5c6370;">// ÄÃ¢y lÃ  Ä‘iá»ƒm máº¥u chá»‘t.</span>
        <span style="color: #5c6370;">// fetch_add lÃ  má»™t thao tÃ¡c Read-Modify-Write (Äá»c-Sá»­a-Ghi) nguyÃªn tá»­.</span>
        <span style="color: #5c6370;">// NÃ³ Ä‘áº£m báº£o ráº±ng viá»‡c Ä‘á»c giÃ¡ trá»‹ hiá»‡n táº¡i cá»§a counter,</span>
        <span style="color: #5c6370;">// cá»™ng thÃªm 1, vÃ  ghi láº¡i giÃ¡ trá»‹ má»›i lÃ  má»™t hÃ nh Ä‘á»™ng duy nháº¥t, khÃ´ng thá»ƒ bá»‹ chia cáº¯t.</span>
        <span style="color: #5c6370;">// NÃ³ tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i thao tÃ¡c \`atomic_counter++\` nhÆ°ng rÃµ rÃ ng hÆ¡n vá» máº·t Ã½ nghÄ©a.</span>
        <span style="color: #5c6370;">// \`std::memory_order_relaxed\` lÃ  má»™t tÃ¹y chá»n tá»‘i Æ°u hÃ³a, cho trÃ¬nh biÃªn dá»‹ch biáº¿t</span>
        <span style="color: #5c6370;">// ráº±ng khÃ´ng cáº§n Ä‘á»“ng bá»™ hÃ³a bá»™ nhá»› phá»©c táº¡p vá»›i cÃ¡c biáº¿n atomic khÃ¡c.</span>
        <span style="color: #5c6370;">// Äá»‘i vá»›i má»™t biáº¿n Ä‘áº¿m Ä‘Æ¡n giáº£n, Ä‘Ã¢y lÃ  lá»±a chá»n hiá»‡u quáº£ nháº¥t.</span>
        atomic_counter.fetch_add(<span style="color: #d19a66;">1</span>, std::memory_order_relaxed);
    }
}

<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    std::vector&lt;std::thread&gt; threads;
    <span style="color: #5c6370;">// Táº¡o vÃ  khá»Ÿi cháº¡y 10 luá»“ng</span>
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; <span style="color: #d19a66;">10</span>; ++i) {
        threads.push_back(std::thread(increment_atomic));
    }

    <span style="color: #5c6370;">// Äá»£i táº¥t cáº£ cÃ¡c luá»“ng hoÃ n thÃ nh</span>
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">auto</span>&amp; th : threads) {
        th.join();
    }

    <span style="color: #5c6370;">// Äá»ƒ Ä‘á»c giÃ¡ trá»‹ tá»« má»™t biáº¿n atomic má»™t cÃ¡ch an toÃ n, ta dÃ¹ng phÆ°Æ¡ng thá»©c load().</span>
    <span style="color: #5c6370;">// Äiá»u nÃ y Ä‘áº£m báº£o ráº±ng chÃºng ta Ä‘á»c Ä‘Æ°á»£c giÃ¡ trá»‹ hoÃ n chá»‰nh cuá»‘i cÃ¹ng,</span>
    <span style="color: #5c6370;">// khÃ´ng pháº£i má»™t giÃ¡ trá»‹ Ä‘ang Ä‘Æ°á»£c cáº­p nháº­t dá»Ÿ dang.</span>
    std::cout &lt;&lt; <span style="color: #98c379;">"Final counter: "</span> &lt;&lt; atomic_counter.load() &lt;&lt; std::endl; <span style="color: #5c6370;">// Káº¿t quáº£ luÃ´n lÃ  1,000,000</span>
    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}`
        }, // <--- Äáº£m báº£o báº¡n cÃ³ dáº¥u pháº©y á»Ÿ Ä‘Ã¢y Ä‘á»ƒ ngÄƒn cÃ¡ch cÃ¡c má»¥c

        // --- Báº®T Äáº¦U PHáº¦N MÃƒ Má»šI Cáº¦N THÃŠM ---
        'matrix-utils': {
            explained: `<span style="color: #5c6370;">// Header Guards: Äáº£m báº£o tá»‡p chá»‰ Ä‘Æ°á»£c biÃªn dá»‹ch má»™t láº§n.</span>
<span style="color: #c678dd;">#ifndef</span> <span style="color: #e5c07b;">MATRIX_UTILS_H</span>
<span style="color: #c678dd;">#define</span> <span style="color: #e5c07b;">MATRIX_UTILS_H</span>

<span style="color: #5c6370;">// Khai bÃ¡o cÃ¡c thÆ° viá»‡n chuáº©n cáº§n thiáº¿t</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;vector&gt;</span>   <span style="color: #5c6370;">// Äá»ƒ lÆ°u trá»¯ dá»¯ liá»‡u ma tráº­n</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;string&gt;</span>   <span style="color: #5c6370;">// Äá»ƒ lÃ m viá»‡c vá»›i tÃªn tá»‡p</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;fstream&gt;</span>  <span style="color: #5c6370;">// Äá»ƒ Ä‘á»c/ghi tá»‡p</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;stdexcept&gt;</span> <span style="color: #5c6370;">// Äá»ƒ xá»­ lÃ½ lá»—i</span>

<span style="color: #5c6370;">// Äá»‹nh nghÄ©a cáº¥u trÃºc Matrix Ä‘á»ƒ Ä‘Ã³ng gÃ³i dá»¯ liá»‡u</span>
<span style="color: #c678dd;">struct</span> <span style="color: #e5c07b;">Matrix</span> {
    <span style="color: #d19a66;">int</span> rows = <span style="color: #d19a66;">0</span>;
    <span style="color: #d19a66;">int</span> cols = <span style="color: #d19a66;">0</span>;
    std::vector&lt;std::vector&lt;<span style="color: #d19a66;">int</span>&gt;&gt; data;
};

<span style="color: #5c6370;">// HÃ m Ä‘á»c ma tráº­n tá»« file</span>
<span style="color: #c678dd;">inline</span> Matrix <span style="color: #61afef;">read_matrix_from_file</span>(<span style="color: #c678dd;">const</span> std::string&amp; filename) {
    std::ifstream file(filename);
    <span style="color: #c678dd;">if</span> (!file.is_open()) {
        <span style="color: #c678dd;">throw</span> std::runtime_error(<span style="color: #98c379;">"Error: Could not open file "</span> + filename);
    }
    Matrix mat;
    file &gt;&gt; mat.rows &gt;&gt; mat.cols;
    mat.data.assign(mat.rows, std::vector&lt;<span style="color: #d19a66;">int</span>&gt;(mat.cols));
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; mat.rows; ++i) {
        <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> j = <span style="color: #d19a66;">0</span>; j &lt; mat.cols; ++j) {
            file &gt;&gt; mat.data[i][j];
        }
    }
    <span style="color: #c678dd;">return</span> mat;
}

<span style="color: #5c6370;">// HÃ m ghi ma tráº­n ra file</span>
<span style="color: #c678dd;">inline</span> <span style="color: #c678dd;">void</span> <span style="color: #61afef;">write_matrix_to_file</span>(<span style="color: #c678dd;">const</span> Matrix&amp; mat, <span style="color: #c678dd;">const</span> std::string&amp; filename) {
    std::ofstream file(filename);
    file &lt;&lt; mat.rows &lt;&lt; <span style="color: #98c379;">" "</span> &lt;&lt; mat.cols &lt;&lt; <span style="color: #98c379;">"\\n"</span>;
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; mat.rows; ++i) {
        <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> j = <span style="color: #d19a66;">0</span>; j &lt; mat.cols; ++j) {
            file &lt;&lt; mat.data[i][j] &lt;&lt; (j == mat.cols - <span style="color: #d19a66;">1</span> ? <span style="color: #98c379;">""</span> : <span style="color: #98c379;">" "</span>);
        }
        file &lt;&lt; <span style="color: #98c379;">"\\n"</span>;
    }
}
<span style="color: #c678dd;">#endif</span>`
        },
        'sequential-mult': {
            explained: `<span style="color: #5c6370;">// sequential_multiplication.cpp</span>
<span style="color: #5c6370;">// MÃ´ táº£: ChÆ°Æ¡ng trÃ¬nh nÃ y thá»±c hiá»‡n phÃ©p nhÃ¢n hai ma tráº­n má»™t cÃ¡ch tuáº§n tá»±,</span>
<span style="color: #5c6370;">// tá»©c lÃ  chá»‰ sá»­ dá»¥ng má»™t luá»“ng (luá»“ng chÃ­nh).</span>
<span style="color: #5c6370;">// Má»¥c Ä‘Ã­ch chÃ­nh lÃ  Ä‘á»ƒ lÃ m cÆ¡ sá»Ÿ so sÃ¡nh hiá»‡u nÄƒng vá»›i phiÃªn báº£n nhÃ¢n ma tráº­n Ä‘a luá»“ng.</span>

<span style="color: #5c6370;">// Bao gá»“m tá»‡p header tá»± Ä‘á»‹nh nghÄ©a Ä‘á»ƒ sá»­ dá»¥ng cÃ¡c hÃ m Ä‘á»c/ghi ma tráº­n vÃ  struct Matrix.</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">"matrix_utils.h"</span>
<span style="color: #5c6370;">// Bao gá»“m thÆ° viá»‡n chrono Ä‘á»ƒ Ä‘o lÆ°á»ng thá»i gian thá»±c thi má»™t cÃ¡ch chÃ­nh xÃ¡c.</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;chrono&gt;</span>

<span style="color: #5c6370;">// HÃ m thá»±c hiá»‡n nhÃ¢n hai ma tráº­n A vÃ  B má»™t cÃ¡ch tuáº§n tá»±.</span>
<span style="color: #5c6370;">// const Matrix& A, const Matrix& B: Nháº­n vÃ o hai ma tráº­n háº±ng dÆ°á»›i dáº¡ng tham chiáº¿u</span>
<span style="color: #5c6370;">// Ä‘á»ƒ trÃ¡nh sao chÃ©p dá»¯ liá»‡u khÃ´ng cáº§n thiáº¿t, giÃºp tá»‘i Æ°u hiá»‡u suáº¥t.</span>
Matrix <span style="color: #61afef;">multiply_sequentially</span>(<span style="color: #c678dd;">const</span> Matrix&amp; A, <span style="color: #c678dd;">const</span> Matrix&amp; B) {
    <span style="color: #5c6370;">// Táº¡o ma tráº­n káº¿t quáº£ C.</span>
    Matrix C;
    <span style="color: #5c6370;">// KÃ­ch thÆ°á»›c cá»§a ma tráº­n C sáº½ lÃ  sá»‘ hÃ ng cá»§a A vÃ  sá»‘ cá»™t cá»§a B.</span>
    C.rows = A.rows;
    C.cols = B.cols;
    <span style="color: #5c6370;">// Cáº¥p phÃ¡t bá»™ nhá»› cho ma tráº­n C vÃ  khá»Ÿi táº¡o táº¥t cáº£ cÃ¡c pháº§n tá»­ báº±ng 0.</span>
    C.data.assign(C.rows, std::vector&lt;<span style="color: #d19a66;">int</span>&gt;(C.cols, <span style="color: #d19a66;">0</span>));

    <span style="color: #5c6370;">// Thuáº­t toÃ¡n nhÃ¢n ma tráº­n tiÃªu chuáº©n sá»­ dá»¥ng ba vÃ²ng láº·p lá»“ng nhau.</span>
    <span style="color: #5c6370;">// VÃ²ng láº·p ngoÃ i cÃ¹ng duyá»‡t qua tá»«ng hÃ ng cá»§a ma tráº­n A (vÃ  ma tráº­n C).</span>
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = <span style="color: #d19a66;">0</span>; i &lt; A.rows; ++i) {
        <span style="color: #5c6370;">// VÃ²ng láº·p thá»© hai duyá»‡t qua tá»«ng cá»™t cá»§a ma tráº­n B (vÃ  ma tráº­n C).</span>
        <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> j = <span style="color: #d19a66;">0</span>; j &lt; B.cols; ++j) {
            <span style="color: #5c6370;">// Biáº¿n táº¡m Ä‘á»ƒ tÃ­nh tá»•ng cho pháº§n tá»­ C[i][j].</span>
            <span style="color: #d19a66;">int</span> sum = <span style="color: #d19a66;">0</span>;
            <span style="color: #5c6370;">// VÃ²ng láº·p trong cÃ¹ng duyá»‡t qua tá»«ng cá»™t cá»§a A vÃ  hÃ ng cá»§a B.</span>
            <span style="color: #5c6370;">// ÄÃ¢y lÃ  bÆ°á»›c tÃ­nh tÃ­ch vÃ´ hÆ°á»›ng (dot product) cá»§a hÃ ng i cá»§a A vÃ  cá»™t j cá»§a B.</span>
            <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> k = <span style="color: #d19a66;">0</span>; k &lt; A.cols; ++k) {
                sum += A.data[i][k] * B.data[k][j];
            }
            <span style="color: #5c6370;">// GÃ¡n giÃ¡ trá»‹ tá»•ng vá»«a tÃ­nh Ä‘Æ°á»£c cho pháº§n tá»­ C[i][j].</span>
            C.data[i][j] = sum;
        }
    }
    <span style="color: #5c6370;">// Tráº£ vá» ma tráº­n káº¿t quáº£ C.</span>
    <span style="color: #c678dd;">return</span> C;
}

<span style="color: #5c6370;">// HÃ m main - Ä‘iá»ƒm báº¯t Ä‘áº§u cá»§a chÆ°Æ¡ng trÃ¬nh.</span>
<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    <span style="color: #5c6370;">// Sá»­ dá»¥ng khá»‘i try-catch Ä‘á»ƒ xá»­ lÃ½ cÃ¡c lá»—i cÃ³ thá»ƒ xáº£y ra má»™t cÃ¡ch an toÃ n.</span>
    <span style="color: #5c6370;">// VÃ­ dá»¥: khÃ´ng tÃ¬m tháº¥y file, file cÃ³ Ä‘á»‹nh dáº¡ng sai, kÃ­ch thÆ°á»›c ma tráº­n khÃ´ng há»£p lá»‡.</span>
    <span style="color: #c678dd;">try</span> {
        <span style="color: #5c6370;">// Äá»c ma tráº­n A vÃ  B tá»« cÃ¡c tá»‡p vÄƒn báº£n.</span>
        Matrix A = read_matrix_from_file(<span style="color: #98c379;">"A.txt"</span>);
        Matrix B = read_matrix_from_file(<span style="color: #98c379;">"B.txt"</span>);

        <span style="color: #5c6370;">// Äiá»u kiá»‡n tiÃªn quyáº¿t Ä‘á»ƒ nhÃ¢n ma tráº­n: sá»‘ cá»™t cá»§a A pháº£i báº±ng sá»‘ hÃ ng cá»§a B.</span>
        <span style="color: #c678dd;">if</span> (A.cols != B.rows) {
            <span style="color: #5c6370;">// Náº¿u khÃ´ng thá»a mÃ£n, nÃ©m ra má»™t ngoáº¡i lá»‡ vá»›i thÃ´ng bÃ¡o lá»—i rÃµ rÃ ng.</span>
            <span style="color: #c678dd;">throw</span> std::invalid_argument(<span style="color: #98c379;">"Error: Incompatible matrix dimensions for multiplication."</span>);
        }

        <span style="color: #5c6370;">// Báº¯t Ä‘áº§u Ä‘o thá»i gian thá»±c thi.</span>
        <span style="color: #5c6370;">// high_resolution_clock cung cáº¥p Ä‘á»“ng há»“ cÃ³ Ä‘á»™ chÃ­nh xÃ¡c cao nháº¥t cÃ³ thá»ƒ trÃªn há»‡ thá»‘ng.</span>
        <span style="color: #d19a66;">auto</span> start_time = std::chrono::high_resolution_clock::now();
        <span style="color: #5c6370;">// Gá»i hÃ m nhÃ¢n ma tráº­n tuáº§n tá»±.</span>
        Matrix C = multiply_sequentially(A, B);
        <span style="color: #5c6370;">// Dá»«ng Ä‘o thá»i gian.</span>
        <span style="color: #d19a66;">auto</span> end_time = std::chrono::high_resolution_clock::now();

        <span style="color: #5c6370;">// TÃ­nh toÃ¡n khoáº£ng thá»i gian Ä‘Ã£ trÃ´i qua vÃ  chuyá»ƒn Ä‘á»•i sang Ä‘Æ¡n vá»‹ mili giÃ¢y.</span>
        <span style="color: #d19a66;">auto</span> duration = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(end_time - start_time);
        <span style="color: #5c6370;">// In thá»i gian thá»±c thi ra mÃ n hÃ¬nh.</span>
        std::cout &lt;&lt; <span style="color: #98c379;">"Time taken for sequential multiplication: "</span> &lt;&lt; duration.count() &lt;&lt; <span style="color: #98c379;">" milliseconds\n"</span>;

        <span style="color: #5c6370;">// Ghi ma tráº­n káº¿t quáº£ C ra má»™t tá»‡p má»›i.</span>
        write_matrix_to_file(C, <span style="color: #98c379;">"C_sequential.txt"</span>);
        std::cout &lt;&lt; <span style="color: #98c379;">"Result saved to C_sequential.txt\n"</span>;

    <span style="color: #5c6370;">// Báº¯t (catch) báº¥t ká»³ ngoáº¡i lá»‡ nÃ o thuá»™c lá»›p std::exception hoáº·c lá»›p con cá»§a nÃ³.</span>
    } <span style="color: #c678dd;">catch</span> (<span style="color: #c678dd;">const</span> std::exception&amp; e) {
        <span style="color: #5c6370;">// In thÃ´ng bÃ¡o lá»—i ra luá»“ng lá»—i chuáº©n (standard error).</span>
        std::cerr &lt;&lt; <span style="color: #98c379;">"An error occurred: "</span> &lt;&lt; e.what() &lt;&lt; std::endl;
        <span style="color: #5c6370;">// Tráº£ vá» 1 Ä‘á»ƒ bÃ¡o hiá»‡u chÆ°Æ¡ng trÃ¬nh káº¿t thÃºc vá»›i lá»—i.</span>
        <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">1</span>;
    }
    <span style="color: #5c6370;">// Tráº£ vá» 0 Ä‘á»ƒ bÃ¡o hiá»‡u chÆ°Æ¡ng trÃ¬nh káº¿t thÃºc thÃ nh cÃ´ng.</span>
    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}`
        },
        'standard-mult': {
            explained: `<span style="color: #5c6370;">// multithread_standard.cpp</span>
<span style="color: #5c6370;">// MÃ´ táº£: ChÆ°Æ¡ng trÃ¬nh nÃ y thá»±c hiá»‡n nhÃ¢n ma tráº­n song song sá»­ dá»¥ng Ä‘a luá»“ng.</span>
<span style="color: #5c6370;">// CÃ¡ch tiáº¿p cáº­n lÃ  chia cÃ¡c hÃ ng cá»§a ma tráº­n káº¿t quáº£ cho cÃ¡c luá»“ng khÃ¡c nhau Ä‘á»ƒ tÃ­nh toÃ¡n.</span>
<span style="color: #5c6370;">// ÄÃ¢y lÃ  phÆ°Æ¡ng phÃ¡p cÆ¡ báº£n, giÃºp tÄƒng tá»‘c Ä‘á»™ so vá»›i báº£n tuáº§n tá»± nhÆ°ng cÃ³ thá»ƒ tá»‘i Æ°u hÆ¡n ná»¯a.</span>

<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">"matrix_utils.h"</span> <span style="color: #5c6370;">// Sá»­ dá»¥ng cÃ¡c hÃ m vÃ  struct Ä‘Ã£ Ä‘á»‹nh nghÄ©a Ä‘á»ƒ Ä‘á»c/ghi ma tráº­n.</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;chrono&gt;</span>         <span style="color: #5c6370;">// ThÆ° viá»‡n Ä‘á»ƒ Ä‘o lÆ°á»ng thá»i gian thá»±c thi.</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;thread&gt;</span>         <span style="color: #5c6370;">// Cung cáº¥p lá»›p std::thread Ä‘á»ƒ táº¡o vÃ  quáº£n lÃ½ luá»“ng.</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;functional&gt;</span>     <span style="color: #5c6370;">// Cáº§n thiáº¿t Ä‘á»ƒ sá»­ dá»¥ng std::ref vÃ  std::cref, giÃºp truyá»n tham chiáº¿u tá»›i luá»“ng.</span>

<span style="color: #5c6370;">// HÃ m cÃ´ng viá»‡c (worker function) Ä‘Æ°á»£c thá»±c thi bá»Ÿi má»—i luá»“ng.</span>
<span style="color: #5c6370;">// Má»—i luá»“ng sáº½ chá»‹u trÃ¡ch nhiá»‡m tÃ­nh toÃ¡n má»™t khoáº£ng cÃ¡c hÃ ng (tá»« start_row Ä‘áº¿n end_row).</span>
<span style="color: #5c6370;">// const Matrix& A, const Matrix& B: Nháº­n ma tráº­n A, B dÆ°á»›i dáº¡ng tham chiáº¿u háº±ng Ä‘á»ƒ Ä‘á»c.</span>
<span style="color: #5c6370;">// Matrix& C: Nháº­n ma tráº­n káº¿t quáº£ C dÆ°á»›i dáº¡ng tham chiáº¿u KHÃ”NG Háº°NG Ä‘á»ƒ cÃ³ thá»ƒ ghi káº¿t quáº£ vÃ o.</span>
<span style="color: #c678dd;">void</span> <span style="color: #61afef;">standard_worker_task</span>(<span style="color: #c678dd;">const</span> Matrix&amp; A, <span style="color: #c678dd;">const</span> Matrix&amp; B, Matrix&amp; C, <span style="color: #d19a66;">int</span> start_row, <span style="color: #d19a66;">int</span> end_row) {
    <span style="color: #5c6370;">// Luá»“ng nÃ y chá»‰ láº·p qua cÃ¡c hÃ ng Ä‘Æ°á»£c giao cho nÃ³.</span>
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = start_row; i &lt; end_row; ++i) {
        <span style="color: #5c6370;">// VÃ²ng láº·p tÃ­nh toÃ¡n cho tá»«ng pháº§n tá»­ trÃªn hÃ ng i váº«n giá»¯ nguyÃªn nhÆ° báº£n tuáº§n tá»±.</span>
        <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> j = <span style="color: #d19a66;">0</span>; j &lt; B.cols; ++j) {
            <span style="color: #5c6370;">// VÃ²ng láº·p k thá»±c hiá»‡n phÃ©p tÃ­ch vÃ´ hÆ°á»›ng (dot product).</span>
            <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> k = <span style="color: #d19a66;">0</span>; k &lt; A.cols; ++k) {
                <span style="color: #5c6370;">// Ghi káº¿t quáº£ trá»±c tiáº¿p vÃ o ma tráº­n C dÃ¹ng chung.</span>
                <span style="color: #5c6370;">// VÃ¬ má»—i luá»“ng ghi vÃ o cÃ¡c hÃ ng khÃ¡c nhau (i khÃ¡c nhau) nÃªn khÃ´ng cÃ³ xung Ä‘á»™t dá»¯ liá»‡u.</span>
                C.data[i][j] += A.data[i][k] * B.data[k][j];
            }
        }
    }
}

<span style="color: #5c6370;">// HÃ m Ä‘iá»u phá»‘i chÃ­nh, cÃ³ nhiá»‡m vá»¥ chia viá»‡c vÃ  quáº£n lÃ½ cÃ¡c luá»“ng.</span>
Matrix <span style="color: #61afef;">multiply_multithreaded</span>(<span style="color: #c678dd;">const</span> Matrix&amp; A, <span style="color: #c678dd;">const</span> Matrix&amp; B) {
    <span style="color: #5c6370;">// Láº¥y sá»‘ luá»“ng pháº§n cá»©ng tá»‘i Æ°u mÃ  há»‡ thá»‘ng há»— trá»£.</span>
    <span style="color: #5c6370;">// ThÆ°á»ng lÃ  sá»‘ lÃµi (cores) hoáº·c sá»‘ luá»“ng siÃªu phÃ¢n luá»“ng (hyper-threads) cá»§a CPU.</span>
    <span style="color: #d19a66;">unsigned int</span> num_threads = std::thread::hardware_concurrency();
    
    <span style="color: #5c6370;">// Khá»Ÿi táº¡o ma tráº­n káº¿t quáº£ C vá»›i kÃ­ch thÆ°á»›c phÃ¹ há»£p vÃ  cÃ¡c giÃ¡ trá»‹ ban Ä‘áº§u báº±ng 0.</span>
    Matrix C;
	C.rows = A.rows;
	C.cols = B.cols;
	C.data.assign(C.rows, std::vector&lt;<span style="color: #d19a66;">int</span>&gt;(C.cols, <span style="color: #d19a66;">0</span>));
    
    <span style="color: #5c6370;">// Vector Ä‘á»ƒ lÆ°u trá»¯ cÃ¡c Ä‘á»‘i tÆ°á»£ng luá»“ng, giÃºp quáº£n lÃ½ chÃºng dá»… dÃ ng hÆ¡n.</span>
    std::vector&lt;std::thread&gt; threads;
    
    <span style="color: #5c6370;">// TÃ­nh toÃ¡n sá»‘ hÃ ng cÆ¡ báº£n mÃ  má»—i luá»“ng sáº½ xá»­ lÃ½.</span>
    <span style="color: #d19a66;">int</span> rows_per_thread = A.rows / num_threads;

    <span style="color: #5c6370;">// VÃ²ng láº·p Ä‘á»ƒ táº¡o vÃ  khá»Ÿi cháº¡y cÃ¡c luá»“ng.</span>
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">unsigned int</span> i = <span style="color: #d19a66;">0</span>; i &lt; num_threads; ++i) {
        <span style="color: #5c6370;">// TÃ­nh toÃ¡n chá»‰ sá»‘ hÃ ng báº¯t Ä‘áº§u vÃ  káº¿t thÃºc cho luá»“ng hiá»‡n táº¡i.</span>
        <span style="color: #d19a66;">int</span> start = i * rows_per_thread;
        <span style="color: #5c6370;">// Xá»­ lÃ½ Ä‘áº·c biá»‡t cho luá»“ng cuá»‘i cÃ¹ng: nÃ³ sáº½ nháº­n táº¥t cáº£ cÃ¡c hÃ ng cÃ²n láº¡i</span>
        <span style="color: #5c6370;">// Ä‘á»ƒ Ä‘áº£m báº£o khÃ´ng hÃ ng nÃ o bá»‹ bá» sÃ³t do phÃ©p chia sá»‘ nguyÃªn.</span>
        <span style="color: #d19a66;">int</span> end = (i == num_threads - <span style="color: #d19a66;">1</span>) ? A.rows : start + rows_per_thread;
        
        <span style="color: #5c6370;">// Táº¡o má»™t luá»“ng má»›i vÃ  thÃªm nÃ³ vÃ o vector.</span>
        <span style="color: #5c6370;">// Luá»“ng nÃ y sáº½ cháº¡y hÃ m standard_worker_task vá»›i cÃ¡c tham sá»‘ Ä‘Æ°á»£c cung cáº¥p.</span>
        <span style="color: #5c6370;">// std::cref(A), std::cref(B): Truyá»n A vÃ  B dÆ°á»›i dáº¡ng tham chiáº¿u háº±ng (const reference).</span>
        <span style="color: #5c6370;">// std::ref(C): Truyá»n C dÆ°á»›i dáº¡ng tham chiáº¿u khÃ´ng háº±ng (non-const reference).</span>
        <span style="color: #5c6370;">// start, end: Truyá»n cÃ¡c chá»‰ sá»‘ hÃ ng theo giÃ¡ trá»‹.</span>
        threads.emplace_back(standard_worker_task, std::cref(A), std::cref(B), std::ref(C), start, end);
    }

    <span style="color: #5c6370;">// Äá»£i táº¥t cáº£ cÃ¡c luá»“ng hoÃ n thÃ nh cÃ´ng viá»‡c cá»§a chÃºng.</span>
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">auto</span>&amp; th : threads) {
        <span style="color: #5c6370;">// Lá»‡nh join() sáº½ cháº·n luá»“ng chÃ­nh cho Ä‘áº¿n khi luá»“ng 'th' káº¿t thÃºc.</span>
        th.join();
    }
    <span style="color: #5c6370;">// Sau khi táº¥t cáº£ cÃ¡c luá»“ng Ä‘Ã£ join, ma tráº­n C Ä‘Ã£ Ä‘Æ°á»£c tÃ­nh toÃ¡n Ä‘áº§y Ä‘á»§.</span>
    <span style="color: #c678dd;">return</span> C;
}

<span style="color: #5c6370;">// HÃ m main khÃ´ng cÃ³ gÃ¬ thay Ä‘á»•i nhiá»u so vá»›i báº£n tuáº§n tá»±.</span>
<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    <span style="color: #c678dd;">try</span> {
        Matrix A = read_matrix_from_file(<span style="color: #98c379;">"A.txt"</span>);
        Matrix B = read_matrix_from_file(<span style="color: #98c379;">"B.txt"</span>);

        <span style="color: #c678dd;">if</span> (A.cols != B.rows) {
            <span style="color: #c678dd;">throw</span> std::invalid_argument(<span style="color: #98c379;">"Error: Incompatible matrix dimensions."</span>);
        }

        <span style="color: #5c6370;">// Äo thá»i gian cá»§a hÃ m nhÃ¢n ma tráº­n phiÃªn báº£n Ä‘a luá»“ng.</span>
        <span style="color: #d19a66;">auto</span> start_time = std::chrono::high_resolution_clock::now();
        Matrix C = multiply_multithreaded(A, B);
        <span style="color: #d19a66;">auto</span> end_time = std::chrono::high_resolution_clock::now();

        <span style="color: #d19a66;">auto</span> duration = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(end_time - start_time);
        std::cout &lt;&lt; <span style="color: #98c379;">"Time taken for standard multi-threading: "</span> &lt;&lt; duration.count() &lt;&lt; <span style="color: #98c379;">" milliseconds\n"</span>;

        write_matrix_to_file(C, <span style="color: #98c379;">"C_multithread_standard.txt"</span>);
        std::cout &lt;&lt; <span style="color: #98c379;">"Result saved to C_multithread_standard.txt\n"</span>;

    } <span style="color: #c678dd;">catch</span> (<span style="color: #c678dd;">const</span> std::exception&amp; e) {
        std::cerr &lt;&lt; <span style="color: #98c379;">"An error occurred: "</span> &lt;&lt; e.what() &lt;&lt; std::endl;
        <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">1</span>;
    }
    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}`
        },
        'optimized-mult': {
            explained: `<span style="color: #5c6370;">// multithread_optimized.cpp</span>
<span style="color: #5c6370;">// MÃ´ táº£: PhiÃªn báº£n nhÃ¢n ma tráº­n Ä‘a luá»“ng Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a.</span>
<span style="color: #5c6370;">// Tá»‘i Æ°u hÃ³a chÃ­nh lÃ  sá»­ dá»¥ng má»™t biáº¿n cá»¥c bá»™ Ä‘á»ƒ tÃ­nh tá»•ng cho má»—i pháº§n tá»­,</span>
<span style="color: #5c6370;">// sau Ä‘Ã³ má»›i ghi káº¿t quáº£ ra bá»™ nhá»› dÃ¹ng chung. Viá»‡c nÃ y giáº£m Ä‘Ã¡ng ká»ƒ sá»‘ láº§n</span>
<span style="color: #5c6370;">// truy cáº­p vÃ  ghi vÃ o bá»™ nhá»› chung, giÃºp cáº£i thiá»‡n hiá»‡u nÄƒng vÃ  trÃ¡nh cÃ¡c</span>
<span style="color: #5c6370;">// váº¥n Ä‘á» tiá»m áº©n nhÆ° "False Sharing".</span>

<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">"matrix_utils.h"</span> <span style="color: #5c6370;">// Sá»­ dá»¥ng cÃ¡c hÃ m vÃ  struct Ä‘Ã£ Ä‘á»‹nh nghÄ©a.</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;chrono&gt;</span>         <span style="color: #5c6370;">// ThÆ° viá»‡n Ä‘á»ƒ Ä‘o lÆ°á»ng thá»i gian.</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;thread&gt;</span>         <span style="color: #5c6370;">// ThÆ° viá»‡n Ä‘á»ƒ lÃ m viá»‡c vá»›i luá»“ng.</span>
<span style="color: #c678dd;">#include</span> <span style="color: #98c379;">&lt;functional&gt;</span>     <span style="color: #5c6370;">// Cáº§n cho std::ref vÃ  std::cref.</span>

<span style="color: #5c6370;">// HÃ m cÃ´ng viá»‡c cho má»—i luá»“ng (phiÃªn báº£n Ä‘Ã£ Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a).</span>
<span style="color: #5c6370;">// Cáº¥u trÃºc hÃ m váº«n tÆ°Æ¡ng tá»±, nhÆ°ng logic bÃªn trong vÃ²ng láº·p cuá»‘i cÃ¹ng Ä‘Ã£ thay Ä‘á»•i.</span>
<span style="color: #c678dd;">void</span> <span style="color: #61afef;">optimized_worker_task</span>(<span style="color: #c678dd;">const</span> Matrix& A, <span style="color: #c678dd;">const</span> Matrix& B, Matrix& C, <span style="color: #d19a66;">int</span> start_row, <span style="color: #d19a66;">int</span> end_row) {
    <span style="color: #5c6370;">// Duyá»‡t qua cÃ¡c hÃ ng Ä‘Æ°á»£c giao cho luá»“ng nÃ y.</span>
    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> i = start_row; i &lt; end_row; ++i) {
        <span style="color: #5c6370;">// Duyá»‡t qua cÃ¡c cá»™t cá»§a ma tráº­n káº¿t quáº£.</span>
        <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> j = <span style="color: #d19a66;">0</span>; j &lt; B.cols; ++j) {
            <span style="color: #5c6370;">// *** ÄIá»‚M Tá»I Æ¯U HÃ“A QUAN TRá»ŒNG NHáº¤T ***</span>
            <span style="color: #5c6370;">// Táº¡o má»™t biáº¿n cá»¥c bá»™ sum cho má»—i luá»“ng Ä‘á»ƒ tÃ­ch lÅ©y káº¿t quáº£.</span>
            <span style="color: #5c6370;">// Biáº¿n nÃ y thÆ°á»ng Ä‘Æ°á»£c lÆ°u trong thanh ghi (register) cá»§a CPU, tá»‘c Ä‘á»™ truy cáº­p cá»±c nhanh.</span>
            <span style="color: #d19a66;">int</span> sum = <span style="color: #d19a66;">0</span>;
            
            <span style="color: #5c6370;">// VÃ²ng láº·p trong cÃ¹ng Ä‘á»ƒ thá»±c hiá»‡n phÃ©p tÃ­ch vÃ´ hÆ°á»›ng.</span>
            <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">int</span> k = <span style="color: #d19a66;">0</span>; k &lt; A.cols; ++k) {
                <span style="color: #5c6370;">// Má»i phÃ©p tÃ­nh cá»™ng dá»“n Ä‘á»u Ä‘Æ°á»£c thá»±c hiá»‡n trÃªn biáº¿n cá»¥c bá»™ sum.</span>
                <span style="color: #5c6370;">// HoÃ n toÃ n khÃ´ng cÃ³ thao tÃ¡c ghi vÃ o ma tráº­n C (bá»™ nhá»› chung) trong vÃ²ng láº·p nÃ y.</span>
                sum += A.data[i][k] * B.data[k][j];
            }
            
            <span style="color: #5c6370;">// Sau khi vÃ²ng láº·p k káº¿t thÃºc, chÃºng ta má»›i thá»±c hiá»‡n Má»˜T Láº¦N GHI DUY NHáº¤T</span>
            <span style="color: #5c6370;">// vÃ o bá»™ nhá»› chung cho pháº§n tá»­ C.data[i][j].</span>
            C.data[i][j] = sum;
        }
    }
}

<span style="color: #5c6370;">// HÃ m Ä‘iá»u phá»‘i chÃ­nh (hoÃ n toÃ n tÆ°Æ¡ng tá»± báº£n standard).</span>
<span style="color: #5c6370;">// Sá»± khÃ¡c biá»‡t duy nháº¥t lÃ  nÃ³ gá»i optimized_worker_task thay vÃ¬ standard_worker_task.</span>
Matrix <span style="color: #61afef;">multiply_multithreaded_optimized</span>(<span style="color: #c678dd;">const</span> Matrix& A, <span style="color: #c678dd;">const</span> Matrix& B) {
    <span style="color: #d19a66;">unsigned int</span> num_threads = std::thread::hardware_concurrency();
    Matrix C;
	C.rows = A.rows;
	C.cols = B.cols;
	C.data.assign(C.rows, std::vector&lt;<span style="color: #d19a66;">int</span>&gt;(C.cols, <span style="color: #d19a66;">0</span>));
    std::vector&lt;std::thread&gt; threads;
    
    <span style="color: #d19a66;">int</span> rows_per_thread = A.rows / num_threads;

    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">unsigned int</span> i = <span style="color: #d19a66;">0</span>; i &lt; num_threads; ++i) {
        <span style="color: #d19a66;">int</span> start = i * rows_per_thread;
        <span style="color: #d19a66;">int</span> end = (i == num_threads - <span style="color: #d19a66;">1</span>) ? A.rows : start + rows_per_thread;
        <span style="color: #5c6370;">// Gá»i Ä‘áº¿n hÃ m worker Ä‘Ã£ Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a.</span>
        threads.emplace_back(optimized_worker_task, std::cref(A), std::cref(B), std::ref(C), start, end);
    }

    <span style="color: #c678dd;">for</span> (<span style="color: #d19a66;">auto</span>&amp; th : threads) {
        th.join();
    }
    <span style="color: #c678dd;">return</span> C;
}

<span style="color: #5c6370;">// HÃ m main khÃ´ng cÃ³ thay Ä‘á»•i vá» logic, chá»‰ gá»i hÃ m nhÃ¢n ma tráº­n phiÃªn báº£n tá»‘i Æ°u.</span>
<span style="color: #d19a66;">int</span> <span style="color: #61afef;">main</span>() {
    <span style="color: #c678dd;">try</span> {
        Matrix A = read_matrix_from_file(<span style="color: #98c379;">"A.txt"</span>);
        Matrix B = read_matrix_from_file(<span style="color: #98c379;">"B.txt"</span>);

        <span style="color: #c678dd;">if</span> (A.cols != B.rows) {
            <span style="color: #c678dd;">throw</span> std::invalid_argument(<span style="color: #98c379;">"Error: Incompatible matrix dimensions."</span>);
        }

        <span style="color: #d19a66;">auto</span> start_time = std::chrono::high_resolution_clock::now();
        <span style="color: #5c6370;">// Gá»i hÃ m nhÃ¢n ma tráº­n phiÃªn báº£n tá»‘i Æ°u Ä‘á»ƒ Ä‘o thá»i gian.</span>
        Matrix C = multiply_multithreaded_optimized(A, B);
        <span style="color: #d19a66;">auto</span> end_time = std::chrono::high_resolution_clock::now();

        <span style="color: #d19a66;">auto</span> duration = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(end_time - start_time);
        std::cout &lt;&lt; <span style="color: #98c379;">"Time taken for OPTIMIZED multi-threading: "</span> &lt;&lt; duration.count() &lt;&lt; <span style="color: #98c379;">" milliseconds\n"</span>;

        write_matrix_to_file(C, <span style="color: #98c379;">"C_multithread_optimized.txt"</span>);
        std::cout &lt;&lt; <span style="color: #98c379;">"Result saved to C_multithread_optimized.txt\n"</span>;

    } <span style="color: #c678dd;">catch</span> (<span style="color: #c678dd;">const</span> std::exception& e) {
        std::cerr &lt;&lt; <span style="color: #98c379;">"An error occurred: "</span> &lt;&lt; e.what() &lt;&lt; std::endl;
        <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">1</span>;
    }
    <span style="color: #c678dd;">return</span> <span style="color: #d19a66;">0</span>;
}`
        }
};

    // --- LÆ°u ná»™i dung code gá»‘c vÃ o object `exampleContents` ---
    for (const id in exampleContents) {
        const block = document.querySelector(`.code-block[data-example-id="${id}"]`);
        if (block) {
            exampleContents[id].original = block.querySelector('pre code').innerHTML;
        }
    }

    // Láº·p qua táº¥t cáº£ cÃ¡c khá»‘i code cÃ³ data-example-id Ä‘á»ƒ thÃªm thanh cÃ´ng cá»¥
    document.querySelectorAll('.code-block[data-example-id]').forEach(block => {
        const exampleId = block.dataset.exampleId;
        const container = block.closest('.code-container');
        if (!container || !exampleContents[exampleId]) return;

        const toolbar = document.createElement('div');
        toolbar.className = 'code-toolbar';

        const explainButton = document.createElement('button');
        explainButton.className = 'toolbar-button';
        explainButton.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.064.293.006.399.287.47l.45.082.082.38-2.29.287-.082-.38.45-.083a.49.49 0 0 1 .352-.176c.07-.294-.055-.469-.288-.469l-.738-3.468c-.064-.293-.006-.399-.287-.47l-.45-.082-.082-.38 2.29-.287.082.38-.45.083C6.931 6.648 6.865 7.02 7.03 7.29l.738 3.468c.064.293.006.399.287.47l.45.082.082.38-2.29.287-.082-.38.45-.083a.49.49 0 0 1 .352-.176c.07-.294-.055-.469-.288-.469l-.738-3.468c-.064-.293-.006-.399-.287-.47l-.45-.082-.082-.38 2.29-.287.082.38z"/></svg>
            <span>Giáº£i thÃ­ch</span>`;
        
        const copyButton = document.createElement('button');
        copyButton.className = 'toolbar-button';
        copyButton.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>
            <span>Sao chÃ©p</span>`;

        toolbar.appendChild(explainButton);
        toolbar.appendChild(copyButton);
        block.prepend(toolbar);

        explainButton.addEventListener('click', () => {
            const explanationPanel = container.querySelector('.explanation-panel');
            const codeElement = block.querySelector('pre code');
            const isHidden = explanationPanel.classList.toggle('hidden');
            
            explainButton.querySelector('span').textContent = isHidden ? 'Giáº£i thÃ­ch' : 'áº¨n';

            if (isHidden) { 
                 codeElement.innerHTML = exampleContents[exampleId].original;
            } else { 
                 codeElement.innerHTML = exampleContents[exampleId].explained;
            }
        });

        copyButton.addEventListener('click', () => {
            const code = block.querySelector('pre code');
            if (code) {
                navigator.clipboard.writeText(code.innerText).then(() => {
                    const span = copyButton.querySelector('span');
                    const originalText = span.textContent;
                    span.textContent = 'ÄÃ£ chÃ©p!';
                    setTimeout(() => { span.textContent = originalText; }, 2000);
                });
            }
        });
    });
});
</script>
</body>
</html>